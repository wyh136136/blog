{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"source/favicon.ico","path":"favicon.ico","modified":0,"renderable":0},{"_id":"source/img/alipay.jpg","path":"img/alipay.jpg","modified":0,"renderable":0},{"_id":"source/img/wechat.jpg","path":"img/wechat.jpg","modified":0,"renderable":0},{"_id":"node_modules/hexo-theme-butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/_posts/1.md","hash":"0d6dbe69e950c84b12cc0288365845e7f08dc841","modified":1691129231636},{"_id":"source/_posts/10.md","hash":"dd0712a99a56c3723039ac2b85b3cd227265ef4d","modified":1691372528273},{"_id":"source/_posts/2.md","hash":"c0d3b3c1097715c7091c38600650efa799cc1d77","modified":1691131110728},{"_id":"source/_posts/3.md","hash":"8e75ff90ca6a3036f8ccadaf715f96b3d3bcc3af","modified":1691369232530},{"_id":"source/_posts/4.md","hash":"5cf5b3798ef892ecafbdae5efd06bb6d4a194c24","modified":1691129243306},{"_id":"source/_posts/5.md","hash":"7fe3639f3584a50adf2ecbde8a02920f7c641f51","modified":1691129276846},{"_id":"source/_posts/6.md","hash":"b4eb25c7d09aade4d4e83e9a3cf23dddd890beb3","modified":1691369901739},{"_id":"source/_posts/7.md","hash":"13b224cc7b15bc13c7ece8199d05dbf03ad9cd9b","modified":1691370299901},{"_id":"source/_posts/8.md","hash":"95f1e638bfe19f28ba513e20dd73e366fa089a10","modified":1691372840452},{"_id":"source/_posts/9.md","hash":"0c353d1f41058bb2f4d45955e3f0e98c6bd08c36","modified":1691373662597},{"_id":"source/categories/index.md","hash":"7687247a2651f708092c2298d196b3e3ff3acf8f","modified":1691115918356},{"_id":"source/tags/index.md","hash":"006ea1e0fedcc8deac0fc96a2ec69c0be22cf7d6","modified":1691115880568},{"_id":"source/favicon.ico","hash":"8319a0c449f754d04e5dcbcab27909b90ff5f40c","modified":1691128501055},{"_id":"source/img/wechat.jpg","hash":"1bd59845778c6e55fa4274c2e9e1050e41d74bac","modified":1691116897068},{"_id":"source/img/alipay.jpg","hash":"cf59cf48a7e819d02ea534d585188e061f73e74d","modified":1691117055076},{"_id":"node_modules/hexo-theme-butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/README.md","hash":"b5d6e7271b88d1a63755386442663af03e36a428","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/README_CN.md","hash":"86569b94949392e9b981608433495f0941d20b0c","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/package.json","hash":"656d8b548940d7d214459cd8853007af38e6c465","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/_config.yml","hash":"459517785a7161e07c333bfe2900243b6287f905","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/plugins.yml","hash":"d0e179ae31cdc62037062432b0ee7a9008155a73","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/languages/default.yml","hash":"4025c0ba440eb24705dd0293ca9ca84efb3105cc","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/languages/zh-CN.yml","hash":"7dd849c3ba34986c57c764d9e36150b4bfffd2e9","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/languages/en.yml","hash":"4e9cdb7a3570929bcf082de7a4eac49140dddc73","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/languages/zh-TW.yml","hash":"ee01e068f12dc33adfae5733824ea1255deb5ca6","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/archive.pug","hash":"a0c034c2d319320a54046805e80b58dc48b7e233","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/category.pug","hash":"710708cfdb436bc875602abf096c919ccdf544db","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/index.pug","hash":"e1c3146834c16e6077406180858add0a8183875a","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/page.pug","hash":"baf469784aef227e4cc840550888554588e87a13","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/tag.pug","hash":"0440f42569df2676273c026a92384fa7729bc4e9","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/post.pug","hash":"fc9f45252d78fcd15e4a82bfd144401cba5b169a","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"7dfe7189ffeaebb6db13842237f8e124649bea3d","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"fc468a93a64c7a3e408fbac921c9f5a5a8f32027","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"996640605ed1e8e35182f0fd9a60a88783b24b03","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/.github/workflows/publish.yml","hash":"05857c2f265246d8de00e31037f2720709540c09","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/.github/workflows/stale.yml","hash":"ac62b989b5550c756e1986fcc68f243170705383","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/additional-js.pug","hash":"aca0ec7ef69b21d1f242c62fed389468a0f0e1a2","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/footer.pug","hash":"02390a5b6ae1f57497b22ba2e6be9f13cfb7acac","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/404.pug","hash":"cb49f737aca272ccfeb62880bd651eccee72a129","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head.pug","hash":"dd9fde431add984330e3178e06a8d74705e7340e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/layout.pug","hash":"7fa9ae4b70b87fc97e992dde5944681f92b59bea","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/pagination.pug","hash":"4c85de4dea4dca4e5088097a79bd6d7009cbf8ef","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/rightside.pug","hash":"d15124c488273ea0801a042888feadc9261d0b2f","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/sidebar.pug","hash":"9f0e9e039f304439007460fa0a7c8ac18e0ffd37","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/404.js","hash":"83cd7f73225ccad123afbd526ce1834eb1eb6a6d","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/cdn.js","hash":"21fb5aabe043486d095c4c8cce361ed85ba88a26","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/comment.js","hash":"5351e0bc09e6b5b3f6d30f333a2520626a28ca3a","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/init.js","hash":"428b94c7b9e83f7ea36227dee66bfe3c23aee4a8","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/stylus.js","hash":"9819f0996234fbd80d6c50a9e526c56ebf22588d","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/welcome.js","hash":"8ad9911b755cba13dde2cc055c3f857a6b0dd20e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/filters/post_lazyload.js","hash":"932df912976261929f809b7dbd4eb473e7787345","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/aside_categories.js","hash":"e00efdb5d02bc5c6eb4159e498af69fa61a7dbb9","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/filters/random_cover.js","hash":"8d25f47434deae870bbffd07efe528a40363ab4d","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/findArchiveLength.js","hash":"9ea86bd7a3c3fca3324f70b1cd4d9e42f9efb08d","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/inject_head_js.js","hash":"4238e06ff448ff2ee717cd4c874f37f04d35da06","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/button.js","hash":"91d954f6e9fe6e571eb8ec9f8996294b2dc3688e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/page.js","hash":"ce5d5a3d07b0d76ac5e96e5f9e5783f4b601b6be","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/related_post.js","hash":"4677be4175da6800c0b3b8c1614e593f73df8831","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/flink.js","hash":"ab62919fa567b95fbe14889517abda649991b1ee","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/gallery.js","hash":"950b3dbac0b21717458a8d1769cbfc454d0eff54","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/hide.js","hash":"396c3ab1bcf1c7693ad7e506eadd13016c6769b6","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/inlineImg.js","hash":"a43ee2c7871bdd93cb6beb804429e404570f7929","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/label.js","hash":"03b2afef41d02bd1045c89578a02402c28356006","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/note.js","hash":"d51812b43924f1bbf413c67499510dd125022005","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/mermaid.js","hash":"531808a290b8bdd66bac2faab211ada8e9646a37","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/score.js","hash":"ea679dfe12d0e2290113b4a9d00663ce7a5ee5ad","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/tabs.js","hash":"6c6e415623d0fd39da016d9e353bb4f5cca444f5","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/index.styl","hash":"755490867fd8afe47d5cce24faea2ca172b0c4dd","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/timeline.js","hash":"300eb779588bf35a1b687d9f829d866074b707e3","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/var.styl","hash":"30abbb8eed880d51f61f336064d93abd709e0115","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/js/main.js","hash":"0227b5bd233a3c66582e0ee820cdb353ce52ece1","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/js/tw_cn.js","hash":"42b106354d72a0ea1fe62587b313a5b7de3cc393","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/js/utils.js","hash":"aaaedc207440095da1ffabcad870fc2641befb0e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/Open_Graph.pug","hash":"8aa8d799aedbfd811195b84a451bc4b6e2647c12","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/analytics.pug","hash":"67e1c3b48e4ca7ee0b2c76d3ca7476b9883cf105","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/config.pug","hash":"75e7a524af64fbaaaf7b05a1b1922bf6940d7afe","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/config_site.pug","hash":"7df90c8e432e33716517ab918b0a125bc284041b","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/noscript.pug","hash":"d16ad2ee0ff5751fd7f8a5ce1b83935518674977","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/preconnect.pug","hash":"a03b3ddc06e7aa9fd07eea0d5f97c8d5addd2315","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/site_verification.pug","hash":"e2e8d681f183f00ce5ee239c42d2e36b3744daad","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/index.pug","hash":"944d6e9dd50df3395f3a2c7ad9db667d50dea4ed","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/nav.pug","hash":"f61659aa457d1a2d1baa3a13157996cfac4d6609","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/menu_item.pug","hash":"31346a210f4f9912c5b29f51d8f659913492f388","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/social.pug","hash":"5de9a82032cdad1db3b868b797460921cd775fc2","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/post-info.pug","hash":"9698f22751778dde063cbfbd01c59ca4462ccd85","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/fullpage-loading.pug","hash":"9e8c5788602b29a527ef35fe8a20076a5fa969bd","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/index.pug","hash":"131f344d68b4c241d6e03849b243ee792fcd3cea","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/pace.pug","hash":"6ab4e301c92586505d6cddce1b3ad23b7c79010d","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/mixins/post-ui.pug","hash":"1ed873db25eec869beebb6873f04e19f0b0f4134","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/mixins/article-sort.pug","hash":"90554c2ca5ba946f4c02e1bc5fe2859cef1b1594","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/flink.pug","hash":"f9ce83978b217a71a2eb8761dc14b09866faa3f4","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/post/reward.pug","hash":"864869c43fe5b5bb6f4ac6b13dd4bfb16ea47550","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/default-page.pug","hash":"12c65c174d26a41821df9bad26cdf1087ec5b0ca","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/tags.pug","hash":"9621991359e22b14049346f1cf87bdedc94edf5a","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/post/post-copyright.pug","hash":"ebecba46a5f4efe1c98a386df06c56e26fbd07b9","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/aplayer.pug","hash":"c7cfade2b160380432c47eef4cd62273b6508c58","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/effect.pug","hash":"6528e86656906117a1af6b90e0349c2c4651d5e1","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/pjax.pug","hash":"cde142861edfc7aab435b8a0ebb84d9ba450fb5b","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/pangu.pug","hash":"0f024e36b8116118233e10118714bde304e01e12","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/prismjs.pug","hash":"ffb9ea15a2b54423cd4cd441e2d061b8233e9b58","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/subtitle.pug","hash":"8044b9c18b34b019ffe26b7383e7e80356b5e4b5","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_announcement.pug","hash":"ae392459ad401a083ca51ee0b27526b3c1e1faed","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_author.pug","hash":"03c6afabbf1ac729c7fb21c7ec06da0190b0fdc7","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_bottom_self.pug","hash":"13dc8ce922e2e2332fe6ad5856ebb5dbf9ea4444","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_newest_comment.pug","hash":"7834bf7c711e739fd33cfcd0b53d151013b3d449","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_recent_post.pug","hash":"e5aac7b28ed4123d75797263c64e74ac547945bc","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_post_toc.pug","hash":"3057a2f6f051355e35d3b205121af8735100eacf","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_tags.pug","hash":"eceb4420a64c720f0d2741e89d6229bbb3d87353","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/index.pug","hash":"010e3d548ababca2280c4fc4168d9a4a1ee4f536","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_webinfo.pug","hash":"35ce167c5a275211bfc1fa3d49adfde5b404d98f","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_top_self.pug","hash":"ae67c6d4130a6c075058a9c1faea1648bcc6f83e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_global/index.styl","hash":"51868d861c94a9f1ad7c0dbd66d2f475c5d4ea62","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight.styl","hash":"57a19eb0c418d92a88b143f56ccb8cd60e6d7ad0","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/aside.styl","hash":"57adf29a3e36e4ea84384e36c034eb294dffb208","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/theme.styl","hash":"bcd384c8b2aa0390c9eb69ac1abbfd1240ce1da4","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/chat.styl","hash":"f9a5d3f1fc5ed0ed2ee4c1eaa58ed650d11ddebd","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_global/function.styl","hash":"e0de61a059b5e6c7b8ebc7149b4650bdcd69af5e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/comments.styl","hash":"c61dccca690d486c3d9c29cf028d87b777385141","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/footer.styl","hash":"83a7a70eb0532ea9c4267939fe484af915fca01e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/head.styl","hash":"8cd2aaa32cd68cd1908c9001444a811c3d0f9267","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/loading.styl","hash":"ac2aeee9926f75b2a0098efe1c114126987430f2","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/pagination.styl","hash":"fb9f78bfbb79579f1d752cb73fb6d25c8418e0fd","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/post.styl","hash":"fc9424d9c5def2201ec1d04dc79d0beedc1d2175","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/relatedposts.styl","hash":"d53de408cb27a2e704aba7f7402b7caebe0410d8","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/rightside.styl","hash":"bbc884d6b2158a833b77a1bbc07248e17874b22e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/reward.styl","hash":"c5cfed620708807a48076b5ee59b0ba84e29aa80","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/sidebar.styl","hash":"631ca35a38bc4ac052e9caf47508ff1f99842fc7","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/third-party.styl","hash":"5556c9bf4f53a90cb9b4945cd76a8849bd67f3f3","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_mode/darkmode.styl","hash":"e4f948b0d4eb5483b2b360e56cbfe3359751b438","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_mode/readmode.styl","hash":"c481d1f689a4e6d7ee492a03751bda47a30225ce","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/404.styl","hash":"50dbb9e6d98c71ffe16741b8c1b0c1b9771efd2b","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/archives.styl","hash":"c9e98027f2dd730ce389c2047f62ebb748955fcf","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/categories.styl","hash":"f01ee74948cedb44e53cd3bb1ef36b7d2778ede7","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/flink.styl","hash":"98d755b686ee833e9da10afaa40c4ec2bd66c19a","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/common.styl","hash":"4e320e16d49bc18085045937681f7331a1e243ca","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/homepage.styl","hash":"b3ea08d9460122751144a3ca835e009a460d6ad3","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/tags.styl","hash":"580feb7e8b0822a1be48ac380f8c5c53b1523321","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/algolia.styl","hash":"649a054e73278b6724bd4dd9b94724791ec5c928","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/index.styl","hash":"20a3134e1302b62bfc881f4ec43f398267111f22","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/local-search.styl","hash":"a86e4e9198b225b4b73a7a45f04b86cbbed0d231","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/button.styl","hash":"45f0c32bdea117540f6b14ebac6450d7142bd710","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/gallery.styl","hash":"81ad85acf0e0fe7f9ee23c16a700e7154574d5dd","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/hexo.styl","hash":"d76c38adf1d9c1279ef4241835667789f5b736e0","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/hide.styl","hash":"ce489ca2e249e2a3cf71584e20d84bdb022e3475","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/label.styl","hash":"66c59e193d794cdb02cca7bd1dc4aea5a19d7e84","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/note.styl","hash":"85ae91c83691ea4511f4277da1194a185251cc78","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/timeline.styl","hash":"f071156d439556e7463ed4bc61ceee87170d5d08","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/algolia.js","hash":"fd86281d4f0f99ce173e49c1a0df3507fe268d37","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/local-search.js","hash":"8509cbd954ee9e099dcfbbfdafba70893a56e9ae","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/abcjs/abcjs.pug","hash":"ed6906b7c6aa7046bbad95dfdda9211997be7099","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/tabs.styl","hash":"bf9568444dd54e39dc59b461323dcd38942f27d9","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/abcjs/index.pug","hash":"f58f1648d2d71311bafca4833f20b605bb5f18c8","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/artalk.pug","hash":"5d5d8a0a3a7690d6d01e3feb91c2a36a5cd651b1","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/disqus.pug","hash":"9ef303da16d180619da18b146ddb9bc35f66bdbf","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"6e17b2cea503eabeb328835038812cfa95f15871","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"0704efed9079c867ab5f7bee7381a6c869154c73","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/giscus.pug","hash":"5127bc550a2edb1ab9f45416e1964c76e8201544","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/index.pug","hash":"35ae7980f658a349c5956c5699efd435b604b836","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/js.pug","hash":"00ed91c52939b9675b316137f854d13684c895a6","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"2fc5627eb63118c83df9422b47c801822e28df98","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/livere.pug","hash":"52ea8aa26b84d3ad38ae28cdf0f163e9ca8dced7","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/remark42.pug","hash":"598790433e3c9be28b0063bff08d257acd0abf75","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"4d78f6266d0870c06c10eaf47c951bd4d9a7732e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/valine.pug","hash":"e55b9c0f8ced231f47eb88bd7f4ec99f29c5c29d","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/utterances.pug","hash":"2a8d02ed9303092e8816f6489a443e7388102470","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/waline.pug","hash":"0a1b8fe95623b095eb7ede3f30ca327684d1e613","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/katex.pug","hash":"dfcbd9881be569ea420eff1a6b00e4f4dbe2138e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/mathjax.pug","hash":"fc072ac839401174b5d3cf9acd3b694246c23a55","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/mermaid.pug","hash":"d0ce1891b042dcc2c93cacc866e38721b94aa4c4","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"0330e3063ccf0ce40e4828b8d4fbef62362e8195","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"4ec0642f2d5444acfab570a6f8c7868e7ff43fde","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"8c0d9a45bd2d83cc6d0e7bbfe172a09ff33c0178","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"aa6061183a32472cd1882fce445a5049108a984b","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"44991d67abb81784c5cdb4337b2b9798fc4361e1","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"4fe8faf77b8420fc031ae1b54f78b2ece9fcc07e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"ae1ccd78926cc19399d396b237d5161d7cde44a8","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"b7b2aa5be4112065d5066c0f066f5f58721153bf","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/chatra.pug","hash":"ddce8352b371a1fb426bdb6c33f587eb37a69647","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/crisp.pug","hash":"2fb098a7aa45010a8cd212dc0bd5308c6e7c63e3","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/index.pug","hash":"618e1b7f9204049b07beb9e1363c844a78a9ace3","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"9b57a8e13de8fc51a5f550854e47164fd8ac1be8","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/messenger.pug","hash":"e39a9c37adf4cb15a2ba3b2cc65542ffea88650d","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/tidio.pug","hash":"dd61eca6e9a45f63e09bdefba89fe285a81ba096","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"5f86add36eeffbed61d11f08972a13697b4d9437","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d85c3737b5c9548553a78b757a7698df126a52cf","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"0344477a2cf38698318ead2681c63ac12f01586e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"b2d274db84ef22fbd6d5ea8f4404821898934209","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"001e8be47854b891efe04013c240c38fed4185eb","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"56c028ba0ea8fac19f0125114d765dfc56ce2b48","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"39427e107230a10790972349c9dd4c4f31d55eb7","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"d02f3cc9e6183e7d05c7e90e9ae1dee5ce21f297","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/algolia.pug","hash":"9c3c109a12d2b6916e8b4965cca12f521510ead9","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/index.pug","hash":"a99a41334387ee9a46c6f8e8212331a29a10d159","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/docsearch.pug","hash":"1c3e101445c5571ba998ce293d3984319df1b3b0","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/local-search.pug","hash":"5ebd5e8d39c9f77f5b2d983f6cd6802ccaf98746","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/add-this.pug","hash":"2980f1889226ca981aa23b8eb1853fde26dcf89a","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/addtoany.pug","hash":"85c92f8a7e44d7cd1c86f089a05be438535e5362","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/share-js.pug","hash":"c7dd2b2ae9b23aa0a60fffd7df9e9f76ef52033e","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight/index.styl","hash":"18804c58239d95798fa86d0597f32d7f7dd30051","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight/diff.styl","hash":"cf1fae641c927621a4df1be5ca4a853b9b526e23","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/index.pug","hash":"4c4a9c15215ae8ac5eadb0e086b278f76db9ee92","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/diff.styl","hash":"5972c61f5125068cbe0af279a0c93a54847fdc3b","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/index.styl","hash":"5dc2e0bcae9a54bfb9bdcc82d02ae5a3cf1ca97d","modified":1691113873875},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"8970cc1916c982b64a1478792b2822d1d31e276d","modified":1691113873875},{"_id":"public/404.html","hash":"18bb675f47f38f9f7ae07e1d1cbbc8795632d6bc","modified":1691385401288},{"_id":"public/categories/index.html","hash":"a56b40d8448fcc47edc8c1f549fa960d0ad7632c","modified":1691385401288},{"_id":"public/tags/index.html","hash":"60d2d80f40987ef521120a8cb4ee46c24a8db7e9","modified":1691385401288},{"_id":"public/2023/08/07/9/index.html","hash":"71f6af43d6118c6445ff0e30f7e42b7c21b8a39a","modified":1691385401288},{"_id":"public/2023/08/07/8/index.html","hash":"681a948c859bf4f249e34d5fb292406f66f45630","modified":1691385401288},{"_id":"public/2023/08/07/7/index.html","hash":"8e0d2f832105a775c93816989aa02e5408d1f27e","modified":1691385401288},{"_id":"public/2023/08/07/6/index.html","hash":"8ac5da85fdaee1bec2b0ecae46403a9713d26176","modified":1691385401288},{"_id":"public/2023/08/07/5/index.html","hash":"f060c55d3e2a9214b47c3477079368dc365b74c6","modified":1691385401288},{"_id":"public/2023/08/07/3/index.html","hash":"9448544615e6af841f1a8cd7585020ef3fdd8217","modified":1691385401288},{"_id":"public/2023/08/07/2/index.html","hash":"895426f254931157824e59480b870df3d397533c","modified":1691385401288},{"_id":"public/categories/JS小方法/index.html","hash":"4af97db9dfbeea91d352ab001711c8b77399dca3","modified":1691385401288},{"_id":"public/categories/Vue实现/index.html","hash":"c54337ae9b1836591e31b1eec20abb644da2ecc2","modified":1691385401288},{"_id":"public/categories/uniapp/index.html","hash":"a7aa245ef8ada1d3c36e4ef89a882c359a48cefd","modified":1691385401288},{"_id":"public/2023/08/07/4/index.html","hash":"5ef8f96a1f883d303198dde8436a84cc7be52a32","modified":1691385401288},{"_id":"public/2023/08/07/10/index.html","hash":"26f9c288bce14f392d36f90acb7c5c1334b7c2fc","modified":1691385401288},{"_id":"public/2023/08/07/1/index.html","hash":"de42635182b807e6ed8750b966f01a804f86f64d","modified":1691385401288},{"_id":"public/archives/index.html","hash":"1b8a1a8f82de33090cd98c840430fc377ec60752","modified":1691385401288},{"_id":"public/archives/2023/index.html","hash":"b871e2f5aaae4f13ca0df310310f217ba94161d1","modified":1691385401288},{"_id":"public/categories/CSS小案例/index.html","hash":"42b74794ea219bd5b2775a1eaacdc76a25f34abd","modified":1691385401288},{"_id":"public/archives/2023/08/index.html","hash":"780934c358e3c23337fc2069cc4153f3fcfc63f7","modified":1691385401288},{"_id":"public/index.html","hash":"29da053ce81cc17f8a70383a6ab5195a72c5b346","modified":1691385401288},{"_id":"public/page/2/index.html","hash":"070df0e30fd145e2c12c8ef1f973568992ff8e0a","modified":1691385401288},{"_id":"public/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1691385401288},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1691385401288},{"_id":"public/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1691385401288},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1691385401288},{"_id":"public/js/utils.js","hash":"aaaedc207440095da1ffabcad870fc2641befb0e","modified":1691385401288},{"_id":"public/js/search/local-search.js","hash":"8509cbd954ee9e099dcfbbfdafba70893a56e9ae","modified":1691385401288},{"_id":"public/js/search/algolia.js","hash":"fd86281d4f0f99ce173e49c1a0df3507fe268d37","modified":1691385401288},{"_id":"public/css/index.css","hash":"fae9d16e41a7011adb8c961ae8cdd6b3a7f9e643","modified":1691385401288},{"_id":"public/js/main.js","hash":"0227b5bd233a3c66582e0ee820cdb353ce52ece1","modified":1691385401288},{"_id":"public/js/tw_cn.js","hash":"42b106354d72a0ea1fe62587b313a5b7de3cc393","modified":1691385401288},{"_id":"public/favicon.ico","hash":"8319a0c449f754d04e5dcbcab27909b90ff5f40c","modified":1691385401288},{"_id":"public/img/wechat.jpg","hash":"1bd59845778c6e55fa4274c2e9e1050e41d74bac","modified":1691385401288},{"_id":"public/img/alipay.jpg","hash":"cf59cf48a7e819d02ea534d585188e061f73e74d","modified":1691385401288},{"_id":"source/_posts/11.md","hash":"667bce17b5b47642a3141597080655ea63479665","modified":1691392662657},{"_id":"source/_posts/image-5.png","hash":"e3a7f54026dc8aa3de56277a99d997795f4a1201","modified":1691392179607},{"_id":"source/_posts/image-3.png","hash":"55ede2eb6486c8634ed7318492f0de90ed8694ab","modified":1691392101847},{"_id":"source/_posts/image-8.png","hash":"bae47cf9fff3ae9ab2e070ae360b6e937e89f41d","modified":1691392272749},{"_id":"source/_posts/image-4.png","hash":"6d5ee42a317dd25bce7f7353cff494f796fcf3c1","modified":1691392163857},{"_id":"source/_posts/image-9.png","hash":"bd8997e5f0319209c91d3d6a2e996f8ab0093d53","modified":1691392316274},{"_id":"source/_posts/image-1.png","hash":"a6eeff4fcf2708ee82ea693c0a2ac881d44fa098","modified":1691392026780},{"_id":"source/_posts/image-6.png","hash":"38d2206c101596d5ba22ca494c6195486d42f97f","modified":1691392230068},{"_id":"source/_posts/image-7.png","hash":"556109726a0395c3607e42b06fab67d726e3d994","modified":1691392252052},{"_id":"source/_posts/image.png","hash":"bc4136de086af595170dd13cacd6d377e3b4369c","modified":1691392013082},{"_id":"source/_posts/image-2.png","hash":"1ba06bce830c592dbf91016bd9957772333f6205","modified":1691392074952}],"Category":[{"name":"CSS小案例","_id":"cll0f74s000043gs4ca5m4812"},{"name":"JS小方法","_id":"cll0f74sg000c3gs4317pbztr"},{"name":"Vue实现","_id":"cll0f74si000h3gs49d944iby"},{"name":"uniapp","_id":"cll0f74sl000n3gs47zh7d1kl"},{"name":"vue","_id":"cll0jgsj90001kgs48wvgbh4q"}],"Data":[],"Page":[{"title":"分类","date":"2023-08-03T16:00:00.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2023-08-04 00:00:00\ntype: \"categories\"\n---","updated":"2023-08-04T02:25:18.356Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cll0f74ri00003gs4e3vz79zd","content":"","site":{"data":{}},"cover":false,"excerpt":"","more":""},{"title":"标签","date":"2023-08-03T16:00:00.000Z","type":"tags","orderby":"random","order":1,"_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2023-08-04 00:00:00\ntype: \"tags\"\norderby: random\norder: 1\n---","updated":"2023-08-04T02:24:40.568Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cll0f74rv00023gs40x6gbf51","content":"","site":{"data":{}},"cover":false,"excerpt":"","more":""}],"Post":[{"title":"css 在div左上角添加类似书签的标记","cover":"https://s1.ax1x.com/2023/08/04/pPFRHFs.jpg","_content":"\n\n## 效果图\n\n[![pPFthEF.md.png](https://s1.ax1x.com/2023/08/04/pPFthEF.md.png)](https://imgse.com/i/pPFthEF)\n\n## html\n```html\n\t<view class=\"mark corner-o\" >\n\t\t半导体\n\t</view>  \n```\n## CSS\n```css\n.mark {\n\t\tfloat: left;\n\t\tmargin: 0 6rpx;\n\t\tposition: relative;\n\t\tpadding: 0;\n\t\twidth: 24px;\n\t\tcolor: #fff;\n\t\twriting-mode: sideways-rl;\n\t\ttext-align: center;\n\t}\n\n\t.mark::after {\n\t\tposition: absolute;\n\t\tcontent: \"\";\n\t\tleft: 0;\n\t\ttop: 100%;\n\t\tborder-style: solid;\n\t\tborder-width: 0 12px 12px 12px;\n\t}\n\t\n\t.mark.corner-o {\n\t\tbackground: #ffaa00;\n\t}\n\n\t.mark.corner-o::after {\n\t\tborder-color: #ffaa00 #ffaa00 transparent #ffaa00;\n\t}\n```\n","source":"_posts/1.md","raw":"---\ntitle: css 在div左上角添加类似书签的标记\ncategories: CSS小案例\ncover: https://s1.ax1x.com/2023/08/04/pPFRHFs.jpg\n---\n\n\n## 效果图\n\n[![pPFthEF.md.png](https://s1.ax1x.com/2023/08/04/pPFthEF.md.png)](https://imgse.com/i/pPFthEF)\n\n## html\n```html\n\t<view class=\"mark corner-o\" >\n\t\t半导体\n\t</view>  \n```\n## CSS\n```css\n.mark {\n\t\tfloat: left;\n\t\tmargin: 0 6rpx;\n\t\tposition: relative;\n\t\tpadding: 0;\n\t\twidth: 24px;\n\t\tcolor: #fff;\n\t\twriting-mode: sideways-rl;\n\t\ttext-align: center;\n\t}\n\n\t.mark::after {\n\t\tposition: absolute;\n\t\tcontent: \"\";\n\t\tleft: 0;\n\t\ttop: 100%;\n\t\tborder-style: solid;\n\t\tborder-width: 0 12px 12px 12px;\n\t}\n\t\n\t.mark.corner-o {\n\t\tbackground: #ffaa00;\n\t}\n\n\t.mark.corner-o::after {\n\t\tborder-color: #ffaa00 #ffaa00 transparent #ffaa00;\n\t}\n```\n","slug":"1","published":1,"date":"2023-08-07T02:04:35.896Z","updated":"2023-08-04T06:07:11.636Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll0f74rp00013gs4b2qg39y1","content":"<h2 id=\"效果图\"><a href=\"#效果图\" class=\"headerlink\" title=\"效果图\"></a>效果图</h2><p><a href=\"https://imgse.com/i/pPFthEF\"><img src=\"https://s1.ax1x.com/2023/08/04/pPFthEF.md.png\" alt=\"pPFthEF.md.png\"></a></p>\n<h2 id=\"html\"><a href=\"#html\" class=\"headerlink\" title=\"html\"></a>html</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;mark corner-o&quot;</span> &gt;</span></span><br><span class=\"line\">\t半导体</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span>  </span><br></pre></td></tr></table></figure>\n<h2 id=\"CSS\"><a href=\"#CSS\" class=\"headerlink\" title=\"CSS\"></a>CSS</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.mark</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">\t\t<span class=\"attribute\">margin</span>: <span class=\"number\">0</span> <span class=\"number\">6</span>rpx;</span><br><span class=\"line\">\t\t<span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">\t\t<span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">width</span>: <span class=\"number\">24px</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">writing-mode</span>: sideways-rl;</span><br><span class=\"line\">\t\t<span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"selector-class\">.mark</span><span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">\t\t<span class=\"attribute\">content</span>: <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">top</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">border-style</span>: solid;</span><br><span class=\"line\">\t\t<span class=\"attribute\">border-width</span>: <span class=\"number\">0</span> <span class=\"number\">12px</span> <span class=\"number\">12px</span> <span class=\"number\">12px</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"selector-class\">.mark</span><span class=\"selector-class\">.corner-o</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">background</span>: <span class=\"number\">#ffaa00</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"selector-class\">.mark</span><span class=\"selector-class\">.corner-o</span><span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">border-color</span>: <span class=\"number\">#ffaa00</span> <span class=\"number\">#ffaa00</span> transparent <span class=\"number\">#ffaa00</span>;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<h2 id=\"效果图\"><a href=\"#效果图\" class=\"headerlink\" title=\"效果图\"></a>效果图</h2><p><a href=\"https://imgse.com/i/pPFthEF\"><img src=\"https://s1.ax1x.com/2023/08/04/pPFthEF.md.png\" alt=\"pPFthEF.md.png\"></a></p>\n<h2 id=\"html\"><a href=\"#html\" class=\"headerlink\" title=\"html\"></a>html</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;mark corner-o&quot;</span> &gt;</span></span><br><span class=\"line\">\t半导体</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span>  </span><br></pre></td></tr></table></figure>\n<h2 id=\"CSS\"><a href=\"#CSS\" class=\"headerlink\" title=\"CSS\"></a>CSS</h2><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.mark</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">float</span>: left;</span><br><span class=\"line\">\t\t<span class=\"attribute\">margin</span>: <span class=\"number\">0</span> <span class=\"number\">6</span>rpx;</span><br><span class=\"line\">\t\t<span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">\t\t<span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">width</span>: <span class=\"number\">24px</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">writing-mode</span>: sideways-rl;</span><br><span class=\"line\">\t\t<span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"selector-class\">.mark</span><span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">\t\t<span class=\"attribute\">content</span>: <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">top</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">border-style</span>: solid;</span><br><span class=\"line\">\t\t<span class=\"attribute\">border-width</span>: <span class=\"number\">0</span> <span class=\"number\">12px</span> <span class=\"number\">12px</span> <span class=\"number\">12px</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"selector-class\">.mark</span><span class=\"selector-class\">.corner-o</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">background</span>: <span class=\"number\">#ffaa00</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"selector-class\">.mark</span><span class=\"selector-class\">.corner-o</span><span class=\"selector-pseudo\">::after</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">border-color</span>: <span class=\"number\">#ffaa00</span> <span class=\"number\">#ffaa00</span> transparent <span class=\"number\">#ffaa00</span>;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n"},{"title":"仿CSDN实现添加可自定义标签","cover":"https://s1.ax1x.com/2023/08/04/pPFRbYn.jpg","_content":"\n>效果图\n\n[![pPFwee0.png](https://s1.ax1x.com/2023/08/04/pPFwee0.png)](https://imgse.com/i/pPFwee0)\n\n\n\n```html\n<view class=\"weui-cell weui-cell_active\">\n\t<view class=\"weui-cell__hd\"><label class=\"weui-label\">擅长领域</label></view>\n\t\t<view class=\"weui-cell__bd\">\n\t\t\t<view class=\"tagContainer\">\n\t\t\t\t<view class=\"tag-item\" v-bind:key=\"index\" v-for=\"(tagText,index) in tagList\">\n\t\t\t\t\t<text :data-text=\"tagText\">{{tagText}}</text>\n\t\t\t\t\t\t<text class=\"tagDelIcon\" @tap=\"delTag(tagText,index)\":data-text=\"tagText\">x</text>\n\t\t\t\t</view>\n\t\t\t<view class=\"tag-item add-tag\" @click=\"dialog = !dialog\">\n\t\t\t\t\t\t\t\t\t\t+标签\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</view>\n\n\n<view class=\"container\" v-if=\"dialog\">\n\t<view class=\"input-box\">\n\t\t<input class=\"uni-input\" placeholder=\"请输入文字搜索,回车可添加自定义标签\" @confirm=\"addTag\"v-model=\"tag\" placeholder-class=\"placeholder\" border @input=\"getTagListByName\">\n\t</view>\n\t<view class=\"tagContainer\">\n\t\t<view class=\"tag-item2\" :class=\"item.isSelected?'active':''\" v-bind:key=\"index\"\n\t\t\t\t\t\t\t\t\tv-for=\"(item,index) in tagArrList\" @click=\"tapTag2(item)\">\n\t\t\t<text :data-text=\"item.name\">{{item.name}}</text>\n\t\t</view>\n\t</view>\n</view>\n```\n\n```js\ndata(){\n\treturn{\n\t\ttagArrList: [],\n\t\tallTagList: [],\n\t\tdialog: false,\n\t\ttagList: [],\n\t}\n},\nonLoad(){\n\tthis.getTagList()\n},\nmethods:{\ngetTagListByName() {\n\tsetTimeout(() => {\n\t\tthis.tagArrList = this.allTagList.filter(r => {\n\t\t\treturn r.name.indexOf(this.tag) != -1\n\t\t})\n\t}, 300)\n\t},\n\taddTag() {\n\t\tif (this.tag !== '' && this.tagList.indexOf(this.tag) < 0) {\n\t\t\tthis.tagList.push(this.tag);\n\t\t\tthis.tag = ''\n\t\t}\n\t},\n\tdelTag(tagText, index) {\n\t\tthis.tagArrList.map((r, index) => {\n\t\t\tif (tagText == r.name) {\n\t\t\t\tr.isSelected = false;\n\t\t\t\treturn\n\t\t\t}\n\t\t})\n\t\tthis.tagList.splice(index, 1);\n\t},\n\ttapTag2(item) {\n\t\titem.isSelected = !item.isSelected;\n\t\tif (item.isSelected == true) {\n\t\t\tthis.tagList.push(item.name);\n\t\t} else {\n\t\t\tthis.tagList.map((r, index) => {\n\t\t\t\tif (item.name == r) {\n\t\t\t\t\tthis.tagList.splice(index, 1);\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\tgetTagList(){\n\t//查询   给tagArrList和allTagList赋值\n\t}\n\n}\n\n```\n\n```css\n.tagContainer {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tjustify-content: flex-start;\n\t}\n\n.tag-item,\n.tag-item2 {\n\tpadding: 10rpx 20rpx;\n\tmargin: 10rpx;\n\tborder-radius: 10rpx;\n\tcolor: white;\n\tbackground-color: #55aaff;\n\tfont-size: 22rpx;\n}\n\n.tag-item2 {\n\tbackground-color: #bedeff;\n}\n\n\n.add-tag {\n\tcolor: black;\n\tbackground-color: #ffffff;\n\tpadding: 10rpx 20rpx;\n\tborder-radius: 10rpx;\n\tfont-size: 20rpx;\n\tborder: 1px #000000 solid;\n}\n\n.tagDelIcon {\n\tpadding-left: 20rpx;\n}\n.input-box {\n\t\tmargin: 20rpx 10rpx;\n\t}\n.active {\n\t\tbackground-color: #55aaff;\n\t\tcolor: #ffffff;\n\t}\n```\n\n\n","source":"_posts/2.md","raw":"---\ntitle: 仿CSDN实现添加可自定义标签\ncategories: CSS小案例\ncover: https://s1.ax1x.com/2023/08/04/pPFRbYn.jpg\n---\n\n>效果图\n\n[![pPFwee0.png](https://s1.ax1x.com/2023/08/04/pPFwee0.png)](https://imgse.com/i/pPFwee0)\n\n\n\n```html\n<view class=\"weui-cell weui-cell_active\">\n\t<view class=\"weui-cell__hd\"><label class=\"weui-label\">擅长领域</label></view>\n\t\t<view class=\"weui-cell__bd\">\n\t\t\t<view class=\"tagContainer\">\n\t\t\t\t<view class=\"tag-item\" v-bind:key=\"index\" v-for=\"(tagText,index) in tagList\">\n\t\t\t\t\t<text :data-text=\"tagText\">{{tagText}}</text>\n\t\t\t\t\t\t<text class=\"tagDelIcon\" @tap=\"delTag(tagText,index)\":data-text=\"tagText\">x</text>\n\t\t\t\t</view>\n\t\t\t<view class=\"tag-item add-tag\" @click=\"dialog = !dialog\">\n\t\t\t\t\t\t\t\t\t\t+标签\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</view>\n\n\n<view class=\"container\" v-if=\"dialog\">\n\t<view class=\"input-box\">\n\t\t<input class=\"uni-input\" placeholder=\"请输入文字搜索,回车可添加自定义标签\" @confirm=\"addTag\"v-model=\"tag\" placeholder-class=\"placeholder\" border @input=\"getTagListByName\">\n\t</view>\n\t<view class=\"tagContainer\">\n\t\t<view class=\"tag-item2\" :class=\"item.isSelected?'active':''\" v-bind:key=\"index\"\n\t\t\t\t\t\t\t\t\tv-for=\"(item,index) in tagArrList\" @click=\"tapTag2(item)\">\n\t\t\t<text :data-text=\"item.name\">{{item.name}}</text>\n\t\t</view>\n\t</view>\n</view>\n```\n\n```js\ndata(){\n\treturn{\n\t\ttagArrList: [],\n\t\tallTagList: [],\n\t\tdialog: false,\n\t\ttagList: [],\n\t}\n},\nonLoad(){\n\tthis.getTagList()\n},\nmethods:{\ngetTagListByName() {\n\tsetTimeout(() => {\n\t\tthis.tagArrList = this.allTagList.filter(r => {\n\t\t\treturn r.name.indexOf(this.tag) != -1\n\t\t})\n\t}, 300)\n\t},\n\taddTag() {\n\t\tif (this.tag !== '' && this.tagList.indexOf(this.tag) < 0) {\n\t\t\tthis.tagList.push(this.tag);\n\t\t\tthis.tag = ''\n\t\t}\n\t},\n\tdelTag(tagText, index) {\n\t\tthis.tagArrList.map((r, index) => {\n\t\t\tif (tagText == r.name) {\n\t\t\t\tr.isSelected = false;\n\t\t\t\treturn\n\t\t\t}\n\t\t})\n\t\tthis.tagList.splice(index, 1);\n\t},\n\ttapTag2(item) {\n\t\titem.isSelected = !item.isSelected;\n\t\tif (item.isSelected == true) {\n\t\t\tthis.tagList.push(item.name);\n\t\t} else {\n\t\t\tthis.tagList.map((r, index) => {\n\t\t\t\tif (item.name == r) {\n\t\t\t\t\tthis.tagList.splice(index, 1);\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\tgetTagList(){\n\t//查询   给tagArrList和allTagList赋值\n\t}\n\n}\n\n```\n\n```css\n.tagContainer {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tjustify-content: flex-start;\n\t}\n\n.tag-item,\n.tag-item2 {\n\tpadding: 10rpx 20rpx;\n\tmargin: 10rpx;\n\tborder-radius: 10rpx;\n\tcolor: white;\n\tbackground-color: #55aaff;\n\tfont-size: 22rpx;\n}\n\n.tag-item2 {\n\tbackground-color: #bedeff;\n}\n\n\n.add-tag {\n\tcolor: black;\n\tbackground-color: #ffffff;\n\tpadding: 10rpx 20rpx;\n\tborder-radius: 10rpx;\n\tfont-size: 20rpx;\n\tborder: 1px #000000 solid;\n}\n\n.tagDelIcon {\n\tpadding-left: 20rpx;\n}\n.input-box {\n\t\tmargin: 20rpx 10rpx;\n\t}\n.active {\n\t\tbackground-color: #55aaff;\n\t\tcolor: #ffffff;\n\t}\n```\n\n\n","slug":"2","published":1,"date":"2023-08-07T02:04:35.900Z","updated":"2023-08-04T06:38:30.728Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll0f74rx00033gs42w1e5k8k","content":"<blockquote>\n<p>效果图</p>\n</blockquote>\n<p><a href=\"https://imgse.com/i/pPFwee0\"><img src=\"https://s1.ax1x.com/2023/08/04/pPFwee0.png\" alt=\"pPFwee0.png\"></a></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;weui-cell weui-cell_active&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;weui-cell__hd&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;weui-label&quot;</span>&gt;</span>擅长领域<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;weui-cell__bd&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;tagContainer&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;tag-item&quot;</span> <span class=\"attr\">v-bind:key</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(tagText,index) in tagList&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">:data-text</span>=<span class=\"string\">&quot;tagText&quot;</span>&gt;</span>&#123;&#123;tagText&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;tagDelIcon&quot;</span> @<span class=\"attr\">tap</span>=<span class=\"string\">&quot;delTag(tagText,index)&quot;</span><span class=\"attr\">:data-text</span>=<span class=\"string\">&quot;tagText&quot;</span>&gt;</span>x<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;tag-item add-tag&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;dialog = !dialog&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t+标签</span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&quot;dialog&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;input-box&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;uni-input&quot;</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">&quot;请输入文字搜索,回车可添加自定义标签&quot;</span> @<span class=\"attr\">confirm</span>=<span class=\"string\">&quot;addTag&quot;</span><span class=\"attr\">v-model</span>=<span class=\"string\">&quot;tag&quot;</span> <span class=\"attr\">placeholder-class</span>=<span class=\"string\">&quot;placeholder&quot;</span> <span class=\"attr\">border</span> @<span class=\"attr\">input</span>=<span class=\"string\">&quot;getTagListByName&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;tagContainer&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;tag-item2&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;item.isSelected?&#x27;active&#x27;:&#x27;&#x27;&quot;</span> <span class=\"attr\">v-bind:key</span>=<span class=\"string\">&quot;index&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t\t\t\t\t\t\t\t<span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item,index) in tagArrList&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;tapTag2(item)&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">:data-text</span>=<span class=\"string\">&quot;item.name&quot;</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">tagArrList</span>: [],</span><br><span class=\"line\">\t\t<span class=\"attr\">allTagList</span>: [],</span><br><span class=\"line\">\t\t<span class=\"attr\">dialog</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">tagList</span>: [],</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"><span class=\"title function_\">onLoad</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">this</span>.<span class=\"title function_\">getTagList</span>()</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"><span class=\"attr\">methods</span>:&#123;</span><br><span class=\"line\"><span class=\"title function_\">getTagListByName</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t<span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagArrList</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">allTagList</span>.<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">r</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> r.<span class=\"property\">name</span>.<span class=\"title function_\">indexOf</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">tag</span>) != -<span class=\"number\">1</span></span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;, <span class=\"number\">300</span>)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"title function_\">addTag</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">tag</span> !== <span class=\"string\">&#x27;&#x27;</span> &amp;&amp; <span class=\"variable language_\">this</span>.<span class=\"property\">tagList</span>.<span class=\"title function_\">indexOf</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">tag</span>) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagList</span>.<span class=\"title function_\">push</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">tag</span>);</span><br><span class=\"line\">\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tag</span> = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"title function_\">delTag</span>(<span class=\"params\">tagText, index</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagArrList</span>.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">r, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (tagText == r.<span class=\"property\">name</span>) &#123;</span><br><span class=\"line\">\t\t\t\tr.<span class=\"property\">isSelected</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagList</span>.<span class=\"title function_\">splice</span>(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"title function_\">tapTag2</span>(<span class=\"params\">item</span>) &#123;</span><br><span class=\"line\">\t\titem.<span class=\"property\">isSelected</span> = !item.<span class=\"property\">isSelected</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (item.<span class=\"property\">isSelected</span> == <span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagList</span>.<span class=\"title function_\">push</span>(item.<span class=\"property\">name</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagList</span>.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">r, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (item.<span class=\"property\">name</span> == r) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagList</span>.<span class=\"title function_\">splice</span>(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"title function_\">getTagList</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//查询   给tagArrList和allTagList赋值</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.tagContainer</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">\t\t<span class=\"attribute\">flex-wrap</span>: wrap;</span><br><span class=\"line\">\t\t<span class=\"attribute\">justify-content</span>: flex-start;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.tag-item</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.tag-item2</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">padding</span>: <span class=\"number\">10</span>rpx <span class=\"number\">20</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">margin</span>: <span class=\"number\">10</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">border-radius</span>: <span class=\"number\">10</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>: white;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"number\">#55aaff</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">22</span>rpx;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.tag-item2</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"number\">#bedeff</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.add-tag</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>: black;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"number\">#ffffff</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">padding</span>: <span class=\"number\">10</span>rpx <span class=\"number\">20</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">border-radius</span>: <span class=\"number\">10</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">20</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">border</span>: <span class=\"number\">1px</span> <span class=\"number\">#000000</span> solid;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.tagDelIcon</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">padding-left</span>: <span class=\"number\">20</span>rpx;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.input-box</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">margin</span>: <span class=\"number\">20</span>rpx <span class=\"number\">10</span>rpx;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.active</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">background-color</span>: <span class=\"number\">#55aaff</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span>;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<blockquote>\n<p>效果图</p>\n</blockquote>\n<p><a href=\"https://imgse.com/i/pPFwee0\"><img src=\"https://s1.ax1x.com/2023/08/04/pPFwee0.png\" alt=\"pPFwee0.png\"></a></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;weui-cell weui-cell_active&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;weui-cell__hd&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;weui-label&quot;</span>&gt;</span>擅长领域<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;weui-cell__bd&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;tagContainer&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;tag-item&quot;</span> <span class=\"attr\">v-bind:key</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(tagText,index) in tagList&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">:data-text</span>=<span class=\"string\">&quot;tagText&quot;</span>&gt;</span>&#123;&#123;tagText&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;tagDelIcon&quot;</span> @<span class=\"attr\">tap</span>=<span class=\"string\">&quot;delTag(tagText,index)&quot;</span><span class=\"attr\">:data-text</span>=<span class=\"string\">&quot;tagText&quot;</span>&gt;</span>x<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;tag-item add-tag&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;dialog = !dialog&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t+标签</span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&quot;dialog&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;input-box&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;uni-input&quot;</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">&quot;请输入文字搜索,回车可添加自定义标签&quot;</span> @<span class=\"attr\">confirm</span>=<span class=\"string\">&quot;addTag&quot;</span><span class=\"attr\">v-model</span>=<span class=\"string\">&quot;tag&quot;</span> <span class=\"attr\">placeholder-class</span>=<span class=\"string\">&quot;placeholder&quot;</span> <span class=\"attr\">border</span> @<span class=\"attr\">input</span>=<span class=\"string\">&quot;getTagListByName&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;tagContainer&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;tag-item2&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;item.isSelected?&#x27;active&#x27;:&#x27;&#x27;&quot;</span> <span class=\"attr\">v-bind:key</span>=<span class=\"string\">&quot;index&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t\t\t\t\t\t\t\t<span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item,index) in tagArrList&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;tapTag2(item)&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">:data-text</span>=<span class=\"string\">&quot;item.name&quot;</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">tagArrList</span>: [],</span><br><span class=\"line\">\t\t<span class=\"attr\">allTagList</span>: [],</span><br><span class=\"line\">\t\t<span class=\"attr\">dialog</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">tagList</span>: [],</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"><span class=\"title function_\">onLoad</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">this</span>.<span class=\"title function_\">getTagList</span>()</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"><span class=\"attr\">methods</span>:&#123;</span><br><span class=\"line\"><span class=\"title function_\">getTagListByName</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t<span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagArrList</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">allTagList</span>.<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">r</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> r.<span class=\"property\">name</span>.<span class=\"title function_\">indexOf</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">tag</span>) != -<span class=\"number\">1</span></span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;, <span class=\"number\">300</span>)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"title function_\">addTag</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">tag</span> !== <span class=\"string\">&#x27;&#x27;</span> &amp;&amp; <span class=\"variable language_\">this</span>.<span class=\"property\">tagList</span>.<span class=\"title function_\">indexOf</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">tag</span>) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagList</span>.<span class=\"title function_\">push</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">tag</span>);</span><br><span class=\"line\">\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tag</span> = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"title function_\">delTag</span>(<span class=\"params\">tagText, index</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagArrList</span>.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">r, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (tagText == r.<span class=\"property\">name</span>) &#123;</span><br><span class=\"line\">\t\t\t\tr.<span class=\"property\">isSelected</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagList</span>.<span class=\"title function_\">splice</span>(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"title function_\">tapTag2</span>(<span class=\"params\">item</span>) &#123;</span><br><span class=\"line\">\t\titem.<span class=\"property\">isSelected</span> = !item.<span class=\"property\">isSelected</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (item.<span class=\"property\">isSelected</span> == <span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagList</span>.<span class=\"title function_\">push</span>(item.<span class=\"property\">name</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagList</span>.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">r, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (item.<span class=\"property\">name</span> == r) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">tagList</span>.<span class=\"title function_\">splice</span>(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"title function_\">getTagList</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//查询   给tagArrList和allTagList赋值</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.tagContainer</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">\t\t<span class=\"attribute\">flex-wrap</span>: wrap;</span><br><span class=\"line\">\t\t<span class=\"attribute\">justify-content</span>: flex-start;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.tag-item</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.tag-item2</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">padding</span>: <span class=\"number\">10</span>rpx <span class=\"number\">20</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">margin</span>: <span class=\"number\">10</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">border-radius</span>: <span class=\"number\">10</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>: white;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"number\">#55aaff</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">22</span>rpx;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.tag-item2</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"number\">#bedeff</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.add-tag</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>: black;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"number\">#ffffff</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">padding</span>: <span class=\"number\">10</span>rpx <span class=\"number\">20</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">border-radius</span>: <span class=\"number\">10</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">20</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">border</span>: <span class=\"number\">1px</span> <span class=\"number\">#000000</span> solid;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.tagDelIcon</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">padding-left</span>: <span class=\"number\">20</span>rpx;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.input-box</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">margin</span>: <span class=\"number\">20</span>rpx <span class=\"number\">10</span>rpx;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.active</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">background-color</span>: <span class=\"number\">#55aaff</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span>;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n\n"},{"title":"js日期格式相关","cover":"https://s1.ax1x.com/2023/08/07/pPEeItP.png","_content":"##### 一般的格式化\n```js\n//年-月-日 时:分:秒\n const dateFormatter = (e)=> {\n\treturn `${e.getFullYear()}-${e.getMonth() + 1 < 10? \"0\" + (e.getMonth() + 1): e.getMonth() + 1\n\t\t\t\t}-${e.getDate() < 10 ? \"0\" + e.getDate() : e.getDate()} ${e.getHours() < 10 ? \"0\" + e.getHours() : e.getHours()}:${e.getMinutes() < 10 ? \"0\" + e.getMinutes() : e.getMinutes()}`;\n}\n```\n##### 判断时间差是否在范围内\n```js\nconst isWithinSomeHours = (timestamp1, timestamp2, hour) => {\n\tvar millisecondsPerHour = 60 * 60 * 1000; // 一小时的毫秒数\n\tvar timeDiff = Math.abs(timestamp1 - timestamp2); // 两个时间戳的毫秒数差值\n\tvar diffHours = Math.floor(timeDiff / millisecondsPerHour); // 相差的小时数\n\treturn diffHours <= hour;\n}\n```\n##### 时间戳转时间格式(时：分)\n```js\nconst timestampToTime = (timestamp) => {\n\tvar date = new Date(timestamp * 1000);\n\tvar hours = date.getHours();\n\tvar minutes = date.getMinutes();\n\t// 为了输出统一的格式，如：08:30\n\tif (hours < 10) {\n\t\thours = \"0\" + hours;\n\t}\n\tif (minutes < 10) {\n\t\tminutes = \"0\" + minutes;\n\t}\n\treturn hours + \":\" + minutes;\n}\n```\n##### 转成指定格式  7/26 星期三 09：31\n```js\nconst getWeekDate = () => {\n\tconst date = new Date()\n\tconst month = date.getMonth() + 1;\n\tconst day = date.getDate();\n\n\tconst weekdays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];\n\tconst weekday = weekdays[date.getDay()];\n\n\tconst hours = date.getHours();\n\tconst minutes = date.getMinutes();\n\n\tconst formattedDate = `${month}/${day}`;\n\tconst formattedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n\n\treturn `${formattedDate} ${weekday} ${formattedTime}`;\n}\n```","source":"_posts/10.md","raw":"---\ntitle: js日期格式相关\ncategories: JS小方法\ncover: https://s1.ax1x.com/2023/08/07/pPEeItP.png\n---\n##### 一般的格式化\n```js\n//年-月-日 时:分:秒\n const dateFormatter = (e)=> {\n\treturn `${e.getFullYear()}-${e.getMonth() + 1 < 10? \"0\" + (e.getMonth() + 1): e.getMonth() + 1\n\t\t\t\t}-${e.getDate() < 10 ? \"0\" + e.getDate() : e.getDate()} ${e.getHours() < 10 ? \"0\" + e.getHours() : e.getHours()}:${e.getMinutes() < 10 ? \"0\" + e.getMinutes() : e.getMinutes()}`;\n}\n```\n##### 判断时间差是否在范围内\n```js\nconst isWithinSomeHours = (timestamp1, timestamp2, hour) => {\n\tvar millisecondsPerHour = 60 * 60 * 1000; // 一小时的毫秒数\n\tvar timeDiff = Math.abs(timestamp1 - timestamp2); // 两个时间戳的毫秒数差值\n\tvar diffHours = Math.floor(timeDiff / millisecondsPerHour); // 相差的小时数\n\treturn diffHours <= hour;\n}\n```\n##### 时间戳转时间格式(时：分)\n```js\nconst timestampToTime = (timestamp) => {\n\tvar date = new Date(timestamp * 1000);\n\tvar hours = date.getHours();\n\tvar minutes = date.getMinutes();\n\t// 为了输出统一的格式，如：08:30\n\tif (hours < 10) {\n\t\thours = \"0\" + hours;\n\t}\n\tif (minutes < 10) {\n\t\tminutes = \"0\" + minutes;\n\t}\n\treturn hours + \":\" + minutes;\n}\n```\n##### 转成指定格式  7/26 星期三 09：31\n```js\nconst getWeekDate = () => {\n\tconst date = new Date()\n\tconst month = date.getMonth() + 1;\n\tconst day = date.getDate();\n\n\tconst weekdays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];\n\tconst weekday = weekdays[date.getDay()];\n\n\tconst hours = date.getHours();\n\tconst minutes = date.getMinutes();\n\n\tconst formattedDate = `${month}/${day}`;\n\tconst formattedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n\n\treturn `${formattedDate} ${weekday} ${formattedTime}`;\n}\n```","slug":"10","published":1,"date":"2023-08-07T02:04:35.900Z","updated":"2023-08-07T01:42:08.273Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll0f74s200053gs48h2ydkds","content":"<h5 id=\"一般的格式化\"><a href=\"#一般的格式化\" class=\"headerlink\" title=\"一般的格式化\"></a>一般的格式化</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//年-月-日 时:分:秒</span></span><br><span class=\"line\"> <span class=\"keyword\">const</span> <span class=\"title function_\">dateFormatter</span> = (<span class=\"params\">e</span>)=&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;e.getFullYear()&#125;</span>-<span class=\"subst\">$&#123;e.getMonth() + <span class=\"number\">1</span> &lt; <span class=\"number\">10</span>? <span class=\"string\">&quot;0&quot;</span> + (e.getMonth() + <span class=\"number\">1</span>): e.getMonth() + <span class=\"number\">1</span></span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">\t\t\t\t&#125;</span>-<span class=\"subst\">$&#123;e.getDate() &lt; <span class=\"number\">10</span> ? <span class=\"string\">&quot;0&quot;</span> + e.getDate() : e.getDate()&#125;</span> <span class=\"subst\">$&#123;e.getHours() &lt; <span class=\"number\">10</span> ? <span class=\"string\">&quot;0&quot;</span> + e.getHours() : e.getHours()&#125;</span>:<span class=\"subst\">$&#123;e.getMinutes() &lt; <span class=\"number\">10</span> ? <span class=\"string\">&quot;0&quot;</span> + e.getMinutes() : e.getMinutes()&#125;</span>`</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"判断时间差是否在范围内\"><a href=\"#判断时间差是否在范围内\" class=\"headerlink\" title=\"判断时间差是否在范围内\"></a>判断时间差是否在范围内</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">isWithinSomeHours</span> = (<span class=\"params\">timestamp1, timestamp2, hour</span>) =&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> millisecondsPerHour = <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">1000</span>; <span class=\"comment\">// 一小时的毫秒数</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> timeDiff = <span class=\"title class_\">Math</span>.<span class=\"title function_\">abs</span>(timestamp1 - timestamp2); <span class=\"comment\">// 两个时间戳的毫秒数差值</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> diffHours = <span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(timeDiff / millisecondsPerHour); <span class=\"comment\">// 相差的小时数</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> diffHours &lt;= hour;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"时间戳转时间格式-时：分\"><a href=\"#时间戳转时间格式-时：分\" class=\"headerlink\" title=\"时间戳转时间格式(时：分)\"></a>时间戳转时间格式(时：分)</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">timestampToTime</span> = (<span class=\"params\">timestamp</span>) =&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(timestamp * <span class=\"number\">1000</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> hours = date.<span class=\"title function_\">getHours</span>();</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> minutes = date.<span class=\"title function_\">getMinutes</span>();</span><br><span class=\"line\">\t<span class=\"comment\">// 为了输出统一的格式，如：08:30</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (hours &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">\t\thours = <span class=\"string\">&quot;0&quot;</span> + hours;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (minutes &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">\t\tminutes = <span class=\"string\">&quot;0&quot;</span> + minutes;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> hours + <span class=\"string\">&quot;:&quot;</span> + minutes;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"转成指定格式-7-26-星期三-09：31\"><a href=\"#转成指定格式-7-26-星期三-09：31\" class=\"headerlink\" title=\"转成指定格式  7&#x2F;26 星期三 09：31\"></a>转成指定格式  7&#x2F;26 星期三 09：31</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getWeekDate</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> date = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> month = date.<span class=\"title function_\">getMonth</span>() + <span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> day = date.<span class=\"title function_\">getDate</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> weekdays = [<span class=\"string\">&#x27;星期日&#x27;</span>, <span class=\"string\">&#x27;星期一&#x27;</span>, <span class=\"string\">&#x27;星期二&#x27;</span>, <span class=\"string\">&#x27;星期三&#x27;</span>, <span class=\"string\">&#x27;星期四&#x27;</span>, <span class=\"string\">&#x27;星期五&#x27;</span>, <span class=\"string\">&#x27;星期六&#x27;</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> weekday = weekdays[date.<span class=\"title function_\">getDay</span>()];</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> hours = date.<span class=\"title function_\">getHours</span>();</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> minutes = date.<span class=\"title function_\">getMinutes</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> formattedDate = <span class=\"string\">`<span class=\"subst\">$&#123;month&#125;</span>/<span class=\"subst\">$&#123;day&#125;</span>`</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> formattedTime = <span class=\"string\">`<span class=\"subst\">$&#123;hours.toString().padStart(<span class=\"number\">2</span>, <span class=\"string\">&#x27;0&#x27;</span>)&#125;</span>:<span class=\"subst\">$&#123;minutes.toString().padStart(<span class=\"number\">2</span>, <span class=\"string\">&#x27;0&#x27;</span>)&#125;</span>`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;formattedDate&#125;</span> <span class=\"subst\">$&#123;weekday&#125;</span> <span class=\"subst\">$&#123;formattedTime&#125;</span>`</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<h5 id=\"一般的格式化\"><a href=\"#一般的格式化\" class=\"headerlink\" title=\"一般的格式化\"></a>一般的格式化</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//年-月-日 时:分:秒</span></span><br><span class=\"line\"> <span class=\"keyword\">const</span> <span class=\"title function_\">dateFormatter</span> = (<span class=\"params\">e</span>)=&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;e.getFullYear()&#125;</span>-<span class=\"subst\">$&#123;e.getMonth() + <span class=\"number\">1</span> &lt; <span class=\"number\">10</span>? <span class=\"string\">&quot;0&quot;</span> + (e.getMonth() + <span class=\"number\">1</span>): e.getMonth() + <span class=\"number\">1</span></span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">\t\t\t\t&#125;</span>-<span class=\"subst\">$&#123;e.getDate() &lt; <span class=\"number\">10</span> ? <span class=\"string\">&quot;0&quot;</span> + e.getDate() : e.getDate()&#125;</span> <span class=\"subst\">$&#123;e.getHours() &lt; <span class=\"number\">10</span> ? <span class=\"string\">&quot;0&quot;</span> + e.getHours() : e.getHours()&#125;</span>:<span class=\"subst\">$&#123;e.getMinutes() &lt; <span class=\"number\">10</span> ? <span class=\"string\">&quot;0&quot;</span> + e.getMinutes() : e.getMinutes()&#125;</span>`</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"判断时间差是否在范围内\"><a href=\"#判断时间差是否在范围内\" class=\"headerlink\" title=\"判断时间差是否在范围内\"></a>判断时间差是否在范围内</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">isWithinSomeHours</span> = (<span class=\"params\">timestamp1, timestamp2, hour</span>) =&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> millisecondsPerHour = <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">1000</span>; <span class=\"comment\">// 一小时的毫秒数</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> timeDiff = <span class=\"title class_\">Math</span>.<span class=\"title function_\">abs</span>(timestamp1 - timestamp2); <span class=\"comment\">// 两个时间戳的毫秒数差值</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> diffHours = <span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(timeDiff / millisecondsPerHour); <span class=\"comment\">// 相差的小时数</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> diffHours &lt;= hour;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"时间戳转时间格式-时：分\"><a href=\"#时间戳转时间格式-时：分\" class=\"headerlink\" title=\"时间戳转时间格式(时：分)\"></a>时间戳转时间格式(时：分)</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">timestampToTime</span> = (<span class=\"params\">timestamp</span>) =&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(timestamp * <span class=\"number\">1000</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> hours = date.<span class=\"title function_\">getHours</span>();</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> minutes = date.<span class=\"title function_\">getMinutes</span>();</span><br><span class=\"line\">\t<span class=\"comment\">// 为了输出统一的格式，如：08:30</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (hours &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">\t\thours = <span class=\"string\">&quot;0&quot;</span> + hours;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (minutes &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">\t\tminutes = <span class=\"string\">&quot;0&quot;</span> + minutes;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> hours + <span class=\"string\">&quot;:&quot;</span> + minutes;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"转成指定格式-7-26-星期三-09：31\"><a href=\"#转成指定格式-7-26-星期三-09：31\" class=\"headerlink\" title=\"转成指定格式  7&#x2F;26 星期三 09：31\"></a>转成指定格式  7&#x2F;26 星期三 09：31</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getWeekDate</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> date = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> month = date.<span class=\"title function_\">getMonth</span>() + <span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> day = date.<span class=\"title function_\">getDate</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> weekdays = [<span class=\"string\">&#x27;星期日&#x27;</span>, <span class=\"string\">&#x27;星期一&#x27;</span>, <span class=\"string\">&#x27;星期二&#x27;</span>, <span class=\"string\">&#x27;星期三&#x27;</span>, <span class=\"string\">&#x27;星期四&#x27;</span>, <span class=\"string\">&#x27;星期五&#x27;</span>, <span class=\"string\">&#x27;星期六&#x27;</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> weekday = weekdays[date.<span class=\"title function_\">getDay</span>()];</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> hours = date.<span class=\"title function_\">getHours</span>();</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> minutes = date.<span class=\"title function_\">getMinutes</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> formattedDate = <span class=\"string\">`<span class=\"subst\">$&#123;month&#125;</span>/<span class=\"subst\">$&#123;day&#125;</span>`</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> formattedTime = <span class=\"string\">`<span class=\"subst\">$&#123;hours.toString().padStart(<span class=\"number\">2</span>, <span class=\"string\">&#x27;0&#x27;</span>)&#125;</span>:<span class=\"subst\">$&#123;minutes.toString().padStart(<span class=\"number\">2</span>, <span class=\"string\">&#x27;0&#x27;</span>)&#125;</span>`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;formattedDate&#125;</span> <span class=\"subst\">$&#123;weekday&#125;</span> <span class=\"subst\">$&#123;formattedTime&#125;</span>`</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"css 在div左上角添加标记","cover":"https://s1.ax1x.com/2023/08/04/pPFROS0.jpg","_content":"\n效果图：\n[![pPFWPYR.png](https://s1.ax1x.com/2023/08/04/pPFWPYR.png)](https://imgse.com/i/pPFWPYR)\n```html\n<div class='wrapp'>\n\t\t<div class='ribbon'>\n\t\t\t<span>当前工单</span>\n\t\t</div>\n\t\t<div class=\"planBox\">\n\t\t\t<div class=\"item\">\n\t\t\t\t<div class=\"\">xxx</div>\n\t\t\t\t<div class=\"\">xxx</div>\n\t\t\t</div>\n\t\t\t<div class=\"item\">\n\t\t\t\t<div class=\"\">xxx</div>\n\t\t\t\t<div class=\"\">xxx</div>\n\t\t\t </div>\n\t\t</div>\n</div>\n```\t\t\t\t\n\n```css\n.wrapp {\n\t\tposition: relative;\n\t\toverflow: hidden;\n\t\tbackground-color: #E7F1FF;\n}\n\n.planBox {\n\t\tdisplay: flex;\n\t\tmargin: 1vh 4vw;\n\t\tpadding: 10px;\n}\n\n.item {\n\t\tflex: 1;\n}\n\n.ribbon {\n\t\tbackground-color: #1890FF;\n\t\toverflow: hidden;\n\t\twhite-space: nowrap;\n\t\tposition: absolute;\n\t\tleft: -55px;  // 根据实际调整即可\n\t\ttop: 17px;   // 根据实际调整即可\n\t\ttransform: rotate(-45deg);\n\t\tbox-shadow: 0 0 10px #888;\n\n\t\tspan {\n\t\t\tcolor: #fff;\n\t\t\tpadding: 5px 50px;\n\t\t\tdisplay: block;\n\t\t}\n}\n\n","source":"_posts/3.md","raw":"\n---\ntitle: css 在div左上角添加标记\ncategories: CSS小案例\ncover: https://s1.ax1x.com/2023/08/04/pPFROS0.jpg\n---\n\n效果图：\n[![pPFWPYR.png](https://s1.ax1x.com/2023/08/04/pPFWPYR.png)](https://imgse.com/i/pPFWPYR)\n```html\n<div class='wrapp'>\n\t\t<div class='ribbon'>\n\t\t\t<span>当前工单</span>\n\t\t</div>\n\t\t<div class=\"planBox\">\n\t\t\t<div class=\"item\">\n\t\t\t\t<div class=\"\">xxx</div>\n\t\t\t\t<div class=\"\">xxx</div>\n\t\t\t</div>\n\t\t\t<div class=\"item\">\n\t\t\t\t<div class=\"\">xxx</div>\n\t\t\t\t<div class=\"\">xxx</div>\n\t\t\t </div>\n\t\t</div>\n</div>\n```\t\t\t\t\n\n```css\n.wrapp {\n\t\tposition: relative;\n\t\toverflow: hidden;\n\t\tbackground-color: #E7F1FF;\n}\n\n.planBox {\n\t\tdisplay: flex;\n\t\tmargin: 1vh 4vw;\n\t\tpadding: 10px;\n}\n\n.item {\n\t\tflex: 1;\n}\n\n.ribbon {\n\t\tbackground-color: #1890FF;\n\t\toverflow: hidden;\n\t\twhite-space: nowrap;\n\t\tposition: absolute;\n\t\tleft: -55px;  // 根据实际调整即可\n\t\ttop: 17px;   // 根据实际调整即可\n\t\ttransform: rotate(-45deg);\n\t\tbox-shadow: 0 0 10px #888;\n\n\t\tspan {\n\t\t\tcolor: #fff;\n\t\t\tpadding: 5px 50px;\n\t\t\tdisplay: block;\n\t\t}\n}\n\n","slug":"3","published":1,"date":"2023-08-07T02:04:35.904Z","updated":"2023-08-07T00:47:12.530Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll0f74s300063gs43ujodege","content":"<p>效果图：<br><a href=\"https://imgse.com/i/pPFWPYR\"><img src=\"https://s1.ax1x.com/2023/08/04/pPFWPYR.png\" alt=\"pPFWPYR.png\"></a></p>\n<pre><code class=\"html\">&lt;div class=&#39;wrapp&#39;&gt;\n        &lt;div class=&#39;ribbon&#39;&gt;\n            &lt;span&gt;当前工单&lt;/span&gt;\n        &lt;/div&gt;\n        &lt;div class=&quot;planBox&quot;&gt;\n            &lt;div class=&quot;item&quot;&gt;\n                &lt;div class=&quot;&quot;&gt;xxx&lt;/div&gt;\n                &lt;div class=&quot;&quot;&gt;xxx&lt;/div&gt;\n            &lt;/div&gt;\n            &lt;div class=&quot;item&quot;&gt;\n                &lt;div class=&quot;&quot;&gt;xxx&lt;/div&gt;\n                &lt;div class=&quot;&quot;&gt;xxx&lt;/div&gt;\n             &lt;/div&gt;\n        &lt;/div&gt;\n&lt;/div&gt;\n```\t\t\t\t\n\n```css\n.wrapp &#123;\n        position: relative;\n        overflow: hidden;\n        background-color: #E7F1FF;\n&#125;\n\n.planBox &#123;\n        display: flex;\n        margin: 1vh 4vw;\n        padding: 10px;\n&#125;\n\n.item &#123;\n        flex: 1;\n&#125;\n\n.ribbon &#123;\n        background-color: #1890FF;\n        overflow: hidden;\n        white-space: nowrap;\n        position: absolute;\n        left: -55px;  // 根据实际调整即可\n        top: 17px;   // 根据实际调整即可\n        transform: rotate(-45deg);\n        box-shadow: 0 0 10px #888;\n\n        span &#123;\n            color: #fff;\n            padding: 5px 50px;\n            display: block;\n        &#125;\n&#125;\n</code></pre>\n","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<p>效果图：<br><a href=\"https://imgse.com/i/pPFWPYR\"><img src=\"https://s1.ax1x.com/2023/08/04/pPFWPYR.png\" alt=\"pPFWPYR.png\"></a></p>\n<pre><code class=\"html\">&lt;div class=&#39;wrapp&#39;&gt;\n        &lt;div class=&#39;ribbon&#39;&gt;\n            &lt;span&gt;当前工单&lt;/span&gt;\n        &lt;/div&gt;\n        &lt;div class=&quot;planBox&quot;&gt;\n            &lt;div class=&quot;item&quot;&gt;\n                &lt;div class=&quot;&quot;&gt;xxx&lt;/div&gt;\n                &lt;div class=&quot;&quot;&gt;xxx&lt;/div&gt;\n            &lt;/div&gt;\n            &lt;div class=&quot;item&quot;&gt;\n                &lt;div class=&quot;&quot;&gt;xxx&lt;/div&gt;\n                &lt;div class=&quot;&quot;&gt;xxx&lt;/div&gt;\n             &lt;/div&gt;\n        &lt;/div&gt;\n&lt;/div&gt;\n```\t\t\t\t\n\n```css\n.wrapp &#123;\n        position: relative;\n        overflow: hidden;\n        background-color: #E7F1FF;\n&#125;\n\n.planBox &#123;\n        display: flex;\n        margin: 1vh 4vw;\n        padding: 10px;\n&#125;\n\n.item &#123;\n        flex: 1;\n&#125;\n\n.ribbon &#123;\n        background-color: #1890FF;\n        overflow: hidden;\n        white-space: nowrap;\n        position: absolute;\n        left: -55px;  // 根据实际调整即可\n        top: 17px;   // 根据实际调整即可\n        transform: rotate(-45deg);\n        box-shadow: 0 0 10px #888;\n\n        span &#123;\n            color: #fff;\n            padding: 5px 50px;\n            display: block;\n        &#125;\n&#125;\n</code></pre>\n"},{"title":"vue实现点击选中div后,右下角显示对号√","cover":"https://s1.ax1x.com/2023/08/04/pPFRXlV.jpg","_content":"\n\n\n\n\n# vue 实现点击选中div 右下角显示对号√\n\n效果图：\n\n[![pPFrLr9.png](https://s1.ax1x.com/2023/08/04/pPFrLr9.png)](https://imgse.com/i/pPFrLr9)\n\n\n\n```html\n<div class=\"\" style=\"display: flex;\">\n\t<div class=\"item\" :class=\"activeKey === 0 ? 'select' : ''\" @click=\"activeKey = 0\">\n\t\t\t<div class=\"shift\">\n\t\t\t\t早班 8：00 - 20：00\n\t\t\t</div>\n\t\t\t<div class=\"\">\n\t\t\t\t2022年07月18日\n\t\t\t</div>\n\t</div>\n\t<div class=\"item\" :class=\"activeKey === 1 ? 'select' : ''\" @click=\"activeKey = 1\">\n\t\t<div class=\"shift\">\n\t\t\t晚班 20：00 - 8：00\n\t\t</div>\n\t\t<div class=\"\">\n\t\t\t2022年07月18日\n\t\t</div>\n\t</div>\n</div>\n```\n\n```css\n.item {\n\t\tborder: 1px #AAAAAA solid;\n\t\tpadding: 1vh 1vw;\n\t\tborder-radius: 5px;\n\t\tmargin: 1vh 1vw;\n\t}\n\n\t.shift {\n\t\tfont-weight: 600;\n\t\tmargin-bottom: 10px;\n\t}\n\n\t.select {\n\t\tposition: relative;\n\t\ttext-align: left;\n\t\tcolor: #00aaff;\n\t\tbackground-color: #fff;\n\t\tbox-shadow: 0px 2px 7px 0px rgba(85, 110, 97, 0.35);\n\t\tborder-radius: 5px;\n\t\tborder: 1px solid #00aaff;\n\t}\n\n\t.select:before {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tborder: 10px solid #00aaff;\n\t\tborder-top-color: transparent;\n\t\tborder-left-color: transparent;\n\t}\n\n\t.select:after {\n\t\tcontent: '';\n\t\twidth: 4px;\n\t\theight: 6px;\n\t\tposition: absolute;\n\t\tright: 4px;\n\t\tbottom: 3px;\n\t\tborder: 2px solid #fff;\n\t\tborder-top-color: transparent;\n\t\tborder-left-color: transparent;\n\t\ttransform: rotate(45deg);\n\t}\n\n\n\t\tborder-left-color: transparent;\n\t\ttransform: rotate(45deg);\n\t}\n\n\n\n","source":"_posts/4.md","raw":"---\ntitle: vue实现点击选中div后,右下角显示对号√\ncategories: CSS小案例\ncover:  https://s1.ax1x.com/2023/08/04/pPFRXlV.jpg\n---\n\n\n\n\n\n# vue 实现点击选中div 右下角显示对号√\n\n效果图：\n\n[![pPFrLr9.png](https://s1.ax1x.com/2023/08/04/pPFrLr9.png)](https://imgse.com/i/pPFrLr9)\n\n\n\n```html\n<div class=\"\" style=\"display: flex;\">\n\t<div class=\"item\" :class=\"activeKey === 0 ? 'select' : ''\" @click=\"activeKey = 0\">\n\t\t\t<div class=\"shift\">\n\t\t\t\t早班 8：00 - 20：00\n\t\t\t</div>\n\t\t\t<div class=\"\">\n\t\t\t\t2022年07月18日\n\t\t\t</div>\n\t</div>\n\t<div class=\"item\" :class=\"activeKey === 1 ? 'select' : ''\" @click=\"activeKey = 1\">\n\t\t<div class=\"shift\">\n\t\t\t晚班 20：00 - 8：00\n\t\t</div>\n\t\t<div class=\"\">\n\t\t\t2022年07月18日\n\t\t</div>\n\t</div>\n</div>\n```\n\n```css\n.item {\n\t\tborder: 1px #AAAAAA solid;\n\t\tpadding: 1vh 1vw;\n\t\tborder-radius: 5px;\n\t\tmargin: 1vh 1vw;\n\t}\n\n\t.shift {\n\t\tfont-weight: 600;\n\t\tmargin-bottom: 10px;\n\t}\n\n\t.select {\n\t\tposition: relative;\n\t\ttext-align: left;\n\t\tcolor: #00aaff;\n\t\tbackground-color: #fff;\n\t\tbox-shadow: 0px 2px 7px 0px rgba(85, 110, 97, 0.35);\n\t\tborder-radius: 5px;\n\t\tborder: 1px solid #00aaff;\n\t}\n\n\t.select:before {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tborder: 10px solid #00aaff;\n\t\tborder-top-color: transparent;\n\t\tborder-left-color: transparent;\n\t}\n\n\t.select:after {\n\t\tcontent: '';\n\t\twidth: 4px;\n\t\theight: 6px;\n\t\tposition: absolute;\n\t\tright: 4px;\n\t\tbottom: 3px;\n\t\tborder: 2px solid #fff;\n\t\tborder-top-color: transparent;\n\t\tborder-left-color: transparent;\n\t\ttransform: rotate(45deg);\n\t}\n\n\n\t\tborder-left-color: transparent;\n\t\ttransform: rotate(45deg);\n\t}\n\n\n\n","slug":"4","published":1,"date":"2023-08-07T02:04:35.904Z","updated":"2023-08-04T06:07:23.306Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll0f74sb00073gs454ac826m","content":"<h1 id=\"vue-实现点击选中div-右下角显示对号√\"><a href=\"#vue-实现点击选中div-右下角显示对号√\" class=\"headerlink\" title=\"vue 实现点击选中div 右下角显示对号√\"></a>vue 实现点击选中div 右下角显示对号√</h1><p>效果图：</p>\n<p><a href=\"https://imgse.com/i/pPFrLr9\"><img src=\"https://s1.ax1x.com/2023/08/04/pPFrLr9.png\" alt=\"pPFrLr9.png\"></a></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: flex;&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;activeKey === 0 ? &#x27;select&#x27; : &#x27;&#x27;&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;activeKey = 0&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;shift&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t早班 8：00 - 20：00</span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t2022年07月18日</span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;activeKey === 1 ? &#x27;select&#x27; : &#x27;&#x27;&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;activeKey = 1&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;shift&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t晚班 20：00 - 8：00</span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t2022年07月18日</span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<pre><code class=\"css\">.item &#123;\n        border: 1px #AAAAAA solid;\n        padding: 1vh 1vw;\n        border-radius: 5px;\n        margin: 1vh 1vw;\n    &#125;\n\n    .shift &#123;\n        font-weight: 600;\n        margin-bottom: 10px;\n    &#125;\n\n    .select &#123;\n        position: relative;\n        text-align: left;\n        color: #00aaff;\n        background-color: #fff;\n        box-shadow: 0px 2px 7px 0px rgba(85, 110, 97, 0.35);\n        border-radius: 5px;\n        border: 1px solid #00aaff;\n    &#125;\n\n    .select:before &#123;\n        content: &#39;&#39;;\n        position: absolute;\n        right: 0;\n        bottom: 0;\n        border: 10px solid #00aaff;\n        border-top-color: transparent;\n        border-left-color: transparent;\n    &#125;\n\n    .select:after &#123;\n        content: &#39;&#39;;\n        width: 4px;\n        height: 6px;\n        position: absolute;\n        right: 4px;\n        bottom: 3px;\n        border: 2px solid #fff;\n        border-top-color: transparent;\n        border-left-color: transparent;\n        transform: rotate(45deg);\n    &#125;\n\n\n        border-left-color: transparent;\n        transform: rotate(45deg);\n    &#125;\n\n\n</code></pre>\n","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<h1 id=\"vue-实现点击选中div-右下角显示对号√\"><a href=\"#vue-实现点击选中div-右下角显示对号√\" class=\"headerlink\" title=\"vue 实现点击选中div 右下角显示对号√\"></a>vue 实现点击选中div 右下角显示对号√</h1><p>效果图：</p>\n<p><a href=\"https://imgse.com/i/pPFrLr9\"><img src=\"https://s1.ax1x.com/2023/08/04/pPFrLr9.png\" alt=\"pPFrLr9.png\"></a></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: flex;&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;activeKey === 0 ? &#x27;select&#x27; : &#x27;&#x27;&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;activeKey = 0&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;shift&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t早班 8：00 - 20：00</span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t2022年07月18日</span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;item&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;activeKey === 1 ? &#x27;select&#x27; : &#x27;&#x27;&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;activeKey = 1&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;shift&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t晚班 20：00 - 8：00</span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t2022年07月18日</span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<pre><code class=\"css\">.item &#123;\n        border: 1px #AAAAAA solid;\n        padding: 1vh 1vw;\n        border-radius: 5px;\n        margin: 1vh 1vw;\n    &#125;\n\n    .shift &#123;\n        font-weight: 600;\n        margin-bottom: 10px;\n    &#125;\n\n    .select &#123;\n        position: relative;\n        text-align: left;\n        color: #00aaff;\n        background-color: #fff;\n        box-shadow: 0px 2px 7px 0px rgba(85, 110, 97, 0.35);\n        border-radius: 5px;\n        border: 1px solid #00aaff;\n    &#125;\n\n    .select:before &#123;\n        content: &#39;&#39;;\n        position: absolute;\n        right: 0;\n        bottom: 0;\n        border: 10px solid #00aaff;\n        border-top-color: transparent;\n        border-left-color: transparent;\n    &#125;\n\n    .select:after &#123;\n        content: &#39;&#39;;\n        width: 4px;\n        height: 6px;\n        position: absolute;\n        right: 4px;\n        bottom: 3px;\n        border: 2px solid #fff;\n        border-top-color: transparent;\n        border-left-color: transparent;\n        transform: rotate(45deg);\n    &#125;\n\n\n        border-left-color: transparent;\n        transform: rotate(45deg);\n    &#125;\n\n\n</code></pre>\n"},{"title":"vue解析Excel时日期格式引起的问题","cover":"https://s1.ax1x.com/2023/08/04/pPF4Alq.jpg","_content":"\n```html\n<el-upload action accept=\".xlsx, .xls\" :auto-upload=\"false\" :show-file-list=\"false\" :on-change=\"handle\">\n\t\t\t\t<el-button type=\"primary\" slot=\"trigger\" :loading=\"loading\">{{loading==true?'读取中':'选取EXCEL文件'}}\n\t\t\t\t</el-button>\n</el-upload>\n```\n\n`出现的问题：日期(月/日)格式的字符变成了一串数字400356这种的`\n`最开始excel格式全是字符    后来换了个user   需求(bug)来了`\n\n\t>import * as xlsx from 'xlsx'\n\n```js\nconst handle = async (file) => {\n\t\t\t\t//读取FILE中的数据（变为JSON格式）\n\t\t\t\tloading.value = true\n\t\t\t\tlet data = await readFile(file.raw);\n\t\t\t\tlet workbook = xlsx.read(data, {\n\t\t\t\t\t\ttype: \"binary\"\n\t\t\t\t\t}),\n\t\t\t\t\tworksheet = workbook.Sheets[workbook.SheetNames[0]];\n\t\t\t\tlet dataList = xlsx.utils.sheet_to_json(worksheet);\n\t\t\t\t// 打印结果加下图\n\t\t\t\ttempData.length = 0;\n\t\t\t\tfor (var i = 0; i < dataList.length; i++) {\n\t\t\t\t\t// console.log(\"------------\" + JSON.stringify(dataList[i]));\n\t\t\t\t\tvar sheetData = {\n\t\t\t\t\t\t// 键名为绑定 el 表格的关键字，值则是 dataList[i][对应表头名]\n\t\t\t\t\t\tdate: formatDate(dataList[i][\"异常日期\"], \"/\"),\n\t\t\t\t\t\tname: dataList[i][\"姓名\"],\n\t\t\t\t\t\tjobNumber: dataList[i][\"工号\"],\n\t\t\t\t\t\texcep: dataList[i][\"异常\"],\n\t\t\t\t\t};\n\t\t\t\t\tconsole.log(\"------------\" + JSON.stringify(sheetData));\n\t\t\t\t\ttempData.push(sheetData);\n\t\t\t\t}\n\t\t\t\tif (tempData.length > 0) {\n\t\t\t\t\tcount.value = tempData.length\n\t\t\t\t\tshow.value = true;\n\t\t\t\t\tloading.value = false;\n\t\t\t\t}\n}\n```\n\n```js\nconst readFile = (file) => {\n\t\t\t\treturn new Promise(resolve => {\n\t\t\t\t\tlet reader = new FileReader();\n\t\t\t\t\treader.readAsBinaryString(file);\n\t\t\t\t\treader.onload = ev => {\n\t\t\t\t\t\tresolve(ev.target.result);\n\t\t\t\t\t};\n\t\t\t\t});\n}\n```\n\n```js\nconst formatDate = (numb, format) => {\n\t\t\t\tconsole.log(numb + '---------' + format);\n\t\t\t\tif (numb.toString().indexOf('/') != -1) return numb\n\t\t\t\tconst time = new Date((numb - 1) * 24 * 3600000 + 1)\n\t\t\t\ttime.setYear(time.getFullYear() - 70)\n\t\t\t\tconst year = time.getFullYear() + ''\n\t\t\t\tconst month = time.getMonth() + 1 + ''\n\t\t\t\tconst date = time.getDate() + ''\n\t\t\t\tif (leapyear(year)) {\n\t\t\t\t\tdate = time.getDate() - 1 + ''\n\t\t\t\t}\n\t\t\t\tif (format && format.length === 1) {\n\t\t\t\t\treturn month + format + date\n\t\t\t\t}\n\t\t\t\t// (month < 10 ? '0' + month : month)+(date < 10 ? '0' + date : date)\n\t\t\t\treturn month + '/' + date   //需要的格式\n\n}\n```\n\n```js\n//区分闰年与平年   最开始没区分  出现了4/0这种情况  日期少了一天\n\t\t\tconst leapyear = (year) => {\n\t\t\t\tvar flag = false;\n\t\t\t\tif ((year % 4 == 0 && year % 100 != 0) || year % 400 == 0) {\n\t\t\t\t\tflag = true;\n\t\t\t\t}\n\t\t\t\treturn flag;\n\n\t\t\t}\n```\n\n","source":"_posts/5.md","raw":"---\ntitle: vue解析Excel时日期格式引起的问题\ncategories: Vue实现\ncover: https://s1.ax1x.com/2023/08/04/pPF4Alq.jpg\n---\n\n```html\n<el-upload action accept=\".xlsx, .xls\" :auto-upload=\"false\" :show-file-list=\"false\" :on-change=\"handle\">\n\t\t\t\t<el-button type=\"primary\" slot=\"trigger\" :loading=\"loading\">{{loading==true?'读取中':'选取EXCEL文件'}}\n\t\t\t\t</el-button>\n</el-upload>\n```\n\n`出现的问题：日期(月/日)格式的字符变成了一串数字400356这种的`\n`最开始excel格式全是字符    后来换了个user   需求(bug)来了`\n\n\t>import * as xlsx from 'xlsx'\n\n```js\nconst handle = async (file) => {\n\t\t\t\t//读取FILE中的数据（变为JSON格式）\n\t\t\t\tloading.value = true\n\t\t\t\tlet data = await readFile(file.raw);\n\t\t\t\tlet workbook = xlsx.read(data, {\n\t\t\t\t\t\ttype: \"binary\"\n\t\t\t\t\t}),\n\t\t\t\t\tworksheet = workbook.Sheets[workbook.SheetNames[0]];\n\t\t\t\tlet dataList = xlsx.utils.sheet_to_json(worksheet);\n\t\t\t\t// 打印结果加下图\n\t\t\t\ttempData.length = 0;\n\t\t\t\tfor (var i = 0; i < dataList.length; i++) {\n\t\t\t\t\t// console.log(\"------------\" + JSON.stringify(dataList[i]));\n\t\t\t\t\tvar sheetData = {\n\t\t\t\t\t\t// 键名为绑定 el 表格的关键字，值则是 dataList[i][对应表头名]\n\t\t\t\t\t\tdate: formatDate(dataList[i][\"异常日期\"], \"/\"),\n\t\t\t\t\t\tname: dataList[i][\"姓名\"],\n\t\t\t\t\t\tjobNumber: dataList[i][\"工号\"],\n\t\t\t\t\t\texcep: dataList[i][\"异常\"],\n\t\t\t\t\t};\n\t\t\t\t\tconsole.log(\"------------\" + JSON.stringify(sheetData));\n\t\t\t\t\ttempData.push(sheetData);\n\t\t\t\t}\n\t\t\t\tif (tempData.length > 0) {\n\t\t\t\t\tcount.value = tempData.length\n\t\t\t\t\tshow.value = true;\n\t\t\t\t\tloading.value = false;\n\t\t\t\t}\n}\n```\n\n```js\nconst readFile = (file) => {\n\t\t\t\treturn new Promise(resolve => {\n\t\t\t\t\tlet reader = new FileReader();\n\t\t\t\t\treader.readAsBinaryString(file);\n\t\t\t\t\treader.onload = ev => {\n\t\t\t\t\t\tresolve(ev.target.result);\n\t\t\t\t\t};\n\t\t\t\t});\n}\n```\n\n```js\nconst formatDate = (numb, format) => {\n\t\t\t\tconsole.log(numb + '---------' + format);\n\t\t\t\tif (numb.toString().indexOf('/') != -1) return numb\n\t\t\t\tconst time = new Date((numb - 1) * 24 * 3600000 + 1)\n\t\t\t\ttime.setYear(time.getFullYear() - 70)\n\t\t\t\tconst year = time.getFullYear() + ''\n\t\t\t\tconst month = time.getMonth() + 1 + ''\n\t\t\t\tconst date = time.getDate() + ''\n\t\t\t\tif (leapyear(year)) {\n\t\t\t\t\tdate = time.getDate() - 1 + ''\n\t\t\t\t}\n\t\t\t\tif (format && format.length === 1) {\n\t\t\t\t\treturn month + format + date\n\t\t\t\t}\n\t\t\t\t// (month < 10 ? '0' + month : month)+(date < 10 ? '0' + date : date)\n\t\t\t\treturn month + '/' + date   //需要的格式\n\n}\n```\n\n```js\n//区分闰年与平年   最开始没区分  出现了4/0这种情况  日期少了一天\n\t\t\tconst leapyear = (year) => {\n\t\t\t\tvar flag = false;\n\t\t\t\tif ((year % 4 == 0 && year % 100 != 0) || year % 400 == 0) {\n\t\t\t\t\tflag = true;\n\t\t\t\t}\n\t\t\t\treturn flag;\n\n\t\t\t}\n```\n\n","slug":"5","published":1,"date":"2023-08-07T02:04:35.908Z","updated":"2023-08-04T06:07:56.846Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll0f74se00093gs491fq65d1","content":"<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">el-upload</span> <span class=\"attr\">action</span> <span class=\"attr\">accept</span>=<span class=\"string\">&quot;.xlsx, .xls&quot;</span> <span class=\"attr\">:auto-upload</span>=<span class=\"string\">&quot;false&quot;</span> <span class=\"attr\">:show-file-list</span>=<span class=\"string\">&quot;false&quot;</span> <span class=\"attr\">:on-change</span>=<span class=\"string\">&quot;handle&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">el-button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;primary&quot;</span> <span class=\"attr\">slot</span>=<span class=\"string\">&quot;trigger&quot;</span> <span class=\"attr\">:loading</span>=<span class=\"string\">&quot;loading&quot;</span>&gt;</span>&#123;&#123;loading==true?&#x27;读取中&#x27;:&#x27;选取EXCEL文件&#x27;&#125;&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">el-button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">el-upload</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>出现的问题：日期(月/日)格式的字符变成了一串数字400356这种的</code><br><code>最开始excel格式全是字符    后来换了个user   需求(bug)来了</code></p>\n<pre><code>&gt;import * as xlsx from &#39;xlsx&#39;\n</code></pre>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">handle</span> = <span class=\"keyword\">async</span> (<span class=\"params\">file</span>) =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//读取FILE中的数据（变为JSON格式）</span></span><br><span class=\"line\">\t\t\t\tloading.<span class=\"property\">value</span> = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> data = <span class=\"keyword\">await</span> <span class=\"title function_\">readFile</span>(file.<span class=\"property\">raw</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> workbook = xlsx.<span class=\"title function_\">read</span>(data, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">type</span>: <span class=\"string\">&quot;binary&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;),</span><br><span class=\"line\">\t\t\t\t\tworksheet = workbook.<span class=\"property\">Sheets</span>[workbook.<span class=\"property\">SheetNames</span>[<span class=\"number\">0</span>]];</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> dataList = xlsx.<span class=\"property\">utils</span>.<span class=\"title function_\">sheet_to_json</span>(worksheet);</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 打印结果加下图</span></span><br><span class=\"line\">\t\t\t\ttempData.<span class=\"property\">length</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; dataList.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// console.log(&quot;------------&quot; + JSON.stringify(dataList[i]));</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">var</span> sheetData = &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// 键名为绑定 el 表格的关键字，值则是 dataList[i][对应表头名]</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">date</span>: <span class=\"title function_\">formatDate</span>(dataList[i][<span class=\"string\">&quot;异常日期&quot;</span>], <span class=\"string\">&quot;/&quot;</span>),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">name</span>: dataList[i][<span class=\"string\">&quot;姓名&quot;</span>],</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">jobNumber</span>: dataList[i][<span class=\"string\">&quot;工号&quot;</span>],</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">excep</span>: dataList[i][<span class=\"string\">&quot;异常&quot;</span>],</span><br><span class=\"line\">\t\t\t\t\t&#125;;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;------------&quot;</span> + <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(sheetData));</span><br><span class=\"line\">\t\t\t\t\ttempData.<span class=\"title function_\">push</span>(sheetData);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (tempData.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tcount.<span class=\"property\">value</span> = tempData.<span class=\"property\">length</span></span><br><span class=\"line\">\t\t\t\t\tshow.<span class=\"property\">value</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t\t\t\t\tloading.<span class=\"property\">value</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">readFile</span> = (<span class=\"params\">file</span>) =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">let</span> reader = <span class=\"keyword\">new</span> <span class=\"title class_\">FileReader</span>();</span><br><span class=\"line\">\t\t\t\t\treader.<span class=\"title function_\">readAsBinaryString</span>(file);</span><br><span class=\"line\">\t\t\t\t\treader.<span class=\"property\">onload</span> = <span class=\"function\"><span class=\"params\">ev</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"title function_\">resolve</span>(ev.<span class=\"property\">target</span>.<span class=\"property\">result</span>);</span><br><span class=\"line\">\t\t\t\t\t&#125;;</span><br><span class=\"line\">\t\t\t\t&#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">formatDate</span> = (<span class=\"params\">numb, format</span>) =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(numb + <span class=\"string\">&#x27;---------&#x27;</span> + format);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (numb.<span class=\"title function_\">toString</span>().<span class=\"title function_\">indexOf</span>(<span class=\"string\">&#x27;/&#x27;</span>) != -<span class=\"number\">1</span>) <span class=\"keyword\">return</span> numb</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">const</span> time = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>((numb - <span class=\"number\">1</span>) * <span class=\"number\">24</span> * <span class=\"number\">3600000</span> + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\ttime.<span class=\"title function_\">setYear</span>(time.<span class=\"title function_\">getFullYear</span>() - <span class=\"number\">70</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">const</span> year = time.<span class=\"title function_\">getFullYear</span>() + <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">const</span> month = time.<span class=\"title function_\">getMonth</span>() + <span class=\"number\">1</span> + <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">const</span> date = time.<span class=\"title function_\">getDate</span>() + <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (<span class=\"title function_\">leapyear</span>(year)) &#123;</span><br><span class=\"line\">\t\t\t\t\tdate = time.<span class=\"title function_\">getDate</span>() - <span class=\"number\">1</span> + <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (format &amp;&amp; format.<span class=\"property\">length</span> === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> month + format + date</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// (month &lt; 10 ? &#x27;0&#x27; + month : month)+(date &lt; 10 ? &#x27;0&#x27; + date : date)</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> month + <span class=\"string\">&#x27;/&#x27;</span> + date   <span class=\"comment\">//需要的格式</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//区分闰年与平年   最开始没区分  出现了4/0这种情况  日期少了一天</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">const</span> <span class=\"title function_\">leapyear</span> = (<span class=\"params\">year</span>) =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">var</span> flag = <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> ((year % <span class=\"number\">4</span> == <span class=\"number\">0</span> &amp;&amp; year % <span class=\"number\">100</span> != <span class=\"number\">0</span>) || year % <span class=\"number\">400</span> == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tflag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> flag;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">el-upload</span> <span class=\"attr\">action</span> <span class=\"attr\">accept</span>=<span class=\"string\">&quot;.xlsx, .xls&quot;</span> <span class=\"attr\">:auto-upload</span>=<span class=\"string\">&quot;false&quot;</span> <span class=\"attr\">:show-file-list</span>=<span class=\"string\">&quot;false&quot;</span> <span class=\"attr\">:on-change</span>=<span class=\"string\">&quot;handle&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">el-button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;primary&quot;</span> <span class=\"attr\">slot</span>=<span class=\"string\">&quot;trigger&quot;</span> <span class=\"attr\">:loading</span>=<span class=\"string\">&quot;loading&quot;</span>&gt;</span>&#123;&#123;loading==true?&#x27;读取中&#x27;:&#x27;选取EXCEL文件&#x27;&#125;&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">el-button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">el-upload</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>出现的问题：日期(月/日)格式的字符变成了一串数字400356这种的</code><br><code>最开始excel格式全是字符    后来换了个user   需求(bug)来了</code></p>\n<pre><code>&gt;import * as xlsx from &#39;xlsx&#39;\n</code></pre>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">handle</span> = <span class=\"keyword\">async</span> (<span class=\"params\">file</span>) =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//读取FILE中的数据（变为JSON格式）</span></span><br><span class=\"line\">\t\t\t\tloading.<span class=\"property\">value</span> = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> data = <span class=\"keyword\">await</span> <span class=\"title function_\">readFile</span>(file.<span class=\"property\">raw</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> workbook = xlsx.<span class=\"title function_\">read</span>(data, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">type</span>: <span class=\"string\">&quot;binary&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;),</span><br><span class=\"line\">\t\t\t\t\tworksheet = workbook.<span class=\"property\">Sheets</span>[workbook.<span class=\"property\">SheetNames</span>[<span class=\"number\">0</span>]];</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> dataList = xlsx.<span class=\"property\">utils</span>.<span class=\"title function_\">sheet_to_json</span>(worksheet);</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 打印结果加下图</span></span><br><span class=\"line\">\t\t\t\ttempData.<span class=\"property\">length</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; dataList.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// console.log(&quot;------------&quot; + JSON.stringify(dataList[i]));</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">var</span> sheetData = &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// 键名为绑定 el 表格的关键字，值则是 dataList[i][对应表头名]</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">date</span>: <span class=\"title function_\">formatDate</span>(dataList[i][<span class=\"string\">&quot;异常日期&quot;</span>], <span class=\"string\">&quot;/&quot;</span>),</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">name</span>: dataList[i][<span class=\"string\">&quot;姓名&quot;</span>],</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">jobNumber</span>: dataList[i][<span class=\"string\">&quot;工号&quot;</span>],</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">excep</span>: dataList[i][<span class=\"string\">&quot;异常&quot;</span>],</span><br><span class=\"line\">\t\t\t\t\t&#125;;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;------------&quot;</span> + <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(sheetData));</span><br><span class=\"line\">\t\t\t\t\ttempData.<span class=\"title function_\">push</span>(sheetData);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (tempData.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tcount.<span class=\"property\">value</span> = tempData.<span class=\"property\">length</span></span><br><span class=\"line\">\t\t\t\t\tshow.<span class=\"property\">value</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t\t\t\t\tloading.<span class=\"property\">value</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">readFile</span> = (<span class=\"params\">file</span>) =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">let</span> reader = <span class=\"keyword\">new</span> <span class=\"title class_\">FileReader</span>();</span><br><span class=\"line\">\t\t\t\t\treader.<span class=\"title function_\">readAsBinaryString</span>(file);</span><br><span class=\"line\">\t\t\t\t\treader.<span class=\"property\">onload</span> = <span class=\"function\"><span class=\"params\">ev</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"title function_\">resolve</span>(ev.<span class=\"property\">target</span>.<span class=\"property\">result</span>);</span><br><span class=\"line\">\t\t\t\t\t&#125;;</span><br><span class=\"line\">\t\t\t\t&#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">formatDate</span> = (<span class=\"params\">numb, format</span>) =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(numb + <span class=\"string\">&#x27;---------&#x27;</span> + format);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (numb.<span class=\"title function_\">toString</span>().<span class=\"title function_\">indexOf</span>(<span class=\"string\">&#x27;/&#x27;</span>) != -<span class=\"number\">1</span>) <span class=\"keyword\">return</span> numb</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">const</span> time = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>((numb - <span class=\"number\">1</span>) * <span class=\"number\">24</span> * <span class=\"number\">3600000</span> + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\ttime.<span class=\"title function_\">setYear</span>(time.<span class=\"title function_\">getFullYear</span>() - <span class=\"number\">70</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">const</span> year = time.<span class=\"title function_\">getFullYear</span>() + <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">const</span> month = time.<span class=\"title function_\">getMonth</span>() + <span class=\"number\">1</span> + <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">const</span> date = time.<span class=\"title function_\">getDate</span>() + <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (<span class=\"title function_\">leapyear</span>(year)) &#123;</span><br><span class=\"line\">\t\t\t\t\tdate = time.<span class=\"title function_\">getDate</span>() - <span class=\"number\">1</span> + <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (format &amp;&amp; format.<span class=\"property\">length</span> === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> month + format + date</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// (month &lt; 10 ? &#x27;0&#x27; + month : month)+(date &lt; 10 ? &#x27;0&#x27; + date : date)</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> month + <span class=\"string\">&#x27;/&#x27;</span> + date   <span class=\"comment\">//需要的格式</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//区分闰年与平年   最开始没区分  出现了4/0这种情况  日期少了一天</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">const</span> <span class=\"title function_\">leapyear</span> = (<span class=\"params\">year</span>) =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">var</span> flag = <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> ((year % <span class=\"number\">4</span> == <span class=\"number\">0</span> &amp;&amp; year % <span class=\"number\">100</span> != <span class=\"number\">0</span>) || year % <span class=\"number\">400</span> == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tflag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> flag;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t&#125;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"微信小程序实现点击按钮生成海报","cover":"https://s1.ax1x.com/2023/08/04/pPFRHFs.jpg","_content":"\n\n\n\n\n\n\n\n>页面布局\n>\n>```html\n><view class=\"mask\" v-show=\"isShow\">\n>\t\t\t<view class='board'>\n>\t\t\t\t<view class=\"heart\">\n>                    <span class=\"sure\" @click=\"isShow=false\">×</span>\n>                </view>\n>\t\t\t\t<canvas @longpress=\"saveHomepage\" \t:style=\"'width:'+canvasWidth+'px;height:'+ canvasHeight+'px;'\"\n>\t\t\t\t\tcanvas-id=\"myCanvas\"></canvas>\n>\t\t\t</view>\n></view>\n>\n><view  class=\"foot-icon-card\" @click=\"addCanvas(activity)\">\n>\t\t<image src=\"../../static/icons/haibao.svg\"> </image>\n>\t\t<text>生成海报</text>\n></view>\n>```\n>\n>data属性定义\n>\n>```js\n>canvasWidth: 300,\n>canvasHeight: 500,\n>isShow: false,\n>img_pop: '',\n>poster: ''\n>imageList: [\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zHfp9.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zHT0K.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zHhlR.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zHRfJ.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zH2Y4.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zHom6.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zH5Ox.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zH461.jpg\",\n>\t]\n>```\n>\n>methods实现\n>\n\n>```js\n>//文字自动换行显示，超出指定范围用...代替显示\n>\n>textSplit(ctx, text, lineWidth, lines) {\n>\t\t\t\tconst charWidths = Array.from(text, char => ctx.measureText(char).width);\n>\n>\t\t\t\tlet textArr = [];\n>\t\t\t\tlet c_text = '';\n>\t\t\t\tlet lineCount = 0;\n>\n>\t\t\t\tfor (let i = 0; i < text.length; i++) {\n>\t\t\t\t\tconst charWidth = charWidths[i];\n>\n>\t\t\t\t\tif (ctx.measureText(c_text).width + charWidth < lineWidth) {\n>\t\t\t\t\t\tc_text += text[i];\n>\t\t\t\t\t} else {\n>\t\t\t\t\t\tlineCount++;\n>\t\t\t\t\t\tif (lineCount === lines) {\n>\t\t\t\t\t\t\tconst lastLineWidth = ctx.measureText(c_text).width;\n>\t\t\t\t\t\t\tc_text = c_text.slice(0, -1);\n>\t\t\t\t\t\t\twhile (ctx.measureText(c_text + '...').width > lineWidth) {\n>\t\t\t\t\t\t\t\tc_text = c_text.slice(0, -1);\n>\t\t\t\t\t\t\t}\n>\t\t\t\t\t\t\tc_text += '...';\n>\t\t\t\t\t\t\ttextArr.push(c_text);\n>\t\t\t\t\t\t\treturn textArr;\n>\t\t\t\t\t\t} else {\n>\t\t\t\t\t\t\ttextArr.push(c_text);\n>\t\t\t\t\t\t\tc_text = text[i];\n>\t\t\t\t\t\t}\n>\t\t\t\t\t}\n>\t\t\t\t}\n>\n>\t\t\t\t// 当长度小于指定的 `lineWidth` 时，直接返回传入的文本内容\n>\t\t\t\tif (textArr.length === 0) {\n>\t\t\t\t\treturn [text];\n>\t\t\t\t}\n>\n>\t\t\t\t// 添加最后一行文本内容\n>\t\t\t\ttextArr.push(c_text);\n>\n>\t\t\t\t// 如果超过了指定行数，则修改最后一行内容，并返回修改后的文本数组。\n>\t\t\t\tif (textArr.length > lines) {\n>\t\t\t\t\tconst lastLineWidth = ctx.measureText(c_text).width;\n>\t\t\t\t\tc_text = textArr.pop();\n>\t\t\t\t\twhile (ctx.measureText(c_text + '...').width > lineWidth) {\n>\t\t\t\t\t\tc_text = c_text.slice(0, -1);\n>\t\t\t\t\t}\n>\t\t\t\t\tc_text += '...';\n>\t\t\t\t\ttextArr.push(c_text);\n>\t\t\t\t}\n>\n>\t\t\t\treturn textArr;\n>\t\t\t}\n>```\n\n>```js\n>//图片网络路径转换为临时路径\n>getImgUrl(img) {\n>\t\t\t\treturn new Promise((result, rej) => {\n>\t\t\t\t\twx.getImageInfo({\n>\t\t\t\t\t\tsrc: img,\n>\t\t\t\t\t\tsuccess: (res) => {\n>\t\t\t\t\t\t\tconsole.log(res, \"获取\");\n>\t\t\t\t\t\t\treturn result(res.path)\n>\t\t\t\t\t\t},\n>\t\t\t\t\t\tfail: (error) => {\n>\t\t\t\t\t\t\trej(error)\n>\t\t\t\t\t\t}\n>\t\t\t\t\t})\n>\t\t\t\t})\n>},\n>```\n```js\nasync addCanvas(item) {\n\t\t\t\tthis.isShow = true\n\t\t\t\tthis.foot = 'close'\n\t\t\t\tuni.showLoading({\n\t\t\t\t\ttitle: '正在生成海报'\n\t\t\t\t})\n\t\t\t\tlet ctx = wx.createCanvasContext('myCanvas')\n\t\t\t\tctx.fillStyle = '#fff';\n\t\t\t\tctx.fillRect(0, 0, this.canvasWidth, this.canvasHeight)\n\n\t\t\t\t// 封面图\n\t\t\t\tif (item.avatar) {\n\t\t\t\t\tctx.drawImage(await this.getImgUrl(item.avatar), 0, 0, this.canvasWidth, 200)\n\t\t\t\t} else {\n\t\t\t\t\t//随机背景图\n\t\t\t\t\tctx.drawImage(await this.getImgUrl(this.imageList[Math.floor(Math.random() * 8)]), 0, 0, this\n\t\t\t\t\t\t.canvasWidth, 200)\n\t\t\t\t}\n\n\t\t\t\t//标题\n\t\t\t\tctx.font = `normal 20px `\n\t\t\t\tctx.fillStyle = '#000'\n\t\t\t\tlet nameText = this.textSplit(ctx, item.name, this.canvasWidth - 20, 1)\n\t\t\t\tnameText.forEach(r => {\n\t\t\t\t\tctx.fillText(r, 15, 220)\n\t\t\t\t})\n\n\t\t\t\t//活动内容\n\t\t\t\tlet lineHeight = 25; //文字行高\n\t\t\t\tlet text = this.textSplit(ctx, item.description, this.canvasWidth + this.canvasWidth / 3, 3)\n\t\t\t\ttext.forEach((r, index) => {\n\t\t\t\t\tctx.font = `normal 14px `\n\t\t\t\t\tctx.fillStyle = '#636363'\n\t\t\t\t\tctx.fillText(r, 15, 250 + index * lineHeight)\n\t\t\t\t})\n\n\t\t\t\t//地点\n\t\t\t\tctx.font = `normal 14px `\n\t\t\t\tctx.fillStyle = '#000'\n\t\t\t\tctx.fillText('活动地点：', 15, 350)\n\t\t\t\tlet textAdress = this.textSplit(ctx, item.address, this.canvasWidth - 100, 2)\n\t\t\t\ttextAdress.forEach((r, index) => {\n\t\t\t\t\tctx.font = `normal 14px `\n\t\t\t\t\tctx.fillStyle = '#636363'\n\t\t\t\t\tctx.fillText(r, 15, 370 + index * lineHeight)\n\t\t\t\t})\n\n\t\t\t\t//时间\n\t\t\t\tctx.font = `normal 14px `\n\t\t\t\tctx.fillStyle = '#000'\n\t\t\t\tctx.fillText('时间：', 15, 420)\n\t\t\t\tctx.font = `normal 14px `\n\t\t\t\tctx.fillStyle = '#000'\n\t\t\t\tctx.fillText(item.start_date + \" \" + item.start_time, 15, 440)\n\n\n\t\t\t\t// 二维码\n\t\t\t\tctx.drawImage(this.img_pop, this.canvasWidth / 2 + this.canvasWidth / 4, 340, 70, 70)\n\n\t\t\t\t// 底部文字\n\t\t\t\tctx.font = 'normal 12px '\n\t\t\t\tctx.fillStyle = '#9C9C9C'\n\t\t\t\tctx.fillText('长按识别或保存图片', this.canvasWidth / 3, 470)\n\n\t\t\t\t//开始绘画\n\t\t\t\tawait ctx.draw(true, res => {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tuni.canvasToTempFilePath({\n\t\t\t\t\t\t\tcanvasId: 'myCanvas',\n\t\t\t\t\t\t\tsuccess: res => {\n\t\t\t\t\t\t\t\tthis.poster = res.tempFilePath\n\t\t\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfail: err => {\n\t\t\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, this)\n\t\t\t\t\t}, 1000)\n\t\t\t\t})\n\t\t\t},\n```\n\n>```js\n>// 判断是否有写入相册的权限\n>\t\t\tsaveHomepage() {\n>\t\t\t\tlet that = this;\n>\t\t\t\t//判断当前小程序是否有保存相册的权限\n>\t\t\t\twx.getSetting({\n>\t\t\t\t\tsuccess(res) {\n>\t\t\t\t\t\tif (!res.authSetting['scope.writePhotosAlbum']) {\n>\t\t\t\t\t\t\twx.authorize({\n>\t\t\t\t\t\t\t\tscope: 'scope.writePhotosAlbum',\n>\t\t\t\t\t\t\t\tsuccess(res) {\n>\t\t\t\t\t\t\t\t\tthat.startSaveImage();\n>\t\t\t\t\t\t\t\t},\n>\t\t\t\t\t\t\t\tfail() { //这里是用户拒绝授权后的回调\n>\t\t\t\t\t\t\t\t\twx.showModal({\n>\t\t\t\t\t\t\t\t\t\tcontent: '请允许相册权限,拒绝将无法正常使用小程序',\n>\t\t\t\t\t\t\t\t\t\tshowCancel: false,\n>\t\t\t\t\t\t\t\t\t\tsuccess() {\n>\t\t\t\t\t\t\t\t\t\t\twx.openSetting({\n>\t\t\t\t\t\t\t\t\t\t\t\tsuccess(settingdata) {\n>\t\t\t\t\t\t\t\t\t\t\t\t\tif (settingdata.authSetting[\n>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"scope.writePhotosAlbum\"\n>\t\t\t\t\t\t\t\t\t\t\t\t\t\t]) {} else {\n>\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"获取权限失败\")\n>\t\t\t\t\t\t\t\t\t\t\t\t\t}\n>\n>\t\t\t\t\t\t\t\t\t\t\t\t}\n>\t\t\t\t\t\t\t\t\t\t\t})\n>\t\t\t\t\t\t\t\t\t\t}\n>\t\t\t\t\t\t\t\t\t})\n>\t\t\t\t\t\t\t\t}\n>\t\t\t\t\t\t\t})\n>\t\t\t\t\t\t} else {\n>\t\t\t\t\t\t\tthat.startSaveImage();\n>\t\t\t\t\t\t}\n>\t\t\t\t\t}\n>\t\t\t\t})\n>},\n>\t\t\t\n>```\n>\n>```\n>//保存本地\n>\n>startSaveImage() {\n>\t\t\t\tuni.saveImageToPhotosAlbum({\n>\t\t\t\t\tfilePath: this.poster,\n>\t\t\t\t\tsuccess: (res) => {\n>\t\t\t\t\t\tuni.showToast({\n>\t\t\t\t\t\t\ttitle: '保存成功',\n>\t\t\t\t\t\t\ticon: 'none',\n>\t\t\t\t\t\t\tduration: 4000\n>\t\t\t\t\t\t})\n>\t\t\t\t\t\tthis.$refs.popup.close()\n>\t\t\t\t\t}\n>\t\t\t\t})\n>},\n>```\n>\n>css样式\n>\n>```css\n>.mask {\n>\t\tposition: fixed;\n>\t\ttop: 0;\n>\t\tleft: 0;\n>\t\tz-index: 998;\n>\t\twidth: 100vw;\n>\t\theight: 100%;\n>\t\tbackground-color: #000000;\n>\t\toverflow: hidden;\n>\t}\n>\n>\t.board {\n>\t\tanimation: myframe 0.3s;\n>\t\tposition: fixed;\n>\t\ttop: 50%;\n>\t\tleft: 50%;\n>\t\ttransform: translate(-50%, -50%);\n>\n>\t\tz-index: 999;\n>\t}\n>\n>\t.sure {\n>\t\ttext-align: center;\n>\t\tdisplay: block;\n>\t\twidth: 46rpx;\n>\t\tmargin: 0 auto;\n>\t\tfont-size: 32rpx;\n>\t\tcolor: #fff;\n>\t\theight: 46rpx;\n>\t\tborder-radius: 50%;\n>\t\tline-height: 44rpx;\n>\t\tborder: 1px solid #ffffff;\n>\t\tfont-family: '楷体';\n>\t}\n>.heart {\n>\t\tposition: relative;\n>\t\tbottom: -540px;\n>\t}\n>\n>```\n>\n![效果图](https://img-blog.csdnimg.cn/257eb9d300c54ba6b1d96fab0a2ab971.png)\n\n\n\n效果图\n\n\n参考：[uniapp点击生成商品海报、下载海报、分享海报](https://blog.csdn.net/SunFlower914/article/details/129086268)\n[微信小程序Canvas绘制主页保存到手机相册](https://blog.csdn.net/weixin_44157191/article/details/125083841?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168482699316800182742427%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=168482699316800182742427&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-125083841-null-null.142%5Ev87%5Econtrol,239%5Ev2%5Einsert_chatgpt&utm_term=%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%AE%BE%E7%BD%AEcanvas%E8%B6%85%E5%87%BA%E4%B8%89%E8%A1%8C%E9%9A%90%E8%97%8F&spm=1018.2226.3001.4187)\n","source":"_posts/6.md","raw":"---\ntitle: 微信小程序实现点击按钮生成海报\ncategories: Vue实现\ncover: https://s1.ax1x.com/2023/08/04/pPFRHFs.jpg\n---\n\n\n\n\n\n\n\n\n>页面布局\n>\n>```html\n><view class=\"mask\" v-show=\"isShow\">\n>\t\t\t<view class='board'>\n>\t\t\t\t<view class=\"heart\">\n>                    <span class=\"sure\" @click=\"isShow=false\">×</span>\n>                </view>\n>\t\t\t\t<canvas @longpress=\"saveHomepage\" \t:style=\"'width:'+canvasWidth+'px;height:'+ canvasHeight+'px;'\"\n>\t\t\t\t\tcanvas-id=\"myCanvas\"></canvas>\n>\t\t\t</view>\n></view>\n>\n><view  class=\"foot-icon-card\" @click=\"addCanvas(activity)\">\n>\t\t<image src=\"../../static/icons/haibao.svg\"> </image>\n>\t\t<text>生成海报</text>\n></view>\n>```\n>\n>data属性定义\n>\n>```js\n>canvasWidth: 300,\n>canvasHeight: 500,\n>isShow: false,\n>img_pop: '',\n>poster: ''\n>imageList: [\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zHfp9.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zHT0K.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zHhlR.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zHRfJ.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zH2Y4.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zHom6.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zH5Ox.jpg\",\n>\t\t\"https://s1.ax1x.com/2023/06/02/p9zH461.jpg\",\n>\t]\n>```\n>\n>methods实现\n>\n\n>```js\n>//文字自动换行显示，超出指定范围用...代替显示\n>\n>textSplit(ctx, text, lineWidth, lines) {\n>\t\t\t\tconst charWidths = Array.from(text, char => ctx.measureText(char).width);\n>\n>\t\t\t\tlet textArr = [];\n>\t\t\t\tlet c_text = '';\n>\t\t\t\tlet lineCount = 0;\n>\n>\t\t\t\tfor (let i = 0; i < text.length; i++) {\n>\t\t\t\t\tconst charWidth = charWidths[i];\n>\n>\t\t\t\t\tif (ctx.measureText(c_text).width + charWidth < lineWidth) {\n>\t\t\t\t\t\tc_text += text[i];\n>\t\t\t\t\t} else {\n>\t\t\t\t\t\tlineCount++;\n>\t\t\t\t\t\tif (lineCount === lines) {\n>\t\t\t\t\t\t\tconst lastLineWidth = ctx.measureText(c_text).width;\n>\t\t\t\t\t\t\tc_text = c_text.slice(0, -1);\n>\t\t\t\t\t\t\twhile (ctx.measureText(c_text + '...').width > lineWidth) {\n>\t\t\t\t\t\t\t\tc_text = c_text.slice(0, -1);\n>\t\t\t\t\t\t\t}\n>\t\t\t\t\t\t\tc_text += '...';\n>\t\t\t\t\t\t\ttextArr.push(c_text);\n>\t\t\t\t\t\t\treturn textArr;\n>\t\t\t\t\t\t} else {\n>\t\t\t\t\t\t\ttextArr.push(c_text);\n>\t\t\t\t\t\t\tc_text = text[i];\n>\t\t\t\t\t\t}\n>\t\t\t\t\t}\n>\t\t\t\t}\n>\n>\t\t\t\t// 当长度小于指定的 `lineWidth` 时，直接返回传入的文本内容\n>\t\t\t\tif (textArr.length === 0) {\n>\t\t\t\t\treturn [text];\n>\t\t\t\t}\n>\n>\t\t\t\t// 添加最后一行文本内容\n>\t\t\t\ttextArr.push(c_text);\n>\n>\t\t\t\t// 如果超过了指定行数，则修改最后一行内容，并返回修改后的文本数组。\n>\t\t\t\tif (textArr.length > lines) {\n>\t\t\t\t\tconst lastLineWidth = ctx.measureText(c_text).width;\n>\t\t\t\t\tc_text = textArr.pop();\n>\t\t\t\t\twhile (ctx.measureText(c_text + '...').width > lineWidth) {\n>\t\t\t\t\t\tc_text = c_text.slice(0, -1);\n>\t\t\t\t\t}\n>\t\t\t\t\tc_text += '...';\n>\t\t\t\t\ttextArr.push(c_text);\n>\t\t\t\t}\n>\n>\t\t\t\treturn textArr;\n>\t\t\t}\n>```\n\n>```js\n>//图片网络路径转换为临时路径\n>getImgUrl(img) {\n>\t\t\t\treturn new Promise((result, rej) => {\n>\t\t\t\t\twx.getImageInfo({\n>\t\t\t\t\t\tsrc: img,\n>\t\t\t\t\t\tsuccess: (res) => {\n>\t\t\t\t\t\t\tconsole.log(res, \"获取\");\n>\t\t\t\t\t\t\treturn result(res.path)\n>\t\t\t\t\t\t},\n>\t\t\t\t\t\tfail: (error) => {\n>\t\t\t\t\t\t\trej(error)\n>\t\t\t\t\t\t}\n>\t\t\t\t\t})\n>\t\t\t\t})\n>},\n>```\n```js\nasync addCanvas(item) {\n\t\t\t\tthis.isShow = true\n\t\t\t\tthis.foot = 'close'\n\t\t\t\tuni.showLoading({\n\t\t\t\t\ttitle: '正在生成海报'\n\t\t\t\t})\n\t\t\t\tlet ctx = wx.createCanvasContext('myCanvas')\n\t\t\t\tctx.fillStyle = '#fff';\n\t\t\t\tctx.fillRect(0, 0, this.canvasWidth, this.canvasHeight)\n\n\t\t\t\t// 封面图\n\t\t\t\tif (item.avatar) {\n\t\t\t\t\tctx.drawImage(await this.getImgUrl(item.avatar), 0, 0, this.canvasWidth, 200)\n\t\t\t\t} else {\n\t\t\t\t\t//随机背景图\n\t\t\t\t\tctx.drawImage(await this.getImgUrl(this.imageList[Math.floor(Math.random() * 8)]), 0, 0, this\n\t\t\t\t\t\t.canvasWidth, 200)\n\t\t\t\t}\n\n\t\t\t\t//标题\n\t\t\t\tctx.font = `normal 20px `\n\t\t\t\tctx.fillStyle = '#000'\n\t\t\t\tlet nameText = this.textSplit(ctx, item.name, this.canvasWidth - 20, 1)\n\t\t\t\tnameText.forEach(r => {\n\t\t\t\t\tctx.fillText(r, 15, 220)\n\t\t\t\t})\n\n\t\t\t\t//活动内容\n\t\t\t\tlet lineHeight = 25; //文字行高\n\t\t\t\tlet text = this.textSplit(ctx, item.description, this.canvasWidth + this.canvasWidth / 3, 3)\n\t\t\t\ttext.forEach((r, index) => {\n\t\t\t\t\tctx.font = `normal 14px `\n\t\t\t\t\tctx.fillStyle = '#636363'\n\t\t\t\t\tctx.fillText(r, 15, 250 + index * lineHeight)\n\t\t\t\t})\n\n\t\t\t\t//地点\n\t\t\t\tctx.font = `normal 14px `\n\t\t\t\tctx.fillStyle = '#000'\n\t\t\t\tctx.fillText('活动地点：', 15, 350)\n\t\t\t\tlet textAdress = this.textSplit(ctx, item.address, this.canvasWidth - 100, 2)\n\t\t\t\ttextAdress.forEach((r, index) => {\n\t\t\t\t\tctx.font = `normal 14px `\n\t\t\t\t\tctx.fillStyle = '#636363'\n\t\t\t\t\tctx.fillText(r, 15, 370 + index * lineHeight)\n\t\t\t\t})\n\n\t\t\t\t//时间\n\t\t\t\tctx.font = `normal 14px `\n\t\t\t\tctx.fillStyle = '#000'\n\t\t\t\tctx.fillText('时间：', 15, 420)\n\t\t\t\tctx.font = `normal 14px `\n\t\t\t\tctx.fillStyle = '#000'\n\t\t\t\tctx.fillText(item.start_date + \" \" + item.start_time, 15, 440)\n\n\n\t\t\t\t// 二维码\n\t\t\t\tctx.drawImage(this.img_pop, this.canvasWidth / 2 + this.canvasWidth / 4, 340, 70, 70)\n\n\t\t\t\t// 底部文字\n\t\t\t\tctx.font = 'normal 12px '\n\t\t\t\tctx.fillStyle = '#9C9C9C'\n\t\t\t\tctx.fillText('长按识别或保存图片', this.canvasWidth / 3, 470)\n\n\t\t\t\t//开始绘画\n\t\t\t\tawait ctx.draw(true, res => {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tuni.canvasToTempFilePath({\n\t\t\t\t\t\t\tcanvasId: 'myCanvas',\n\t\t\t\t\t\t\tsuccess: res => {\n\t\t\t\t\t\t\t\tthis.poster = res.tempFilePath\n\t\t\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfail: err => {\n\t\t\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, this)\n\t\t\t\t\t}, 1000)\n\t\t\t\t})\n\t\t\t},\n```\n\n>```js\n>// 判断是否有写入相册的权限\n>\t\t\tsaveHomepage() {\n>\t\t\t\tlet that = this;\n>\t\t\t\t//判断当前小程序是否有保存相册的权限\n>\t\t\t\twx.getSetting({\n>\t\t\t\t\tsuccess(res) {\n>\t\t\t\t\t\tif (!res.authSetting['scope.writePhotosAlbum']) {\n>\t\t\t\t\t\t\twx.authorize({\n>\t\t\t\t\t\t\t\tscope: 'scope.writePhotosAlbum',\n>\t\t\t\t\t\t\t\tsuccess(res) {\n>\t\t\t\t\t\t\t\t\tthat.startSaveImage();\n>\t\t\t\t\t\t\t\t},\n>\t\t\t\t\t\t\t\tfail() { //这里是用户拒绝授权后的回调\n>\t\t\t\t\t\t\t\t\twx.showModal({\n>\t\t\t\t\t\t\t\t\t\tcontent: '请允许相册权限,拒绝将无法正常使用小程序',\n>\t\t\t\t\t\t\t\t\t\tshowCancel: false,\n>\t\t\t\t\t\t\t\t\t\tsuccess() {\n>\t\t\t\t\t\t\t\t\t\t\twx.openSetting({\n>\t\t\t\t\t\t\t\t\t\t\t\tsuccess(settingdata) {\n>\t\t\t\t\t\t\t\t\t\t\t\t\tif (settingdata.authSetting[\n>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"scope.writePhotosAlbum\"\n>\t\t\t\t\t\t\t\t\t\t\t\t\t\t]) {} else {\n>\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"获取权限失败\")\n>\t\t\t\t\t\t\t\t\t\t\t\t\t}\n>\n>\t\t\t\t\t\t\t\t\t\t\t\t}\n>\t\t\t\t\t\t\t\t\t\t\t})\n>\t\t\t\t\t\t\t\t\t\t}\n>\t\t\t\t\t\t\t\t\t})\n>\t\t\t\t\t\t\t\t}\n>\t\t\t\t\t\t\t})\n>\t\t\t\t\t\t} else {\n>\t\t\t\t\t\t\tthat.startSaveImage();\n>\t\t\t\t\t\t}\n>\t\t\t\t\t}\n>\t\t\t\t})\n>},\n>\t\t\t\n>```\n>\n>```\n>//保存本地\n>\n>startSaveImage() {\n>\t\t\t\tuni.saveImageToPhotosAlbum({\n>\t\t\t\t\tfilePath: this.poster,\n>\t\t\t\t\tsuccess: (res) => {\n>\t\t\t\t\t\tuni.showToast({\n>\t\t\t\t\t\t\ttitle: '保存成功',\n>\t\t\t\t\t\t\ticon: 'none',\n>\t\t\t\t\t\t\tduration: 4000\n>\t\t\t\t\t\t})\n>\t\t\t\t\t\tthis.$refs.popup.close()\n>\t\t\t\t\t}\n>\t\t\t\t})\n>},\n>```\n>\n>css样式\n>\n>```css\n>.mask {\n>\t\tposition: fixed;\n>\t\ttop: 0;\n>\t\tleft: 0;\n>\t\tz-index: 998;\n>\t\twidth: 100vw;\n>\t\theight: 100%;\n>\t\tbackground-color: #000000;\n>\t\toverflow: hidden;\n>\t}\n>\n>\t.board {\n>\t\tanimation: myframe 0.3s;\n>\t\tposition: fixed;\n>\t\ttop: 50%;\n>\t\tleft: 50%;\n>\t\ttransform: translate(-50%, -50%);\n>\n>\t\tz-index: 999;\n>\t}\n>\n>\t.sure {\n>\t\ttext-align: center;\n>\t\tdisplay: block;\n>\t\twidth: 46rpx;\n>\t\tmargin: 0 auto;\n>\t\tfont-size: 32rpx;\n>\t\tcolor: #fff;\n>\t\theight: 46rpx;\n>\t\tborder-radius: 50%;\n>\t\tline-height: 44rpx;\n>\t\tborder: 1px solid #ffffff;\n>\t\tfont-family: '楷体';\n>\t}\n>.heart {\n>\t\tposition: relative;\n>\t\tbottom: -540px;\n>\t}\n>\n>```\n>\n![效果图](https://img-blog.csdnimg.cn/257eb9d300c54ba6b1d96fab0a2ab971.png)\n\n\n\n效果图\n\n\n参考：[uniapp点击生成商品海报、下载海报、分享海报](https://blog.csdn.net/SunFlower914/article/details/129086268)\n[微信小程序Canvas绘制主页保存到手机相册](https://blog.csdn.net/weixin_44157191/article/details/125083841?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168482699316800182742427%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=168482699316800182742427&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-125083841-null-null.142%5Ev87%5Econtrol,239%5Ev2%5Einsert_chatgpt&utm_term=%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%AE%BE%E7%BD%AEcanvas%E8%B6%85%E5%87%BA%E4%B8%89%E8%A1%8C%E9%9A%90%E8%97%8F&spm=1018.2226.3001.4187)\n","slug":"6","published":1,"date":"2023-08-07T02:04:35.908Z","updated":"2023-08-07T00:58:21.739Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll0f74sf000a3gs40n720mat","content":"<blockquote>\n<p>页面布局</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;mask&quot;</span> <span class=\"attr\">v-show</span>=<span class=\"string\">&quot;isShow&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&#x27;board&#x27;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;heart&quot;</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;sure&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;isShow=false&quot;</span>&gt;</span>×<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">canvas</span> @<span class=\"attr\">longpress</span>=<span class=\"string\">&quot;saveHomepage&quot;</span> \t<span class=\"attr\">:style</span>=<span class=\"string\">&quot;&#x27;width:&#x27;+canvasWidth+&#x27;px;height:&#x27;+ canvasHeight+&#x27;px;&#x27;&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t\t\t<span class=\"attr\">canvas-id</span>=<span class=\"string\">&quot;myCanvas&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">&gt;<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">&gt;<span class=\"tag\">&lt;<span class=\"name\">view</span>  <span class=\"attr\">class</span>=<span class=\"string\">&quot;foot-icon-card&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;addCanvas(activity)&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../../static/icons/haibao.svg&quot;</span>&gt;</span> <span class=\"tag\">&lt;/<span class=\"name\">image</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">text</span>&gt;</span>生成海报<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">&gt;<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>data属性定义</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;<span class=\"attr\">canvasWidth</span>: <span class=\"number\">300</span>,</span><br><span class=\"line\">&gt;<span class=\"attr\">canvasHeight</span>: <span class=\"number\">500</span>,</span><br><span class=\"line\">&gt;<span class=\"attr\">isShow</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">&gt;<span class=\"attr\">img_pop</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">&gt;<span class=\"attr\">poster</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">&gt;<span class=\"attr\">imageList</span>: [</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zHfp9.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zHT0K.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zHhlR.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zHRfJ.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zH2Y4.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zHom6.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zH5Ox.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zH461.jpg&quot;</span>,</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>methods实现</p>\n</blockquote>\n<blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;<span class=\"comment\">//文字自动换行显示，超出指定范围用...代替显示</span></span><br><span class=\"line\"></span><br><span class=\"line\">&gt;<span class=\"title function_\">textSplit</span>(<span class=\"params\">ctx, text, lineWidth, lines</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">const</span> charWidths = <span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(text, <span class=\"function\"><span class=\"params\">char</span> =&gt;</span> ctx.<span class=\"title function_\">measureText</span>(char).<span class=\"property\">width</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">let</span> textArr = [];</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">let</span> c_text = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">let</span> lineCount = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; text.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">const</span> charWidth = charWidths[i];</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (ctx.<span class=\"title function_\">measureText</span>(c_text).<span class=\"property\">width</span> + charWidth &lt; lineWidth) &#123;</span><br><span class=\"line\">\t\t\t\t\tc_text += text[i];</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tlineCount++;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (lineCount === lines) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">const</span> lastLineWidth = ctx.<span class=\"title function_\">measureText</span>(c_text).<span class=\"property\">width</span>;</span><br><span class=\"line\">\t\t\t\t\t\tc_text = c_text.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, -<span class=\"number\">1</span>);</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">while</span> (ctx.<span class=\"title function_\">measureText</span>(c_text + <span class=\"string\">&#x27;...&#x27;</span>).<span class=\"property\">width</span> &gt; lineWidth) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tc_text = c_text.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, -<span class=\"number\">1</span>);</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\tc_text += <span class=\"string\">&#x27;...&#x27;</span>;</span><br><span class=\"line\">\t\t\t\t\t\ttextArr.<span class=\"title function_\">push</span>(c_text);</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">return</span> textArr;</span><br><span class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\ttextArr.<span class=\"title function_\">push</span>(c_text);</span><br><span class=\"line\">\t\t\t\t\t\tc_text = text[i];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 当长度小于指定的 `lineWidth` 时，直接返回传入的文本内容</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (textArr.<span class=\"property\">length</span> === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> [text];</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 添加最后一行文本内容</span></span><br><span class=\"line\">\t\t\ttextArr.<span class=\"title function_\">push</span>(c_text);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 如果超过了指定行数，则修改最后一行内容，并返回修改后的文本数组。</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (textArr.<span class=\"property\">length</span> &gt; lines) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">const</span> lastLineWidth = ctx.<span class=\"title function_\">measureText</span>(c_text).<span class=\"property\">width</span>;</span><br><span class=\"line\">\t\t\t\tc_text = textArr.<span class=\"title function_\">pop</span>();</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (ctx.<span class=\"title function_\">measureText</span>(c_text + <span class=\"string\">&#x27;...&#x27;</span>).<span class=\"property\">width</span> &gt; lineWidth) &#123;</span><br><span class=\"line\">\t\t\t\t\tc_text = c_text.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, -<span class=\"number\">1</span>);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tc_text += <span class=\"string\">&#x27;...&#x27;</span>;</span><br><span class=\"line\">\t\t\t\ttextArr.<span class=\"title function_\">push</span>(c_text);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> textArr;</span><br><span class=\"line\">\t\t&#125;</span><br></pre></td></tr></table></figure>\n</blockquote>\n<blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;<span class=\"comment\">//图片网络路径转换为临时路径</span></span><br><span class=\"line\">&gt;<span class=\"title function_\">getImgUrl</span>(<span class=\"params\">img</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">result, rej</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\twx.<span class=\"title function_\">getImageInfo</span>(&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">src</span>: img,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res, <span class=\"string\">&quot;获取&quot;</span>);</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"title function_\">result</span>(res.<span class=\"property\">path</span>)</span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">fail</span>: <span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"title function_\">rej</span>(error)</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">&gt;&#125;,</span><br></pre></td></tr></table></figure>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">addCanvas</span>(<span class=\"params\">item</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">isShow</span> = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">foot</span> = <span class=\"string\">&#x27;close&#x27;</span></span><br><span class=\"line\">\t\t\t\tuni.<span class=\"title function_\">showLoading</span>(&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">title</span>: <span class=\"string\">&#x27;正在生成海报&#x27;</span></span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> ctx = wx.<span class=\"title function_\">createCanvasContext</span>(<span class=\"string\">&#x27;myCanvas&#x27;</span>)</span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#fff&#x27;</span>;</span><br><span class=\"line\">\t\t\t\tctx.<span class=\"title function_\">fillRect</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasHeight</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 封面图</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (item.<span class=\"property\">avatar</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"title function_\">drawImage</span>(<span class=\"keyword\">await</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">getImgUrl</span>(item.<span class=\"property\">avatar</span>), <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span>, <span class=\"number\">200</span>)</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">//随机背景图</span></span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"title function_\">drawImage</span>(<span class=\"keyword\">await</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">getImgUrl</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">imageList</span>[<span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">8</span>)]), <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"variable language_\">this</span></span><br><span class=\"line\">\t\t\t\t\t\t.<span class=\"property\">canvasWidth</span>, <span class=\"number\">200</span>)</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//标题</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">`normal 20px `</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#000&#x27;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> nameText = <span class=\"variable language_\">this</span>.<span class=\"title function_\">textSplit</span>(ctx, item.<span class=\"property\">name</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> - <span class=\"number\">20</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\tnameText.<span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">r</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"title function_\">fillText</span>(r, <span class=\"number\">15</span>, <span class=\"number\">220</span>)</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//活动内容</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> lineHeight = <span class=\"number\">25</span>; <span class=\"comment\">//文字行高</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> text = <span class=\"variable language_\">this</span>.<span class=\"title function_\">textSplit</span>(ctx, item.<span class=\"property\">description</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> + <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> / <span class=\"number\">3</span>, <span class=\"number\">3</span>)</span><br><span class=\"line\">\t\t\t\ttext.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">r, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">`normal 14px `</span></span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#636363&#x27;</span></span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"title function_\">fillText</span>(r, <span class=\"number\">15</span>, <span class=\"number\">250</span> + index * lineHeight)</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//地点</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">`normal 14px `</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#000&#x27;</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"title function_\">fillText</span>(<span class=\"string\">&#x27;活动地点：&#x27;</span>, <span class=\"number\">15</span>, <span class=\"number\">350</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> textAdress = <span class=\"variable language_\">this</span>.<span class=\"title function_\">textSplit</span>(ctx, item.<span class=\"property\">address</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> - <span class=\"number\">100</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">\t\t\t\ttextAdress.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">r, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">`normal 14px `</span></span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#636363&#x27;</span></span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"title function_\">fillText</span>(r, <span class=\"number\">15</span>, <span class=\"number\">370</span> + index * lineHeight)</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//时间</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">`normal 14px `</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#000&#x27;</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"title function_\">fillText</span>(<span class=\"string\">&#x27;时间：&#x27;</span>, <span class=\"number\">15</span>, <span class=\"number\">420</span>)</span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">`normal 14px `</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#000&#x27;</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"title function_\">fillText</span>(item.<span class=\"property\">start_date</span> + <span class=\"string\">&quot; &quot;</span> + item.<span class=\"property\">start_time</span>, <span class=\"number\">15</span>, <span class=\"number\">440</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 二维码</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"title function_\">drawImage</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">img_pop</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> / <span class=\"number\">2</span> + <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> / <span class=\"number\">4</span>, <span class=\"number\">340</span>, <span class=\"number\">70</span>, <span class=\"number\">70</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 底部文字</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">&#x27;normal 12px &#x27;</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#9C9C9C&#x27;</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"title function_\">fillText</span>(<span class=\"string\">&#x27;长按识别或保存图片&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> / <span class=\"number\">3</span>, <span class=\"number\">470</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//开始绘画</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">await</span> ctx.<span class=\"title function_\">draw</span>(<span class=\"literal\">true</span>, <span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\tuni.<span class=\"title function_\">canvasToTempFilePath</span>(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">canvasId</span>: <span class=\"string\">&#x27;myCanvas&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">success</span>: <span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">poster</span> = res.<span class=\"property\">tempFilePath</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\tuni.<span class=\"title function_\">hideLoading</span>()</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">fail</span>: <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\tuni.<span class=\"title function_\">hideLoading</span>()</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;, <span class=\"variable language_\">this</span>)</span><br><span class=\"line\">\t\t\t\t\t&#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t&#125;,</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;<span class=\"comment\">// 判断是否有写入相册的权限</span></span><br><span class=\"line\">\t\t<span class=\"title function_\">saveHomepage</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">let</span> that = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//判断当前小程序是否有保存相册的权限</span></span><br><span class=\"line\">\t\t\twx.<span class=\"title function_\">getSetting</span>(&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"title function_\">success</span>(<span class=\"params\">res</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (!res.<span class=\"property\">authSetting</span>[<span class=\"string\">&#x27;scope.writePhotosAlbum&#x27;</span>]) &#123;</span><br><span class=\"line\">\t\t\t\t\t\twx.<span class=\"title function_\">authorize</span>(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">scope</span>: <span class=\"string\">&#x27;scope.writePhotosAlbum&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"title function_\">success</span>(<span class=\"params\">res</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\tthat.<span class=\"title function_\">startSaveImage</span>();</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"title function_\">fail</span>(<span class=\"params\"></span>) &#123; <span class=\"comment\">//这里是用户拒绝授权后的回调</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\twx.<span class=\"title function_\">showModal</span>(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"attr\">content</span>: <span class=\"string\">&#x27;请允许相册权限,拒绝将无法正常使用小程序&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"attr\">showCancel</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"title function_\">success</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\twx.<span class=\"title function_\">openSetting</span>(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t<span class=\"title function_\">success</span>(<span class=\"params\">settingdata</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (settingdata.<span class=\"property\">authSetting</span>[</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"string\">&quot;scope.writePhotosAlbum&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t]) &#123;&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;获取权限失败&quot;</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\tthat.<span class=\"title function_\">startSaveImage</span>();</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">&gt;&#125;,</span><br><span class=\"line\">\t\t</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;//保存本地</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;startSaveImage() &#123;</span><br><span class=\"line\">\t\t\tuni.saveImageToPhotosAlbum(&#123;</span><br><span class=\"line\">\t\t\t\tfilePath: this.poster,</span><br><span class=\"line\">\t\t\t\tsuccess: (res) =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t\tuni.showToast(&#123;</span><br><span class=\"line\">\t\t\t\t\t\ttitle: &#x27;保存成功&#x27;,</span><br><span class=\"line\">\t\t\t\t\t\ticon: &#x27;none&#x27;,</span><br><span class=\"line\">\t\t\t\t\t\tduration: 4000</span><br><span class=\"line\">\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t\tthis.$refs.popup.close()</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">&gt;&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>css样式</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;<span class=\"selector-class\">.mask</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">\t<span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">z-index</span>: <span class=\"number\">998</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">width</span>: <span class=\"number\">100vw</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"number\">#000000</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.board</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">animation</span>: myframe <span class=\"number\">0.3s</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">\t<span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-<span class=\"number\">50%</span>, -<span class=\"number\">50%</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"attribute\">z-index</span>: <span class=\"number\">999</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sure</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">\t<span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">\t<span class=\"attribute\">width</span>: <span class=\"number\">46</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">32</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">height</span>: <span class=\"number\">46</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">line-height</span>: <span class=\"number\">44</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ffffff</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">font-family</span>: <span class=\"string\">&#x27;楷体&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&gt;<span class=\"selector-class\">.heart</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">\t<span class=\"attribute\">bottom</span>: -<span class=\"number\">540px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n</blockquote>\n<p><img src=\"https://img-blog.csdnimg.cn/257eb9d300c54ba6b1d96fab0a2ab971.png\" alt=\"效果图\"></p>\n<p>效果图</p>\n<p>参考：<a href=\"https://blog.csdn.net/SunFlower914/article/details/129086268\">uniapp点击生成商品海报、下载海报、分享海报</a><br><a href=\"https://blog.csdn.net/weixin_44157191/article/details/125083841?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168482699316800182742427%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=168482699316800182742427&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-125083841-null-null.142%5Ev87%5Econtrol,239%5Ev2%5Einsert_chatgpt&utm_term=%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%AE%BE%E7%BD%AEcanvas%E8%B6%85%E5%87%BA%E4%B8%89%E8%A1%8C%E9%9A%90%E8%97%8F&spm=1018.2226.3001.4187\">微信小程序Canvas绘制主页保存到手机相册</a></p>\n","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<blockquote>\n<p>页面布局</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;mask&quot;</span> <span class=\"attr\">v-show</span>=<span class=\"string\">&quot;isShow&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&#x27;board&#x27;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;heart&quot;</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;sure&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;isShow=false&quot;</span>&gt;</span>×<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">canvas</span> @<span class=\"attr\">longpress</span>=<span class=\"string\">&quot;saveHomepage&quot;</span> \t<span class=\"attr\">:style</span>=<span class=\"string\">&quot;&#x27;width:&#x27;+canvasWidth+&#x27;px;height:&#x27;+ canvasHeight+&#x27;px;&#x27;&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t\t\t<span class=\"attr\">canvas-id</span>=<span class=\"string\">&quot;myCanvas&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">&gt;<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">&gt;<span class=\"tag\">&lt;<span class=\"name\">view</span>  <span class=\"attr\">class</span>=<span class=\"string\">&quot;foot-icon-card&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;addCanvas(activity)&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../../static/icons/haibao.svg&quot;</span>&gt;</span> <span class=\"tag\">&lt;/<span class=\"name\">image</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">text</span>&gt;</span>生成海报<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">&gt;<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>data属性定义</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;<span class=\"attr\">canvasWidth</span>: <span class=\"number\">300</span>,</span><br><span class=\"line\">&gt;<span class=\"attr\">canvasHeight</span>: <span class=\"number\">500</span>,</span><br><span class=\"line\">&gt;<span class=\"attr\">isShow</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">&gt;<span class=\"attr\">img_pop</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">&gt;<span class=\"attr\">poster</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">&gt;<span class=\"attr\">imageList</span>: [</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zHfp9.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zHT0K.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zHhlR.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zHRfJ.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zH2Y4.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zHom6.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zH5Ox.jpg&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;https://s1.ax1x.com/2023/06/02/p9zH461.jpg&quot;</span>,</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>methods实现</p>\n</blockquote>\n<blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;<span class=\"comment\">//文字自动换行显示，超出指定范围用...代替显示</span></span><br><span class=\"line\"></span><br><span class=\"line\">&gt;<span class=\"title function_\">textSplit</span>(<span class=\"params\">ctx, text, lineWidth, lines</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">const</span> charWidths = <span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(text, <span class=\"function\"><span class=\"params\">char</span> =&gt;</span> ctx.<span class=\"title function_\">measureText</span>(char).<span class=\"property\">width</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">let</span> textArr = [];</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">let</span> c_text = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">let</span> lineCount = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; text.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">const</span> charWidth = charWidths[i];</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (ctx.<span class=\"title function_\">measureText</span>(c_text).<span class=\"property\">width</span> + charWidth &lt; lineWidth) &#123;</span><br><span class=\"line\">\t\t\t\t\tc_text += text[i];</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tlineCount++;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (lineCount === lines) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">const</span> lastLineWidth = ctx.<span class=\"title function_\">measureText</span>(c_text).<span class=\"property\">width</span>;</span><br><span class=\"line\">\t\t\t\t\t\tc_text = c_text.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, -<span class=\"number\">1</span>);</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">while</span> (ctx.<span class=\"title function_\">measureText</span>(c_text + <span class=\"string\">&#x27;...&#x27;</span>).<span class=\"property\">width</span> &gt; lineWidth) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tc_text = c_text.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, -<span class=\"number\">1</span>);</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\tc_text += <span class=\"string\">&#x27;...&#x27;</span>;</span><br><span class=\"line\">\t\t\t\t\t\ttextArr.<span class=\"title function_\">push</span>(c_text);</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">return</span> textArr;</span><br><span class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\ttextArr.<span class=\"title function_\">push</span>(c_text);</span><br><span class=\"line\">\t\t\t\t\t\tc_text = text[i];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 当长度小于指定的 `lineWidth` 时，直接返回传入的文本内容</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (textArr.<span class=\"property\">length</span> === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> [text];</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 添加最后一行文本内容</span></span><br><span class=\"line\">\t\t\ttextArr.<span class=\"title function_\">push</span>(c_text);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 如果超过了指定行数，则修改最后一行内容，并返回修改后的文本数组。</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (textArr.<span class=\"property\">length</span> &gt; lines) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">const</span> lastLineWidth = ctx.<span class=\"title function_\">measureText</span>(c_text).<span class=\"property\">width</span>;</span><br><span class=\"line\">\t\t\t\tc_text = textArr.<span class=\"title function_\">pop</span>();</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (ctx.<span class=\"title function_\">measureText</span>(c_text + <span class=\"string\">&#x27;...&#x27;</span>).<span class=\"property\">width</span> &gt; lineWidth) &#123;</span><br><span class=\"line\">\t\t\t\t\tc_text = c_text.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, -<span class=\"number\">1</span>);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tc_text += <span class=\"string\">&#x27;...&#x27;</span>;</span><br><span class=\"line\">\t\t\t\ttextArr.<span class=\"title function_\">push</span>(c_text);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> textArr;</span><br><span class=\"line\">\t\t&#125;</span><br></pre></td></tr></table></figure>\n</blockquote>\n<blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;<span class=\"comment\">//图片网络路径转换为临时路径</span></span><br><span class=\"line\">&gt;<span class=\"title function_\">getImgUrl</span>(<span class=\"params\">img</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">result, rej</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\twx.<span class=\"title function_\">getImageInfo</span>(&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">src</span>: img,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res, <span class=\"string\">&quot;获取&quot;</span>);</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"title function_\">result</span>(res.<span class=\"property\">path</span>)</span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">fail</span>: <span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"title function_\">rej</span>(error)</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">&gt;&#125;,</span><br></pre></td></tr></table></figure>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">addCanvas</span>(<span class=\"params\">item</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">isShow</span> = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">foot</span> = <span class=\"string\">&#x27;close&#x27;</span></span><br><span class=\"line\">\t\t\t\tuni.<span class=\"title function_\">showLoading</span>(&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">title</span>: <span class=\"string\">&#x27;正在生成海报&#x27;</span></span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> ctx = wx.<span class=\"title function_\">createCanvasContext</span>(<span class=\"string\">&#x27;myCanvas&#x27;</span>)</span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#fff&#x27;</span>;</span><br><span class=\"line\">\t\t\t\tctx.<span class=\"title function_\">fillRect</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasHeight</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 封面图</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (item.<span class=\"property\">avatar</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"title function_\">drawImage</span>(<span class=\"keyword\">await</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">getImgUrl</span>(item.<span class=\"property\">avatar</span>), <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span>, <span class=\"number\">200</span>)</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">//随机背景图</span></span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"title function_\">drawImage</span>(<span class=\"keyword\">await</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">getImgUrl</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">imageList</span>[<span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">8</span>)]), <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"variable language_\">this</span></span><br><span class=\"line\">\t\t\t\t\t\t.<span class=\"property\">canvasWidth</span>, <span class=\"number\">200</span>)</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//标题</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">`normal 20px `</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#000&#x27;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> nameText = <span class=\"variable language_\">this</span>.<span class=\"title function_\">textSplit</span>(ctx, item.<span class=\"property\">name</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> - <span class=\"number\">20</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\tnameText.<span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">r</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"title function_\">fillText</span>(r, <span class=\"number\">15</span>, <span class=\"number\">220</span>)</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//活动内容</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> lineHeight = <span class=\"number\">25</span>; <span class=\"comment\">//文字行高</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> text = <span class=\"variable language_\">this</span>.<span class=\"title function_\">textSplit</span>(ctx, item.<span class=\"property\">description</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> + <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> / <span class=\"number\">3</span>, <span class=\"number\">3</span>)</span><br><span class=\"line\">\t\t\t\ttext.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">r, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">`normal 14px `</span></span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#636363&#x27;</span></span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"title function_\">fillText</span>(r, <span class=\"number\">15</span>, <span class=\"number\">250</span> + index * lineHeight)</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//地点</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">`normal 14px `</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#000&#x27;</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"title function_\">fillText</span>(<span class=\"string\">&#x27;活动地点：&#x27;</span>, <span class=\"number\">15</span>, <span class=\"number\">350</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> textAdress = <span class=\"variable language_\">this</span>.<span class=\"title function_\">textSplit</span>(ctx, item.<span class=\"property\">address</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> - <span class=\"number\">100</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">\t\t\t\ttextAdress.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">r, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">`normal 14px `</span></span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#636363&#x27;</span></span><br><span class=\"line\">\t\t\t\t\tctx.<span class=\"title function_\">fillText</span>(r, <span class=\"number\">15</span>, <span class=\"number\">370</span> + index * lineHeight)</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//时间</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">`normal 14px `</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#000&#x27;</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"title function_\">fillText</span>(<span class=\"string\">&#x27;时间：&#x27;</span>, <span class=\"number\">15</span>, <span class=\"number\">420</span>)</span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">`normal 14px `</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#000&#x27;</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"title function_\">fillText</span>(item.<span class=\"property\">start_date</span> + <span class=\"string\">&quot; &quot;</span> + item.<span class=\"property\">start_time</span>, <span class=\"number\">15</span>, <span class=\"number\">440</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 二维码</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"title function_\">drawImage</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">img_pop</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> / <span class=\"number\">2</span> + <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> / <span class=\"number\">4</span>, <span class=\"number\">340</span>, <span class=\"number\">70</span>, <span class=\"number\">70</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 底部文字</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">font</span> = <span class=\"string\">&#x27;normal 12px &#x27;</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"property\">fillStyle</span> = <span class=\"string\">&#x27;#9C9C9C&#x27;</span></span><br><span class=\"line\">\t\t\t\tctx.<span class=\"title function_\">fillText</span>(<span class=\"string\">&#x27;长按识别或保存图片&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">canvasWidth</span> / <span class=\"number\">3</span>, <span class=\"number\">470</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//开始绘画</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">await</span> ctx.<span class=\"title function_\">draw</span>(<span class=\"literal\">true</span>, <span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\tuni.<span class=\"title function_\">canvasToTempFilePath</span>(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">canvasId</span>: <span class=\"string\">&#x27;myCanvas&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">success</span>: <span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">poster</span> = res.<span class=\"property\">tempFilePath</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\tuni.<span class=\"title function_\">hideLoading</span>()</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">fail</span>: <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\tuni.<span class=\"title function_\">hideLoading</span>()</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;, <span class=\"variable language_\">this</span>)</span><br><span class=\"line\">\t\t\t\t\t&#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t&#125;,</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;<span class=\"comment\">// 判断是否有写入相册的权限</span></span><br><span class=\"line\">\t\t<span class=\"title function_\">saveHomepage</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">let</span> that = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//判断当前小程序是否有保存相册的权限</span></span><br><span class=\"line\">\t\t\twx.<span class=\"title function_\">getSetting</span>(&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"title function_\">success</span>(<span class=\"params\">res</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (!res.<span class=\"property\">authSetting</span>[<span class=\"string\">&#x27;scope.writePhotosAlbum&#x27;</span>]) &#123;</span><br><span class=\"line\">\t\t\t\t\t\twx.<span class=\"title function_\">authorize</span>(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">scope</span>: <span class=\"string\">&#x27;scope.writePhotosAlbum&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"title function_\">success</span>(<span class=\"params\">res</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\tthat.<span class=\"title function_\">startSaveImage</span>();</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"title function_\">fail</span>(<span class=\"params\"></span>) &#123; <span class=\"comment\">//这里是用户拒绝授权后的回调</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\twx.<span class=\"title function_\">showModal</span>(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"attr\">content</span>: <span class=\"string\">&#x27;请允许相册权限,拒绝将无法正常使用小程序&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"attr\">showCancel</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"title function_\">success</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\twx.<span class=\"title function_\">openSetting</span>(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t<span class=\"title function_\">success</span>(<span class=\"params\">settingdata</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (settingdata.<span class=\"property\">authSetting</span>[</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"string\">&quot;scope.writePhotosAlbum&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t]) &#123;&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;获取权限失败&quot;</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\tthat.<span class=\"title function_\">startSaveImage</span>();</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">&gt;&#125;,</span><br><span class=\"line\">\t\t</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;//保存本地</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;startSaveImage() &#123;</span><br><span class=\"line\">\t\t\tuni.saveImageToPhotosAlbum(&#123;</span><br><span class=\"line\">\t\t\t\tfilePath: this.poster,</span><br><span class=\"line\">\t\t\t\tsuccess: (res) =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t\tuni.showToast(&#123;</span><br><span class=\"line\">\t\t\t\t\t\ttitle: &#x27;保存成功&#x27;,</span><br><span class=\"line\">\t\t\t\t\t\ticon: &#x27;none&#x27;,</span><br><span class=\"line\">\t\t\t\t\t\tduration: 4000</span><br><span class=\"line\">\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t\tthis.$refs.popup.close()</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">&gt;&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>css样式</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;<span class=\"selector-class\">.mask</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">\t<span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">z-index</span>: <span class=\"number\">998</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">width</span>: <span class=\"number\">100vw</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"number\">#000000</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.board</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">animation</span>: myframe <span class=\"number\">0.3s</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">\t<span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-<span class=\"number\">50%</span>, -<span class=\"number\">50%</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"attribute\">z-index</span>: <span class=\"number\">999</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sure</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">\t<span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">\t<span class=\"attribute\">width</span>: <span class=\"number\">46</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">32</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">height</span>: <span class=\"number\">46</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">line-height</span>: <span class=\"number\">44</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ffffff</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">font-family</span>: <span class=\"string\">&#x27;楷体&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&gt;<span class=\"selector-class\">.heart</span> &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">\t<span class=\"attribute\">bottom</span>: -<span class=\"number\">540px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n</blockquote>\n<p><img src=\"https://img-blog.csdnimg.cn/257eb9d300c54ba6b1d96fab0a2ab971.png\" alt=\"效果图\"></p>\n<p>效果图</p>\n<p>参考：<a href=\"https://blog.csdn.net/SunFlower914/article/details/129086268\">uniapp点击生成商品海报、下载海报、分享海报</a><br><a href=\"https://blog.csdn.net/weixin_44157191/article/details/125083841?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168482699316800182742427%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=168482699316800182742427&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-125083841-null-null.142%5Ev87%5Econtrol,239%5Ev2%5Einsert_chatgpt&utm_term=%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%AE%BE%E7%BD%AEcanvas%E8%B6%85%E5%87%BA%E4%B8%89%E8%A1%8C%E9%9A%90%E8%97%8F&spm=1018.2226.3001.4187\">微信小程序Canvas绘制主页保存到手机相册</a></p>\n"},{"title":"uniapp实现上传多张图片功能","cover":"https://s1.ax1x.com/2023/08/04/pPFRbYn.jpg","_content":"\n\n#### 实现效果：\n\n[![pPEZRI0.png](https://s1.ax1x.com/2023/08/07/pPEZRI0.png)](https://imgse.com/i/pPEZRI0)\n\n\n`2023-4-13  修改  []传参数组之对h5有用   app端只取到一张图片`\n```html\n<u-form-item :label-position=\"labelPosition\" label=\"上传图片\" prop=\"photo\" label-width=\"150\">\n    <u-upload width=\"160\" height=\"160\" :auto-upload=\"false\" @on-list-change=\"imageListChange\"\n\t\t:source-type=\"['camera']\" ref=\"uUpload\" :custom-btn=\"true\">\n        <view slot=\"addBtn\" class=\"slot-btn\" hover-class=\"slot-btn__hover\" hover-stay-time=\"150\">\n            <u-icon name=\"camera\" size=\"60\" color=\"#606266\"></u-icon>\n            <span class=\"text\">拍照上传</span>\n        </view>\n    </u-upload>\n</u-form-item>\n```\n\n\n```js\nimageListChange(lists, name) {\n    this.paramObj.images = []\n    if (lists.length > 0) {\n        lists.forEach((r, index) => {\n            r.file.uri = r.file.path\n            let obj = {}\n           // obj.name = 'images[]';  app端无效\n          \t obj.name = 'image'+index;\n            //默认的name是file,后端接口写的是images 不加[]，选择多张图片时会只传一张  \n            obj.uri = r.file.path; \n            // uni.uploadFile(OBJECT) files参数格式为[{name:''，file:File,uri :'必需项'}]\n            this.paramObj.images.push(obj)\n        })\n    } else {\n        this.paramObj.images = []\n    }\n},\n```\n\n```js\n//携带其他参数上传\nuni.uploadFile({\n        url: 'xxx',\n        files: this.paramObj.images,\n        name: 'images[]', //文档里说files时  name无效\n        formData: {\n            'p_type': this.paramObj.p_type,\n            'wo_number': this.paramObj.wo_number\n        },\n        header: {},\n        success: (res) => {\n            console.log(res);\n        },\n        fail(error) {\n            console.log(error);\n        },\n        complete() {\n            uni.hideLoading()\n        }\n    });\n```\n\n","source":"_posts/7.md","raw":"---\ntitle: uniapp实现上传多张图片功能\ncategories: uniapp\ncover: https://s1.ax1x.com/2023/08/04/pPFRbYn.jpg\n---\n\n\n#### 实现效果：\n\n[![pPEZRI0.png](https://s1.ax1x.com/2023/08/07/pPEZRI0.png)](https://imgse.com/i/pPEZRI0)\n\n\n`2023-4-13  修改  []传参数组之对h5有用   app端只取到一张图片`\n```html\n<u-form-item :label-position=\"labelPosition\" label=\"上传图片\" prop=\"photo\" label-width=\"150\">\n    <u-upload width=\"160\" height=\"160\" :auto-upload=\"false\" @on-list-change=\"imageListChange\"\n\t\t:source-type=\"['camera']\" ref=\"uUpload\" :custom-btn=\"true\">\n        <view slot=\"addBtn\" class=\"slot-btn\" hover-class=\"slot-btn__hover\" hover-stay-time=\"150\">\n            <u-icon name=\"camera\" size=\"60\" color=\"#606266\"></u-icon>\n            <span class=\"text\">拍照上传</span>\n        </view>\n    </u-upload>\n</u-form-item>\n```\n\n\n```js\nimageListChange(lists, name) {\n    this.paramObj.images = []\n    if (lists.length > 0) {\n        lists.forEach((r, index) => {\n            r.file.uri = r.file.path\n            let obj = {}\n           // obj.name = 'images[]';  app端无效\n          \t obj.name = 'image'+index;\n            //默认的name是file,后端接口写的是images 不加[]，选择多张图片时会只传一张  \n            obj.uri = r.file.path; \n            // uni.uploadFile(OBJECT) files参数格式为[{name:''，file:File,uri :'必需项'}]\n            this.paramObj.images.push(obj)\n        })\n    } else {\n        this.paramObj.images = []\n    }\n},\n```\n\n```js\n//携带其他参数上传\nuni.uploadFile({\n        url: 'xxx',\n        files: this.paramObj.images,\n        name: 'images[]', //文档里说files时  name无效\n        formData: {\n            'p_type': this.paramObj.p_type,\n            'wo_number': this.paramObj.wo_number\n        },\n        header: {},\n        success: (res) => {\n            console.log(res);\n        },\n        fail(error) {\n            console.log(error);\n        },\n        complete() {\n            uni.hideLoading()\n        }\n    });\n```\n\n","slug":"7","published":1,"date":"2023-08-07T02:04:35.912Z","updated":"2023-08-07T01:04:59.901Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll0f74sg000d3gs4d4hrbbj5","content":"<h4 id=\"实现效果：\"><a href=\"#实现效果：\" class=\"headerlink\" title=\"实现效果：\"></a>实现效果：</h4><p><a href=\"https://imgse.com/i/pPEZRI0\"><img src=\"https://s1.ax1x.com/2023/08/07/pPEZRI0.png\" alt=\"pPEZRI0.png\"></a></p>\n<p><code>2023-4-13  修改  []传参数组之对h5有用   app端只取到一张图片</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">u-form-item</span> <span class=\"attr\">:label-position</span>=<span class=\"string\">&quot;labelPosition&quot;</span> <span class=\"attr\">label</span>=<span class=\"string\">&quot;上传图片&quot;</span> <span class=\"attr\">prop</span>=<span class=\"string\">&quot;photo&quot;</span> <span class=\"attr\">label-width</span>=<span class=\"string\">&quot;150&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">u-upload</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;160&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;160&quot;</span> <span class=\"attr\">:auto-upload</span>=<span class=\"string\">&quot;false&quot;</span> @<span class=\"attr\">on-list-change</span>=<span class=\"string\">&quot;imageListChange&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t<span class=\"attr\">:source-type</span>=<span class=\"string\">&quot;[&#x27;camera&#x27;]&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;uUpload&quot;</span> <span class=\"attr\">:custom-btn</span>=<span class=\"string\">&quot;true&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">slot</span>=<span class=\"string\">&quot;addBtn&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;slot-btn&quot;</span> <span class=\"attr\">hover-class</span>=<span class=\"string\">&quot;slot-btn__hover&quot;</span> <span class=\"attr\">hover-stay-time</span>=<span class=\"string\">&quot;150&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">u-icon</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;camera&quot;</span> <span class=\"attr\">size</span>=<span class=\"string\">&quot;60&quot;</span> <span class=\"attr\">color</span>=<span class=\"string\">&quot;#606266&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">u-icon</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;text&quot;</span>&gt;</span>拍照上传<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">u-upload</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">u-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">imageListChange</span>(<span class=\"params\">lists, name</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">paramObj</span>.<span class=\"property\">images</span> = []</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (lists.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        lists.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">r, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            r.<span class=\"property\">file</span>.<span class=\"property\">uri</span> = r.<span class=\"property\">file</span>.<span class=\"property\">path</span></span><br><span class=\"line\">            <span class=\"keyword\">let</span> obj = &#123;&#125;</span><br><span class=\"line\">           <span class=\"comment\">// obj.name = &#x27;images[]&#x27;;  app端无效</span></span><br><span class=\"line\">          \t obj.<span class=\"property\">name</span> = <span class=\"string\">&#x27;image&#x27;</span>+index;</span><br><span class=\"line\">            <span class=\"comment\">//默认的name是file,后端接口写的是images 不加[]，选择多张图片时会只传一张  </span></span><br><span class=\"line\">            obj.<span class=\"property\">uri</span> = r.<span class=\"property\">file</span>.<span class=\"property\">path</span>; </span><br><span class=\"line\">            <span class=\"comment\">// uni.uploadFile(OBJECT) files参数格式为[&#123;name:&#x27;&#x27;，file:File,uri :&#x27;必需项&#x27;&#125;]</span></span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">paramObj</span>.<span class=\"property\">images</span>.<span class=\"title function_\">push</span>(obj)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">paramObj</span>.<span class=\"property\">images</span> = []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//携带其他参数上传</span></span><br><span class=\"line\">uni.<span class=\"title function_\">uploadFile</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;xxx&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">files</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">paramObj</span>.<span class=\"property\">images</span>,</span><br><span class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">&#x27;images[]&#x27;</span>, <span class=\"comment\">//文档里说files时  name无效</span></span><br><span class=\"line\">        <span class=\"attr\">formData</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;p_type&#x27;</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">paramObj</span>.<span class=\"property\">p_type</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;wo_number&#x27;</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">paramObj</span>.<span class=\"property\">wo_number</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">header</span>: &#123;&#125;,</span><br><span class=\"line\">        <span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"title function_\">fail</span>(<span class=\"params\">error</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(error);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"title function_\">complete</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            uni.<span class=\"title function_\">hideLoading</span>()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<h4 id=\"实现效果：\"><a href=\"#实现效果：\" class=\"headerlink\" title=\"实现效果：\"></a>实现效果：</h4><p><a href=\"https://imgse.com/i/pPEZRI0\"><img src=\"https://s1.ax1x.com/2023/08/07/pPEZRI0.png\" alt=\"pPEZRI0.png\"></a></p>\n<p><code>2023-4-13  修改  []传参数组之对h5有用   app端只取到一张图片</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">u-form-item</span> <span class=\"attr\">:label-position</span>=<span class=\"string\">&quot;labelPosition&quot;</span> <span class=\"attr\">label</span>=<span class=\"string\">&quot;上传图片&quot;</span> <span class=\"attr\">prop</span>=<span class=\"string\">&quot;photo&quot;</span> <span class=\"attr\">label-width</span>=<span class=\"string\">&quot;150&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">u-upload</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;160&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;160&quot;</span> <span class=\"attr\">:auto-upload</span>=<span class=\"string\">&quot;false&quot;</span> @<span class=\"attr\">on-list-change</span>=<span class=\"string\">&quot;imageListChange&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t<span class=\"attr\">:source-type</span>=<span class=\"string\">&quot;[&#x27;camera&#x27;]&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;uUpload&quot;</span> <span class=\"attr\">:custom-btn</span>=<span class=\"string\">&quot;true&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">slot</span>=<span class=\"string\">&quot;addBtn&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;slot-btn&quot;</span> <span class=\"attr\">hover-class</span>=<span class=\"string\">&quot;slot-btn__hover&quot;</span> <span class=\"attr\">hover-stay-time</span>=<span class=\"string\">&quot;150&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">u-icon</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;camera&quot;</span> <span class=\"attr\">size</span>=<span class=\"string\">&quot;60&quot;</span> <span class=\"attr\">color</span>=<span class=\"string\">&quot;#606266&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">u-icon</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;text&quot;</span>&gt;</span>拍照上传<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">u-upload</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">u-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">imageListChange</span>(<span class=\"params\">lists, name</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">paramObj</span>.<span class=\"property\">images</span> = []</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (lists.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        lists.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">r, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            r.<span class=\"property\">file</span>.<span class=\"property\">uri</span> = r.<span class=\"property\">file</span>.<span class=\"property\">path</span></span><br><span class=\"line\">            <span class=\"keyword\">let</span> obj = &#123;&#125;</span><br><span class=\"line\">           <span class=\"comment\">// obj.name = &#x27;images[]&#x27;;  app端无效</span></span><br><span class=\"line\">          \t obj.<span class=\"property\">name</span> = <span class=\"string\">&#x27;image&#x27;</span>+index;</span><br><span class=\"line\">            <span class=\"comment\">//默认的name是file,后端接口写的是images 不加[]，选择多张图片时会只传一张  </span></span><br><span class=\"line\">            obj.<span class=\"property\">uri</span> = r.<span class=\"property\">file</span>.<span class=\"property\">path</span>; </span><br><span class=\"line\">            <span class=\"comment\">// uni.uploadFile(OBJECT) files参数格式为[&#123;name:&#x27;&#x27;，file:File,uri :&#x27;必需项&#x27;&#125;]</span></span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">paramObj</span>.<span class=\"property\">images</span>.<span class=\"title function_\">push</span>(obj)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">paramObj</span>.<span class=\"property\">images</span> = []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//携带其他参数上传</span></span><br><span class=\"line\">uni.<span class=\"title function_\">uploadFile</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;xxx&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">files</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">paramObj</span>.<span class=\"property\">images</span>,</span><br><span class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">&#x27;images[]&#x27;</span>, <span class=\"comment\">//文档里说files时  name无效</span></span><br><span class=\"line\">        <span class=\"attr\">formData</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;p_type&#x27;</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">paramObj</span>.<span class=\"property\">p_type</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;wo_number&#x27;</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">paramObj</span>.<span class=\"property\">wo_number</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">header</span>: &#123;&#125;,</span><br><span class=\"line\">        <span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"title function_\">fail</span>(<span class=\"params\">error</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(error);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"title function_\">complete</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            uni.<span class=\"title function_\">hideLoading</span>()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>\n\n"},{"title":"uniapp实现打印功能","cover":"https://s1.ax1x.com/2023/08/04/pPFRXlV.jpg","_content":"\n\n\n### 通过IP地址连接斑马打印机\n\n```js\nexport default function print(op, ipAddress, port) {\n\t//使用ZPL指令打印\t\n\tvar ZPLString = `^XA\n\t\t^MD30\n\t\t^CWJ,E:SIMSUN.TTF^FS   \n\t\t^FO40,30^AJN,42,42^CI28^FD生产订单号:^FS^CI28\n\t\t^FO320,30^AJN,42,42^FH\\^CI28^FD` + op.aufnr + `^FS^CI28\n\t\t^FO640,30^AJN,42,42^CI28^FD数量:^FS^CI28\n\t\t^FO750,30^AJN,42,42^FH\\^CI28^FD` + op.lmnga + `^FS^CI27\n\t\t^FO40,90^AJN,42,42^CI28^FD本阶料号:^FS^CI27\n\t\t^FO320,90^AJN,42,42^FH\\^CI28^FD` + op.matnr + `^FS^CI27\n\t\t^FO40,150^AJN,42,42^CI28^FD品名规格:^FS^CI27\n\t\t^FO320,150^AJN,42,42^FH\\^CI28^FD` + op.maktx + `^FS^CI27\n\t\t^FO40,210^AJN,42,42^CI28^FD炉号:^FS^CI27\n\t\t^FO320,210^AJN,42,42^FH\\^CI28^FD` + op.charg0 + `^FS^CI27\n\t\t^FO40,380^AJN,42,42^CI28^FD填写人:^FS^CI27\n\t\t^FO320,380^AJN,42,42^FH\\^CI28^FD` + op.name + `^FS^CI27\n\t\t^FO640,380^AJN,42,42^CI28^FD日期:^FS^CI28\n\t\t^FO750,380^AJN,42,42^FH\\^CI28^FD` + op.date + `^FS^CI27\n\t\t^FO40,438^AJN,42,42^CI28^FD备注:^FS^CI28\n\t\t^PQ1,,,Y\n\t\t^XZ`\n\n\n\tif (plus.os.name == \"Android\") {\n\t\tvar Socket = plus.android.importClass(\"java.net.Socket\");\n\t\tvar PrintWriter = plus.android.importClass(\"java.io.PrintWriter\");\n\t\tvar BufferedWriter = plus.android.importClass(\"java.io.BufferedWriter\");\n\t\tvar OutputStreamWriter = plus.android.importClass(\"java.io.OutputStreamWriter\");\n\t\tvar BufferedReader = plus.android.importClass(\"java.io.BufferedReader\");\n\t\tvar InputStreamReader = plus.android.importClass(\"java.io.InputStreamReader\");\n\n\n\t\tvar StrictMode = plus.android.importClass(\"android.os.StrictMode\");\n\t\tvar Build = plus.android.importClass(\"android.os.Build\");\n\t\tif (Build.VERSION.SDK_INT > 9) {\n\t\t\tvar policy = new StrictMode.ThreadPolicy.Builder().permitAll().build();\n\t\t\tStrictMode.setThreadPolicy(policy);\n\t\t}\n\t\tconsole.log(\"连接服务器中...\")\n\t\tconsole.log(\"ip...\" + ipAddress, port)\n        //port * 1  传递过的值默认为字符串 无效   转为数值\n\t\tvar socket = new Socket(`${ipAddress}`, port * 1); // \"172.16.19.***\", 91**\n\t\tsocket.setSoTimeout(5000);\n\t\tvar inputStreamReader = new InputStreamReader(socket.getInputStream());\n\t\tvar socketReader = new BufferedReader(inputStreamReader);\n\n\t\tvar outputStreamWriter = new OutputStreamWriter(socket.getOutputStream());\n\t\tvar bufferWriter = new BufferedWriter(outputStreamWriter);\n\t\tvar socketWriter = new PrintWriter(bufferWriter, true);\n\t\tsocketWriter.println(ZPLString);\n\n\t\tconsole.log(\"socketWriter...\" + socketWriter)\n\t\tvar msgBeReceived = socketReader.readLine();\n\t\tconsole.log(msgBeReceived);\n\n\t}\n\n\n}\n\n```\n\n>打印不出中文解决办法\n>\n>指令：`^XA^WD*:*.**^XZ`\n>\n>作用：打印出所有内存信息，可以用来寻找字体信息.TTF文件\n","source":"_posts/8.md","raw":"---\ntitle: uniapp实现打印功能\ncategories: uniapp\ncover: https://s1.ax1x.com/2023/08/04/pPFRXlV.jpg\n---\n\n\n\n### 通过IP地址连接斑马打印机\n\n```js\nexport default function print(op, ipAddress, port) {\n\t//使用ZPL指令打印\t\n\tvar ZPLString = `^XA\n\t\t^MD30\n\t\t^CWJ,E:SIMSUN.TTF^FS   \n\t\t^FO40,30^AJN,42,42^CI28^FD生产订单号:^FS^CI28\n\t\t^FO320,30^AJN,42,42^FH\\^CI28^FD` + op.aufnr + `^FS^CI28\n\t\t^FO640,30^AJN,42,42^CI28^FD数量:^FS^CI28\n\t\t^FO750,30^AJN,42,42^FH\\^CI28^FD` + op.lmnga + `^FS^CI27\n\t\t^FO40,90^AJN,42,42^CI28^FD本阶料号:^FS^CI27\n\t\t^FO320,90^AJN,42,42^FH\\^CI28^FD` + op.matnr + `^FS^CI27\n\t\t^FO40,150^AJN,42,42^CI28^FD品名规格:^FS^CI27\n\t\t^FO320,150^AJN,42,42^FH\\^CI28^FD` + op.maktx + `^FS^CI27\n\t\t^FO40,210^AJN,42,42^CI28^FD炉号:^FS^CI27\n\t\t^FO320,210^AJN,42,42^FH\\^CI28^FD` + op.charg0 + `^FS^CI27\n\t\t^FO40,380^AJN,42,42^CI28^FD填写人:^FS^CI27\n\t\t^FO320,380^AJN,42,42^FH\\^CI28^FD` + op.name + `^FS^CI27\n\t\t^FO640,380^AJN,42,42^CI28^FD日期:^FS^CI28\n\t\t^FO750,380^AJN,42,42^FH\\^CI28^FD` + op.date + `^FS^CI27\n\t\t^FO40,438^AJN,42,42^CI28^FD备注:^FS^CI28\n\t\t^PQ1,,,Y\n\t\t^XZ`\n\n\n\tif (plus.os.name == \"Android\") {\n\t\tvar Socket = plus.android.importClass(\"java.net.Socket\");\n\t\tvar PrintWriter = plus.android.importClass(\"java.io.PrintWriter\");\n\t\tvar BufferedWriter = plus.android.importClass(\"java.io.BufferedWriter\");\n\t\tvar OutputStreamWriter = plus.android.importClass(\"java.io.OutputStreamWriter\");\n\t\tvar BufferedReader = plus.android.importClass(\"java.io.BufferedReader\");\n\t\tvar InputStreamReader = plus.android.importClass(\"java.io.InputStreamReader\");\n\n\n\t\tvar StrictMode = plus.android.importClass(\"android.os.StrictMode\");\n\t\tvar Build = plus.android.importClass(\"android.os.Build\");\n\t\tif (Build.VERSION.SDK_INT > 9) {\n\t\t\tvar policy = new StrictMode.ThreadPolicy.Builder().permitAll().build();\n\t\t\tStrictMode.setThreadPolicy(policy);\n\t\t}\n\t\tconsole.log(\"连接服务器中...\")\n\t\tconsole.log(\"ip...\" + ipAddress, port)\n        //port * 1  传递过的值默认为字符串 无效   转为数值\n\t\tvar socket = new Socket(`${ipAddress}`, port * 1); // \"172.16.19.***\", 91**\n\t\tsocket.setSoTimeout(5000);\n\t\tvar inputStreamReader = new InputStreamReader(socket.getInputStream());\n\t\tvar socketReader = new BufferedReader(inputStreamReader);\n\n\t\tvar outputStreamWriter = new OutputStreamWriter(socket.getOutputStream());\n\t\tvar bufferWriter = new BufferedWriter(outputStreamWriter);\n\t\tvar socketWriter = new PrintWriter(bufferWriter, true);\n\t\tsocketWriter.println(ZPLString);\n\n\t\tconsole.log(\"socketWriter...\" + socketWriter)\n\t\tvar msgBeReceived = socketReader.readLine();\n\t\tconsole.log(msgBeReceived);\n\n\t}\n\n\n}\n\n```\n\n>打印不出中文解决办法\n>\n>指令：`^XA^WD*:*.**^XZ`\n>\n>作用：打印出所有内存信息，可以用来寻找字体信息.TTF文件\n","slug":"8","published":1,"date":"2023-08-07T02:04:35.916Z","updated":"2023-08-07T01:47:20.452Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll0f74sh000f3gs40qay5128","content":"<h3 id=\"通过IP地址连接斑马打印机\"><a href=\"#通过IP地址连接斑马打印机\" class=\"headerlink\" title=\"通过IP地址连接斑马打印机\"></a>通过IP地址连接斑马打印机</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span> <span class=\"title function_\">print</span>(<span class=\"params\">op, ipAddress, port</span>) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//使用ZPL指令打印\t</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> <span class=\"title class_\">ZPLString</span> = <span class=\"string\">`^XA</span></span><br><span class=\"line\"><span class=\"string\">\t\t^MD30</span></span><br><span class=\"line\"><span class=\"string\">\t\t^CWJ,E:SIMSUN.TTF^FS   </span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO40,30^AJN,42,42^CI28^FD生产订单号:^FS^CI28</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO320,30^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">aufnr</span> + <span class=\"string\">`^FS^CI28</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO640,30^AJN,42,42^CI28^FD数量:^FS^CI28</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO750,30^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">lmnga</span> + <span class=\"string\">`^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO40,90^AJN,42,42^CI28^FD本阶料号:^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO320,90^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">matnr</span> + <span class=\"string\">`^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO40,150^AJN,42,42^CI28^FD品名规格:^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO320,150^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">maktx</span> + <span class=\"string\">`^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO40,210^AJN,42,42^CI28^FD炉号:^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO320,210^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">charg0</span> + <span class=\"string\">`^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO40,380^AJN,42,42^CI28^FD填写人:^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO320,380^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">name</span> + <span class=\"string\">`^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO640,380^AJN,42,42^CI28^FD日期:^FS^CI28</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO750,380^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">date</span> + <span class=\"string\">`^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO40,438^AJN,42,42^CI28^FD备注:^FS^CI28</span></span><br><span class=\"line\"><span class=\"string\">\t\t^PQ1,,,Y</span></span><br><span class=\"line\"><span class=\"string\">\t\t^XZ`</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (plus.<span class=\"property\">os</span>.<span class=\"property\">name</span> == <span class=\"string\">&quot;Android&quot;</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">Socket</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;java.net.Socket&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">PrintWriter</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;java.io.PrintWriter&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">BufferedWriter</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;java.io.BufferedWriter&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">OutputStreamWriter</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;java.io.OutputStreamWriter&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">BufferedReader</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;java.io.BufferedReader&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">InputStreamReader</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;java.io.InputStreamReader&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">StrictMode</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;android.os.StrictMode&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">Build</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;android.os.Build&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"title class_\">Build</span>.<span class=\"property\">VERSION</span>.<span class=\"property\">SDK_INT</span> &gt; <span class=\"number\">9</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> policy = <span class=\"keyword\">new</span> <span class=\"title class_\">StrictMode</span>.<span class=\"property\">ThreadPolicy</span>.<span class=\"title class_\">Builder</span>().<span class=\"title function_\">permitAll</span>().<span class=\"title function_\">build</span>();</span><br><span class=\"line\">\t\t\t<span class=\"title class_\">StrictMode</span>.<span class=\"title function_\">setThreadPolicy</span>(policy);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;连接服务器中...&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;ip...&quot;</span> + ipAddress, port)</span><br><span class=\"line\">        <span class=\"comment\">//port * 1  传递过的值默认为字符串 无效   转为数值</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> socket = <span class=\"keyword\">new</span> <span class=\"title class_\">Socket</span>(<span class=\"string\">`<span class=\"subst\">$&#123;ipAddress&#125;</span>`</span>, port * <span class=\"number\">1</span>); <span class=\"comment\">// &quot;172.16.19.***&quot;, 91**</span></span><br><span class=\"line\">\t\tsocket.<span class=\"title function_\">setSoTimeout</span>(<span class=\"number\">5000</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> inputStreamReader = <span class=\"keyword\">new</span> <span class=\"title class_\">InputStreamReader</span>(socket.<span class=\"title function_\">getInputStream</span>());</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> socketReader = <span class=\"keyword\">new</span> <span class=\"title class_\">BufferedReader</span>(inputStreamReader);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> outputStreamWriter = <span class=\"keyword\">new</span> <span class=\"title class_\">OutputStreamWriter</span>(socket.<span class=\"title function_\">getOutputStream</span>());</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> bufferWriter = <span class=\"keyword\">new</span> <span class=\"title class_\">BufferedWriter</span>(outputStreamWriter);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> socketWriter = <span class=\"keyword\">new</span> <span class=\"title class_\">PrintWriter</span>(bufferWriter, <span class=\"literal\">true</span>);</span><br><span class=\"line\">\t\tsocketWriter.<span class=\"title function_\">println</span>(<span class=\"title class_\">ZPLString</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;socketWriter...&quot;</span> + socketWriter)</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> msgBeReceived = socketReader.<span class=\"title function_\">readLine</span>();</span><br><span class=\"line\">\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(msgBeReceived);</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>打印不出中文解决办法</p>\n<p>指令：<code>^XA^WD*:*.**^XZ</code></p>\n<p>作用：打印出所有内存信息，可以用来寻找字体信息.TTF文件</p>\n</blockquote>\n","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<h3 id=\"通过IP地址连接斑马打印机\"><a href=\"#通过IP地址连接斑马打印机\" class=\"headerlink\" title=\"通过IP地址连接斑马打印机\"></a>通过IP地址连接斑马打印机</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span> <span class=\"title function_\">print</span>(<span class=\"params\">op, ipAddress, port</span>) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//使用ZPL指令打印\t</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> <span class=\"title class_\">ZPLString</span> = <span class=\"string\">`^XA</span></span><br><span class=\"line\"><span class=\"string\">\t\t^MD30</span></span><br><span class=\"line\"><span class=\"string\">\t\t^CWJ,E:SIMSUN.TTF^FS   </span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO40,30^AJN,42,42^CI28^FD生产订单号:^FS^CI28</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO320,30^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">aufnr</span> + <span class=\"string\">`^FS^CI28</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO640,30^AJN,42,42^CI28^FD数量:^FS^CI28</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO750,30^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">lmnga</span> + <span class=\"string\">`^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO40,90^AJN,42,42^CI28^FD本阶料号:^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO320,90^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">matnr</span> + <span class=\"string\">`^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO40,150^AJN,42,42^CI28^FD品名规格:^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO320,150^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">maktx</span> + <span class=\"string\">`^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO40,210^AJN,42,42^CI28^FD炉号:^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO320,210^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">charg0</span> + <span class=\"string\">`^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO40,380^AJN,42,42^CI28^FD填写人:^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO320,380^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">name</span> + <span class=\"string\">`^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO640,380^AJN,42,42^CI28^FD日期:^FS^CI28</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO750,380^AJN,42,42^FH\\^CI28^FD`</span> + op.<span class=\"property\">date</span> + <span class=\"string\">`^FS^CI27</span></span><br><span class=\"line\"><span class=\"string\">\t\t^FO40,438^AJN,42,42^CI28^FD备注:^FS^CI28</span></span><br><span class=\"line\"><span class=\"string\">\t\t^PQ1,,,Y</span></span><br><span class=\"line\"><span class=\"string\">\t\t^XZ`</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (plus.<span class=\"property\">os</span>.<span class=\"property\">name</span> == <span class=\"string\">&quot;Android&quot;</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">Socket</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;java.net.Socket&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">PrintWriter</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;java.io.PrintWriter&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">BufferedWriter</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;java.io.BufferedWriter&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">OutputStreamWriter</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;java.io.OutputStreamWriter&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">BufferedReader</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;java.io.BufferedReader&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">InputStreamReader</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;java.io.InputStreamReader&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">StrictMode</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;android.os.StrictMode&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> <span class=\"title class_\">Build</span> = plus.<span class=\"property\">android</span>.importClass(<span class=\"string\">&quot;android.os.Build&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"title class_\">Build</span>.<span class=\"property\">VERSION</span>.<span class=\"property\">SDK_INT</span> &gt; <span class=\"number\">9</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> policy = <span class=\"keyword\">new</span> <span class=\"title class_\">StrictMode</span>.<span class=\"property\">ThreadPolicy</span>.<span class=\"title class_\">Builder</span>().<span class=\"title function_\">permitAll</span>().<span class=\"title function_\">build</span>();</span><br><span class=\"line\">\t\t\t<span class=\"title class_\">StrictMode</span>.<span class=\"title function_\">setThreadPolicy</span>(policy);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;连接服务器中...&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;ip...&quot;</span> + ipAddress, port)</span><br><span class=\"line\">        <span class=\"comment\">//port * 1  传递过的值默认为字符串 无效   转为数值</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> socket = <span class=\"keyword\">new</span> <span class=\"title class_\">Socket</span>(<span class=\"string\">`<span class=\"subst\">$&#123;ipAddress&#125;</span>`</span>, port * <span class=\"number\">1</span>); <span class=\"comment\">// &quot;172.16.19.***&quot;, 91**</span></span><br><span class=\"line\">\t\tsocket.<span class=\"title function_\">setSoTimeout</span>(<span class=\"number\">5000</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> inputStreamReader = <span class=\"keyword\">new</span> <span class=\"title class_\">InputStreamReader</span>(socket.<span class=\"title function_\">getInputStream</span>());</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> socketReader = <span class=\"keyword\">new</span> <span class=\"title class_\">BufferedReader</span>(inputStreamReader);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> outputStreamWriter = <span class=\"keyword\">new</span> <span class=\"title class_\">OutputStreamWriter</span>(socket.<span class=\"title function_\">getOutputStream</span>());</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> bufferWriter = <span class=\"keyword\">new</span> <span class=\"title class_\">BufferedWriter</span>(outputStreamWriter);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> socketWriter = <span class=\"keyword\">new</span> <span class=\"title class_\">PrintWriter</span>(bufferWriter, <span class=\"literal\">true</span>);</span><br><span class=\"line\">\t\tsocketWriter.<span class=\"title function_\">println</span>(<span class=\"title class_\">ZPLString</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;socketWriter...&quot;</span> + socketWriter)</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> msgBeReceived = socketReader.<span class=\"title function_\">readLine</span>();</span><br><span class=\"line\">\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(msgBeReceived);</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>打印不出中文解决办法</p>\n<p>指令：<code>^XA^WD*:*.**^XZ</code></p>\n<p>作用：打印出所有内存信息，可以用来寻找字体信息.TTF文件</p>\n</blockquote>\n"},{"title":"JS常用的util合集","cover":"https://s1.ax1x.com/2023/08/07/pPEmK1O.jpg","_content":"\n##### 数组去重\n```js\nuniqueArray(arr) {\n\tconst res = new Map()\n\t//zid :标识\n\treturn arr.filter((a) => !res.has(a.zid) && res.set(a.zid, 1));\n},\n```\n##### 判断两个数组是否一致\n```js\nexport const arraysEqual = (arr1, arr2) => {\n\t// 首先，比较两个数组的长度\n\tif (arr1.length !== arr2.length) {\n\t\treturn false;\n\t}\n\n\t// 如果两个数组长度相同，再比较每一个元素\n\tfor (let i = 0; i < arr1.length; i++) {\n\t\tif (arr1[i] !== arr2[i]) {\n\t\t\treturn false;\n\t\t}\n\t}\n\t// 如果两个数组长度相同，且每一个元素都相同，认为这两个数组内容一致\n\treturn true;\n}\n```\n##### 随机生成指定长度de字符串\n```js\n/**\n * prefix:想生成的固定的文字开头比如: 鹤舞阿花;\n * randomLength:除固定文字外的随机长度\n */\n// \n// \nfunction random(prefix, randomLength) {\n    // 兼容更低版本的默认值写法\n    prefix === undefined ? prefix = \"\" : prefix;\n    randomLength === undefined ? randomLength = 8 : randomLength;\n\n    // 设置随机用户名\n    // 用户名随机词典数组\n    let nameArr = [\n        [1, 2, 3, 4, 5, 6, 7, 8, 9, 0],\n        [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"g\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"]\n    ]\n    // 随机名字字符串\n    let name = prefix;\n    // 循环遍历从用户词典中随机抽出一个\n    for (var i = 0; i < randomLength; i++) {\n        // 随机生成index\n        let index = Math.floor(Math.random() * 2);\n        let zm = nameArr[index][Math.floor(Math.random() * nameArr[index].length)];\n        // 如果随机出的是英文字母\n        if (index === 1) {\n            // 则百分之50的概率变为大写\n            if (Math.floor(Math.random() * 2) === 1) {\n                zm = zm.toUpperCase();\n            }\n        }\n        // 拼接进名字变量中\n        name += zm;\n    }\n    // 将随机生成的名字返回\n    return name;\n}\nmodule.exports = random\n\n```\n","source":"_posts/9.md","raw":"---\ntitle: JS常用的util合集\ncategories: JS小方法\ncover:  https://s1.ax1x.com/2023/08/07/pPEmK1O.jpg\n---\n\n##### 数组去重\n```js\nuniqueArray(arr) {\n\tconst res = new Map()\n\t//zid :标识\n\treturn arr.filter((a) => !res.has(a.zid) && res.set(a.zid, 1));\n},\n```\n##### 判断两个数组是否一致\n```js\nexport const arraysEqual = (arr1, arr2) => {\n\t// 首先，比较两个数组的长度\n\tif (arr1.length !== arr2.length) {\n\t\treturn false;\n\t}\n\n\t// 如果两个数组长度相同，再比较每一个元素\n\tfor (let i = 0; i < arr1.length; i++) {\n\t\tif (arr1[i] !== arr2[i]) {\n\t\t\treturn false;\n\t\t}\n\t}\n\t// 如果两个数组长度相同，且每一个元素都相同，认为这两个数组内容一致\n\treturn true;\n}\n```\n##### 随机生成指定长度de字符串\n```js\n/**\n * prefix:想生成的固定的文字开头比如: 鹤舞阿花;\n * randomLength:除固定文字外的随机长度\n */\n// \n// \nfunction random(prefix, randomLength) {\n    // 兼容更低版本的默认值写法\n    prefix === undefined ? prefix = \"\" : prefix;\n    randomLength === undefined ? randomLength = 8 : randomLength;\n\n    // 设置随机用户名\n    // 用户名随机词典数组\n    let nameArr = [\n        [1, 2, 3, 4, 5, 6, 7, 8, 9, 0],\n        [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"g\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"]\n    ]\n    // 随机名字字符串\n    let name = prefix;\n    // 循环遍历从用户词典中随机抽出一个\n    for (var i = 0; i < randomLength; i++) {\n        // 随机生成index\n        let index = Math.floor(Math.random() * 2);\n        let zm = nameArr[index][Math.floor(Math.random() * nameArr[index].length)];\n        // 如果随机出的是英文字母\n        if (index === 1) {\n            // 则百分之50的概率变为大写\n            if (Math.floor(Math.random() * 2) === 1) {\n                zm = zm.toUpperCase();\n            }\n        }\n        // 拼接进名字变量中\n        name += zm;\n    }\n    // 将随机生成的名字返回\n    return name;\n}\nmodule.exports = random\n\n```\n","slug":"9","published":1,"date":"2023-08-07T02:04:35.920Z","updated":"2023-08-07T02:01:02.597Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cll0f74sj000i3gs4e40t3mpt","content":"<h5 id=\"数组去重\"><a href=\"#数组去重\" class=\"headerlink\" title=\"数组去重\"></a>数组去重</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">uniqueArray</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> res = <span class=\"keyword\">new</span> <span class=\"title class_\">Map</span>()</span><br><span class=\"line\">\t<span class=\"comment\">//zid :标识</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> arr.<span class=\"title function_\">filter</span>(<span class=\"function\">(<span class=\"params\">a</span>) =&gt;</span> !res.<span class=\"title function_\">has</span>(a.<span class=\"property\">zid</span>) &amp;&amp; res.<span class=\"title function_\">set</span>(a.<span class=\"property\">zid</span>, <span class=\"number\">1</span>));</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<h5 id=\"判断两个数组是否一致\"><a href=\"#判断两个数组是否一致\" class=\"headerlink\" title=\"判断两个数组是否一致\"></a>判断两个数组是否一致</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"title function_\">arraysEqual</span> = (<span class=\"params\">arr1, arr2</span>) =&gt; &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 首先，比较两个数组的长度</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (arr1.<span class=\"property\">length</span> !== arr2.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 如果两个数组长度相同，再比较每一个元素</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; arr1.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (arr1[i] !== arr2[i]) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// 如果两个数组长度相同，且每一个元素都相同，认为这两个数组内容一致</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"随机生成指定长度de字符串\"><a href=\"#随机生成指定长度de字符串\" class=\"headerlink\" title=\"随机生成指定长度de字符串\"></a>随机生成指定长度de字符串</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * prefix:想生成的固定的文字开头比如: 鹤舞阿花;</span></span><br><span class=\"line\"><span class=\"comment\"> * randomLength:除固定文字外的随机长度</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">random</span>(<span class=\"params\">prefix, randomLength</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 兼容更低版本的默认值写法</span></span><br><span class=\"line\">    prefix === <span class=\"literal\">undefined</span> ? prefix = <span class=\"string\">&quot;&quot;</span> : prefix;</span><br><span class=\"line\">    randomLength === <span class=\"literal\">undefined</span> ? randomLength = <span class=\"number\">8</span> : randomLength;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 设置随机用户名</span></span><br><span class=\"line\">    <span class=\"comment\">// 用户名随机词典数组</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> nameArr = [</span><br><span class=\"line\">        [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">        [<span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;e&quot;</span>, <span class=\"string\">&quot;f&quot;</span>, <span class=\"string\">&quot;g&quot;</span>, <span class=\"string\">&quot;h&quot;</span>, <span class=\"string\">&quot;i&quot;</span>, <span class=\"string\">&quot;g&quot;</span>, <span class=\"string\">&quot;k&quot;</span>, <span class=\"string\">&quot;l&quot;</span>, <span class=\"string\">&quot;m&quot;</span>, <span class=\"string\">&quot;n&quot;</span>, <span class=\"string\">&quot;o&quot;</span>, <span class=\"string\">&quot;p&quot;</span>, <span class=\"string\">&quot;q&quot;</span>, <span class=\"string\">&quot;r&quot;</span>, <span class=\"string\">&quot;s&quot;</span>, <span class=\"string\">&quot;t&quot;</span>, <span class=\"string\">&quot;u&quot;</span>, <span class=\"string\">&quot;v&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, <span class=\"string\">&quot;x&quot;</span>, <span class=\"string\">&quot;y&quot;</span>, <span class=\"string\">&quot;z&quot;</span>]</span><br><span class=\"line\">    ]</span><br><span class=\"line\">    <span class=\"comment\">// 随机名字字符串</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> name = prefix;</span><br><span class=\"line\">    <span class=\"comment\">// 循环遍历从用户词典中随机抽出一个</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; randomLength; i++) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 随机生成index</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> index = <span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">let</span> zm = nameArr[index][<span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * nameArr[index].<span class=\"property\">length</span>)];</span><br><span class=\"line\">        <span class=\"comment\">// 如果随机出的是英文字母</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 则百分之50的概率变为大写</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">2</span>) === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                zm = zm.<span class=\"title function_\">toUpperCase</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 拼接进名字变量中</span></span><br><span class=\"line\">        name += zm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 将随机生成的名字返回</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = random</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<h5 id=\"数组去重\"><a href=\"#数组去重\" class=\"headerlink\" title=\"数组去重\"></a>数组去重</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">uniqueArray</span>(<span class=\"params\">arr</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> res = <span class=\"keyword\">new</span> <span class=\"title class_\">Map</span>()</span><br><span class=\"line\">\t<span class=\"comment\">//zid :标识</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> arr.<span class=\"title function_\">filter</span>(<span class=\"function\">(<span class=\"params\">a</span>) =&gt;</span> !res.<span class=\"title function_\">has</span>(a.<span class=\"property\">zid</span>) &amp;&amp; res.<span class=\"title function_\">set</span>(a.<span class=\"property\">zid</span>, <span class=\"number\">1</span>));</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<h5 id=\"判断两个数组是否一致\"><a href=\"#判断两个数组是否一致\" class=\"headerlink\" title=\"判断两个数组是否一致\"></a>判断两个数组是否一致</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"title function_\">arraysEqual</span> = (<span class=\"params\">arr1, arr2</span>) =&gt; &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 首先，比较两个数组的长度</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (arr1.<span class=\"property\">length</span> !== arr2.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 如果两个数组长度相同，再比较每一个元素</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; arr1.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (arr1[i] !== arr2[i]) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// 如果两个数组长度相同，且每一个元素都相同，认为这两个数组内容一致</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"随机生成指定长度de字符串\"><a href=\"#随机生成指定长度de字符串\" class=\"headerlink\" title=\"随机生成指定长度de字符串\"></a>随机生成指定长度de字符串</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * prefix:想生成的固定的文字开头比如: 鹤舞阿花;</span></span><br><span class=\"line\"><span class=\"comment\"> * randomLength:除固定文字外的随机长度</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">random</span>(<span class=\"params\">prefix, randomLength</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 兼容更低版本的默认值写法</span></span><br><span class=\"line\">    prefix === <span class=\"literal\">undefined</span> ? prefix = <span class=\"string\">&quot;&quot;</span> : prefix;</span><br><span class=\"line\">    randomLength === <span class=\"literal\">undefined</span> ? randomLength = <span class=\"number\">8</span> : randomLength;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 设置随机用户名</span></span><br><span class=\"line\">    <span class=\"comment\">// 用户名随机词典数组</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> nameArr = [</span><br><span class=\"line\">        [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">0</span>],</span><br><span class=\"line\">        [<span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;e&quot;</span>, <span class=\"string\">&quot;f&quot;</span>, <span class=\"string\">&quot;g&quot;</span>, <span class=\"string\">&quot;h&quot;</span>, <span class=\"string\">&quot;i&quot;</span>, <span class=\"string\">&quot;g&quot;</span>, <span class=\"string\">&quot;k&quot;</span>, <span class=\"string\">&quot;l&quot;</span>, <span class=\"string\">&quot;m&quot;</span>, <span class=\"string\">&quot;n&quot;</span>, <span class=\"string\">&quot;o&quot;</span>, <span class=\"string\">&quot;p&quot;</span>, <span class=\"string\">&quot;q&quot;</span>, <span class=\"string\">&quot;r&quot;</span>, <span class=\"string\">&quot;s&quot;</span>, <span class=\"string\">&quot;t&quot;</span>, <span class=\"string\">&quot;u&quot;</span>, <span class=\"string\">&quot;v&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, <span class=\"string\">&quot;x&quot;</span>, <span class=\"string\">&quot;y&quot;</span>, <span class=\"string\">&quot;z&quot;</span>]</span><br><span class=\"line\">    ]</span><br><span class=\"line\">    <span class=\"comment\">// 随机名字字符串</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> name = prefix;</span><br><span class=\"line\">    <span class=\"comment\">// 循环遍历从用户词典中随机抽出一个</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; randomLength; i++) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 随机生成index</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> index = <span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">let</span> zm = nameArr[index][<span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * nameArr[index].<span class=\"property\">length</span>)];</span><br><span class=\"line\">        <span class=\"comment\">// 如果随机出的是英文字母</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 则百分之50的概率变为大写</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"title class_\">Math</span>.<span class=\"title function_\">floor</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">2</span>) === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                zm = zm.<span class=\"title function_\">toUpperCase</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 拼接进名字变量中</span></span><br><span class=\"line\">        name += zm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 将随机生成的名字返回</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = random</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n"},{"title":"vue2+electron开发桌面端应用并实现自动更新","cover":"https://s1.ax1x.com/2023/08/04/pPFRHFs.jpg","_content":"\n\n`需求：开发桌面端一体机应用：先把架构搭好就会事半功倍。`\n\n\n### 新建项目\n\n```shell\nvue create demo\n```\n\n### 安装electron\n\n```shell\nyarn add electron\n```\n\n### 添加打包工具\n\n```shell\nvue add electron-builder\n```\n![Alt text](image.png)\n[![pPErlJx.png](https://s1.ax1x.com/2023/08/07/pPErlJx.png)](https://imgse.com/i/pPErlJx)\n![Alt text](./image-1.png)\n[![pPEruw9.png](https://s1.ax1x.com/2023/08/07/pPEruw9.png)](https://imgse.com/i/pPEruw9)\n\n>安装后src下会生成background.js文件\n>\n>package.json也会生成对应的命令\n>\n>并把background.js作为入口文件\n>\n>```shell\n>\t\"electron:build\": \"vue-cli-service electron:build\",\n>\t\"electron:serve\": \"vue-cli-service electron:serve\",\n>```\n\n\n\n\n\n\n### 打包时遇到的error `ERR_ELECTRON_BUILDER_CANNOT_EXECUTE`\n\n\n>### 解决方法\n>`1、`下载 与当前elecron本版一致的 win32-x64 然后放到 参考路径 ： C:\\Users\\Admin/AppData\\Local\\electron\\Cache\n>`2 、`下载 对应的 winCodeSign 解压后 放到 C:\\User\\Admin/AppData\\Local\\electron-builder\\Cache 没有 winCodeSign 文件夹 自己新建\n>`3、` 下载对应的 nsis 和 对应的 nsis-resources 放到 C:\\User\\Admin/AppData\\Local\\electron-builder\\Cache/nsis 下面\n\n\n> 注：`复制错误提示里面的链接下载`\n> 比如下面的错 ：复制https://github.com/electron/electron/releases/download/v20.0.0/electron-v20.0.0-win32-x64.zip进行下载  然后执行`上面1的步骤`即可解决。\n\n`PS:这里要注意的是可能有版本相关的问题（我有两个项目，两个项目下载的版本不一样。一个13.6.9一个20）`\n![Alt text](./image-2.png)\n[![pPErQF1.png](https://s1.ax1x.com/2023/08/07/pPErQF1.png)](https://imgse.com/i/pPErQF1)\n\n\n### background.js\n\n```js\n'use strict'\n\nimport {\n\tapp,\n\tprotocol,\n\tBrowserWindow,\n\tMenu\n} from 'electron'\nimport {\n\tcreateProtocol\n} from 'vue-cli-plugin-electron-builder/lib'\n\n\nimport installExtension, {\n\tVUEJS_DEVTOOLS\n} from 'electron-devtools-installer'\n\nconst isDevelopment = process.env.NODE_ENV !== 'production'\n\n// Scheme must be registered before the app is ready\nprotocol.registerSchemesAsPrivileged([{\n\tscheme: 'app',\n\tprivileges: {\n\t\tsecure: true,\n\t\tstandard: true\n\t}\n}])\n\nasync function createWindow() {\n\t// Create the browser window.\n\tMenu.setApplicationMenu(null) //隐藏菜单栏\n\tconst win = new BrowserWindow({\n\t\t// width: 1900, //最大宽高 不设置则自适应\n\t\t// height: 1600,\n\t\t//fullscreen: true,//默认全屏\n\t\tshow: false,\n\t\twebPreferences: {\n\t\t\tnodeIntegration: process.env.ELECTRON_NODE_INTEGRATION,\n\t\t\tcontextIsolation: !process.env.ELECTRON_NODE_INTEGRATION\n\t\t}\n\t})\n\twin.maximize();//窗口最大化\n\twin.show();\n\t// win.webContents.openDevTools()\n\tif (process.env.WEBPACK_DEV_SERVER_URL) {\n\t\t// Load the url of the dev server if in development mode\n\t\tawait win.loadURL(process.env.WEBPACK_DEV_SERVER_URL)\n\t\tif (!process.env.IS_TEST) win.webContents.openDevTools()  //调试工具\n\t} else {\n\t\tcreateProtocol('app')\n\t\t// Load the index.html when not in development\n\t\twin.loadURL('app://./index.html')\n\t}\n}\n\n// Quit when all windows are closed.\napp.on('window-all-closed', () => {\n\t// On macOS it is common for applications and their menu bar\n\t// to stay active until the user quits explicitly with Cmd + Q\n\tif (process.platform !== 'darwin') {\n\t\tapp.quit()\n\t}\n})\n\n//点击关闭\napp.on('quit', () => {\n\tapp.quit()\n})\n\napp.on('activate', () => {\n\t// On macOS it's common to re-create a window in the app when the\n\t// dock icon is clicked and there are no other windows open.\n\tif (BrowserWindow.getAllWindows().length === 0) createWindow()\n})\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on('ready', async () => {\n\tif (isDevelopment && !process.env.IS_TEST) {\n\t\t// Install Vue Devtools\n\t\ttry {\n\t\t\tawait installExtension(VUEJS_DEVTOOLS)\n\t\t} catch (e) {\n\t\t\tconsole.error('Vue Devtools failed to install:', e.toString())\n\t\t}\n\t}\n\tcreateWindow()\n})\n\n// Exit cleanly on request from parent process in development mode.\nif (isDevelopment) {\n\tif (process.platform === 'win32') {\n\t\tprocess.on('message', (data) => {\n\t\t\tif (data === 'graceful-exit') {\n\t\t\t\tapp.quit()\n\t\t\t}\n\t\t})\n\t} else {\n\t\tprocess.on('SIGTERM', () => {\n\t\t\tapp.quit()\n\t\t})\n\t}\n}\n\n```\n\n>运行  electron:serve  命令就可以启动成功了。\n>\n>打包运行  electron:build命令\n\n更多配置参考  [electron官方文档](https://www.electronjs.org/docs/latest/api/app)\n\n\n\n###  自动更新 electron-updater\n\n>\n>\n>1、安装依赖  yarn add  electron-updater\n>\n>2、自定义更新的文件 handleUpdate.js\n>\n>注： 打包完会生成一个latest.yml文件，把这个文件和生成的.exe文件放在服务器上，会自动检测版本\n\n![Alt text](./image-3.png)\n[![pPEreL4.png](https://s1.ax1x.com/2023/08/07/pPEreL4.png)](https://imgse.com/i/pPEreL4)\n\n```js\nimport {\n\tautoUpdater\n} from 'electron-updater'\n\nimport {\n\tipcMain,dialog\n} from 'electron'\nlet mainWindow = null;\nexport function handleUpdate(window, feedUrl) {\n\tmainWindow = window;\n\tlet message = {\n\t\terror: '检查更新出错',\n\t\tchecking: '正在检查更新……',\n\t\tupdateAva: '检测到新版本，正在下载……',\n\t\tupdateNotAva: '现在使用的就是最新版本，不用更新',\n\t};\n\n`autoUpdater.autoDownload = false;` //取消自动下载\n\t//设置更新包的地址\n\tautoUpdater.setFeedURL(feedUrl);\n\t//监听升级失败事件\n\tautoUpdater.on('error', function(error) {\n\t\tsendUpdateMessage({\n\t\t\tcmd: 'error',\n\t\t\tmessage: error\n\t\t})\n\t});\n\t//监听开始检测更新事件\n\tautoUpdater.on('checking-for-update', function(message) {\n\t\tsendUpdateMessage({\n\t\t\tcmd: 'checking-for-update',\n\t\t\tmessage: message\n\t\t})\n\t});\n\t//监听发现可用更新事件\n\tautoUpdater.on('update-available', function(message) {\n\t\tsendUpdateMessage({\n\t\t\tcmd: 'update-available',\n\t\t\tmessage: message\n\t\t})\n\t\t//新加内容\n\t/**\t`const options = {\n\t\t\ttype: 'info',\n\t\t\tbuttons: ['确定', '取消'],\n\t\t\ttitle: '更新提示',\n\t\t\tmessage: '发现有新版本，是否更新？',\n\t\t\tcancelId: 1\n\t\t}\n\t\tdialog.showMessageBox(options).then(res => {\n\t\t\tif (res.response === 0) {\n\t\t\t\tsendUpdateMessage({\n\t\t\t\t\tcmd: 'confimUpdate',\n\t\t\t\t\tmessage: message\n\t\t\t\t})\n\t\t\t\tautoUpdater.downloadUpdate()\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t})`*/\n\n\n\n\n\t});\n\t//监听没有可用更新事件\n\tautoUpdater.on('update-not-available', function(message) {\n\t\tsendUpdateMessage({\n\t\t\tcmd: 'update-not-available',\n\t\t\tmessage: message\n\t\t})\n\t});\n\n\t// 更新下载进度事件\n\tautoUpdater.on('download-progress', function(progressObj) {\n\t\tsendUpdateMessage({\n\t\t\tcmd: 'download-progress',\n\t\t\tmessage: progressObj\n\t\t})\n\t});\n\t//监听下载完成事件\n\tautoUpdater.on('update-downloaded', function(event, releaseNotes, releaseName, releaseDate, updateUrl) {\n\t\tsendUpdateMessage({\n\t\t\tcmd: 'update-downloaded',\n\t\t\tmessage: {\n\t\t\t\treleaseNotes,\n\t\t\t\treleaseName,\n\t\t\t\treleaseDate,\n\t\t\t\tupdateUrl\n\t\t\t}\n\t\t})\n\t\t//退出并安装更新包\n\t\t//autoUpdater.quitAndInstall();\n\t});\n\t//新增\n\tipcMain.on(\"quit-install\", (e, arg) => {\n\t\tautoUpdater.quitAndInstall();\n\t})\n\t//接收渲染进程消息，开始检查更新\n\tipcMain.on(\"checkForUpdate\", (e, arg) => {\n\t\t//执行自动更新检查\n\t\t// sendUpdateMessage({cmd:'checkForUpdate',message:arg})\n\t\tautoUpdater.checkForUpdates();\n\t})\n}\n//给渲染进程发送消息\nfunction sendUpdateMessage(text) {\n\tmainWindow.webContents.send('message', text)\n}\n\n```\n\n>3、在主进程文件background.js里面引用 handleUpdate.js\n\n```js\n`const {\n\thandleUpdate\n} = require('./handleUpdate.js') //根据自己路径引入 我是跟background.js同级放的`\n\nif (process.env.WEBPACK_DEV_SERVER_URL) {\n\tawait win.loadURL(process.env.WEBPACK_DEV_SERVER_URL)\n\tif (!process.env.IS_TEST) win.webContents.openDevTools()  //调试工具\n} else {\n\tcreateProtocol('app')\n\twin.loadURL('app://./index.html')\n}\n\n`//检查更新\nhandleUpdate(win, \".exe文件存放路径\")`     \n```\n\n>在app.vue里面渲染更新进度样式\n\n```html\n<template>\n\t<div id=\"app\">\n\t\t<MainPage></MainPage>\n\t\t//2023/3/21  根据user要求改为静默式更新  只提示用户安装即可\n\t<!--\t<el-dialog title=\"正在更新新版本,请稍候...\" :visible.sync=\"dialogVisible\" width=\"50%\"\n\t\t\t:close-on-click-modal=\"closeOnClickModal\" :close-on-press-escape=\"closeOnPressEscape\"\n\t\t\t:show-close=\"showClose\" center>\n\t\t\t<div style=\"width:100%;height:50vh;line-height:50vh;text-align:center\">\n\t\t\t\t<el-progress :stroke-width=\"26\" :percentage=\"percentage\" :width=\"strokeWidth\" :show-text=\"true\"\n\t\t\t\t\ttype=\"circle\"></el-progress>\n\t\t\t</div>\n\t\t</el-dialog>-->\n\t</div>\n</template>\n<script>\n\tlet ipcRenderer = require(\"electron\").ipcRenderer;\n\timport MainPage from './views/MainPage.vue'\n\texport default {\n\t\tcomponents: {\n\t\t\tMainPage\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tdialogVisible: false,\n\t\t\t\tcloseOnClickModal: false,\n\t\t\t\tcloseOnPressEscape: false,\n\t\t\t\tshowClose: false,\n\t\t\t\tpercentage: 0,\n\t\t\t\tstrokeWidth: 400,\n\t\t\t\ttimer:0\n\t\t\t}\n\t\t},\n\t\tcreated() {\n\t\t\t\n\t\t},\n\t\tunmounted() {\n\t\t\tclearInterval(this.timer)\n\t\t},\n\t\tmounted() {\n\t\t\tlet _this = this;\n\t\t\t//新增 \n\t\t\tthis.timer = setInterval(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tipcRenderer.send(\"checkForUpdate\");\n\t\t\t\t}, 1)\n\t\t\t}, 60000 * 60 * 2)\n\n\t\t\t//接收主进程版本更新消息\n\t\t\tipcRenderer.on(\"message\", (event, arg) => {\n\t\t\t\t//新增内容\n\t\t\t\t/**`if (\"confimUpdate\" == arg.cmd) {\n\t\t\t\t\t\t_this.dialogVisible = true;\n\t\t\t\t\t} else if (\"download-progress\" == arg.cmd) {\n\t\t\t\t\t\tconsole.log(arg.message.percent);\n\t\t\t\t\t\tlet percent = Math.round(parseFloat(arg.message.percent));\n\t\t\t\t\t\t_this.percentage = percent;\n\t\t\t\t\t} else if (\"error\" == arg.cmd) {\n\t\t\t\t\t\t_this.dialogVisible = false;\n\t\t\t\t\t\t_this.$message(\"更新失败\");\n\t\t\t\t\t}`*/\n\t\t\t\t\t//2023/03/21改为如下\n\t\t\t\t\n\t\t\t\tif (\"update-downloaded\" == arg.cmd) {\n\t\t\t\t\t_this.$alert('新版本已经下载完成', '提示信息', {\n\t\t\t\t\t\tconfirmButtonText: '立即安装',\n\t\t\t\t\t\tcallback: (action) => {\n\t\t\t\t\t\t\tipcRenderer.send(\"quit-install\")\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t   \n\t\t\t\n\t\t\t});\n\t\t\n\t\t}\n\n\t}\n</script>\n\n```\n\n**效果图 （没有了，不是这个效果了）**\n![Alt text](./image-4.png)\n[![pPErneJ.png](https://s1.ax1x.com/2023/08/07/pPErneJ.png)](https://imgse.com/i/pPErneJ)\n**新的效果：**\n\n![Alt text](./image-5.png)\n[![pPErKoR.png](https://s1.ax1x.com/2023/08/07/pPErKoR.png)](https://imgse.com/i/pPErKoR)\n\n\n\n\n### 自定义安装路径\n\n>打包安装默认是直接装在c盘的 \n>\n>新建vue.config.js\n\n```js\nmodule.exports = {\n\tpluginOptions: {\n\t\telectronBuilder: {\n\t\t\tnodeIntegration: true,\n\t\t\tbuilderOptions: {\n\t\t\t\tnsis: {\n\t\t\t\t\tallowToChangeInstallationDirectory: true, //自定义安装路径\n\t\t\t\t\toneClick: false,\n\t\t\t\t},\n\t\t\t\twin: {\n\t\t\t\t\tpublish: [{\n\t\t\t\t\t\tprovider: \"generic\",\n\t\t\t\t\t\turl: \"存放exe文件路径\"  //更新包地址  \n\t\t\t\t\t}],\n\t\t\t\t},\n\t\t\t\tproductName: 'xxx'  //项目名\n\t\t\t}\n\t\t},\n\t}\n}\n\n```\n\n>\n>\n>ps:   百度时  网上好多资料都是说直接在package.json的build里面\n>\n>直接加上\n>\n>nsis: {\n>\t\tallowToChangeInstallationDirectory: true, //自定义安装路径\n>\t\toneClick: false,\n>},\n>\n>这并不适用于我的项目，所以新建了vue.config.js。\n\n![Alt text](./image-6.png)\n[![pPEr8SK.png](https://s1.ax1x.com/2023/08/07/pPEr8SK.png)](https://imgse.com/i/pPEr8SK)\n\n>我这里是更新   所以直接跳过了自定义安装路径的那一步，第一次安装可以自己选择路径。\n\n\n\n## 修改 项目打包安装图标\n\n1、安装依赖  生成图标\n\n```\nyarn add electron-icon-builder\n```\n\n2、在package.json的script中添加命令\n\n```shell\n\"electron:generate-icons\": \"electron-icon-builder --input=./public/icon.png --output=build --flatten\"\n```\n\n3、运行  yarn electron:generate-icons  后会生成一个build文件夹`（先要放一张icon.png）`\n\n![Alt text](./image-7.png)\n[![pPErJyD.png](https://s1.ax1x.com/2023/08/07/pPErJyD.png)](https://imgse.com/i/pPErJyD)\n\n4、删除dist_electron文件夹 重新运行打包命令即可\n\n```powershell\nyarn electron:build\n```\n\n5、图标已更改\n\n![Alt text](./image-8.png)\n[![pPEr1W6.png](https://s1.ax1x.com/2023/08/07/pPEr1W6.png)](https://imgse.com/i/pPEr1W6)\n\n`笔记是后面写了  没有对比图   本来默认的是electron的图标`\n\n### 最后放一下完整的background.js文件\n\n```js\n'use strict'\n\nimport {\n\tapp,\n\tprotocol,\n\tBrowserWindow,\n\tMenu\n} from 'electron'\nimport {\n\tcreateProtocol\n} from 'vue-cli-plugin-electron-builder/lib'\n\n\nimport installExtension, {\n\tVUEJS_DEVTOOLS\n} from 'electron-devtools-installer'\n\nconst {\n\thandleUpdate\n} = require('./handleUpdate.js') //根据自己路径引入\nconst isDevelopment = process.env.NODE_ENV !== 'production'\nconst path = require('path')\n// Scheme must be registered before the app is ready\nprotocol.registerSchemesAsPrivileged([{\n\tscheme: 'app',\n\tprivileges: {\n\t\tsecure: true,\n\t\tstandard: true\n\t}\n}])\n\nasync function createWindow() {\n\t// Create the browser window.\n\tMenu.setApplicationMenu(null) //隐藏菜单栏\n\tconst win = new BrowserWindow({\n\t\t// width: 1900, //最大宽高 不设置则自适应\n\t\t// height: 1600,\n\t\t//fullscreen: true,//默认全屏\n\t\tshow: false,\n\t\ticon: path.join(__static, \"../public/favicon.ico\"), //标题图标\n\t\twebPreferences: {\n\t\t\tnodeIntegration: process.env.ELECTRON_NODE_INTEGRATION,\n\t\t\tcontextIsolation: !process.env.ELECTRON_NODE_INTEGRATION\n\t\t}\n\t})\n\twin.maximize();//默认打开窗口最大化\n\twin.show();\n\t// win.webContents.openDevTools()\n\tif (process.env.WEBPACK_DEV_SERVER_URL) {\n\t\t// Load the url of the dev server if in development mode\n\t\tawait win.loadURL(process.env.WEBPACK_DEV_SERVER_URL)\n\t\tif (!process.env.IS_TEST) win.webContents.openDevTools()  //调试工具\n\t} else {\n\t\tcreateProtocol('app')\n\t\t// Load the index.html when not in development\n\t\twin.loadURL('app://./index.html')\n\t}\n\n\t//检查更新\n\thandleUpdate(win, \".exe文件存放路径  和vue.config.js文件里的一致\")\n\n}\n\n// Quit when all windows are closed.\napp.on('window-all-closed', () => {\n\t// On macOS it is common for applications and their menu bar\n\t// to stay active until the user quits explicitly with Cmd + Q\n\tif (process.platform !== 'darwin') {\n\t\tapp.quit()\n\t}\n})\n\napp.on('quit', () => {\n\tapp.quit()\n})\n\napp.on('activate', () => {\n\t\n\tif (BrowserWindow.getAllWindows().length === 0) createWindow()\n})\n\napp.on('ready', async () => {\n\tif (isDevelopment && !process.env.IS_TEST) {\n\t\t// Install Vue Devtools\n\t\ttry {\n\t\t\tawait installExtension(VUEJS_DEVTOOLS)\n\t\t} catch (e) {\n\t\t\tconsole.error('Vue Devtools failed to install:', e.toString())\n\t\t}\n\t}\n\tcreateWindow()\n})\n\n// Exit cleanly on request from parent process in development mode.\nif (isDevelopment) {\n\tif (process.platform === 'win32') {\n\t\tprocess.on('message', (data) => {\n\t\t\tif (data === 'graceful-exit') {\n\t\t\t\tapp.quit()\n\t\t\t}\n\t\t})\n\t} else {\n\t\tprocess.on('SIGTERM', () => {\n\t\t\tapp.quit()\n\t\t})\n\t}\n}\n\n```\n\n### 项目总体目录结构\n\n![Alt text](./image-9.png)\n[![pPErGQO.png](https://s1.ax1x.com/2023/08/07/pPErGQO.png)](https://imgse.com/i/pPErGQO)\n`安装依赖卡的解决办法：npm config set electron_mirror https://npm.taobao.org/mirrors/electron/`\n`后来搞了个入门案例   但是没有做更新  实现方式  electron+vite+vue3+pinia  跟上面有出入  不太影响  适合新人学习使用`\n[项目下载](https://download.csdn.net/download/weixin_44987713/86403644)\n","source":"_posts/11.md","raw":"---\ntitle: vue2+electron开发桌面端应用并实现自动更新\ncategories: vue\ncover: https://s1.ax1x.com/2023/08/04/pPFRHFs.jpg\n---\n\n\n`需求：开发桌面端一体机应用：先把架构搭好就会事半功倍。`\n\n\n### 新建项目\n\n```shell\nvue create demo\n```\n\n### 安装electron\n\n```shell\nyarn add electron\n```\n\n### 添加打包工具\n\n```shell\nvue add electron-builder\n```\n![Alt text](image.png)\n[![pPErlJx.png](https://s1.ax1x.com/2023/08/07/pPErlJx.png)](https://imgse.com/i/pPErlJx)\n![Alt text](./image-1.png)\n[![pPEruw9.png](https://s1.ax1x.com/2023/08/07/pPEruw9.png)](https://imgse.com/i/pPEruw9)\n\n>安装后src下会生成background.js文件\n>\n>package.json也会生成对应的命令\n>\n>并把background.js作为入口文件\n>\n>```shell\n>\t\"electron:build\": \"vue-cli-service electron:build\",\n>\t\"electron:serve\": \"vue-cli-service electron:serve\",\n>```\n\n\n\n\n\n\n### 打包时遇到的error `ERR_ELECTRON_BUILDER_CANNOT_EXECUTE`\n\n\n>### 解决方法\n>`1、`下载 与当前elecron本版一致的 win32-x64 然后放到 参考路径 ： C:\\Users\\Admin/AppData\\Local\\electron\\Cache\n>`2 、`下载 对应的 winCodeSign 解压后 放到 C:\\User\\Admin/AppData\\Local\\electron-builder\\Cache 没有 winCodeSign 文件夹 自己新建\n>`3、` 下载对应的 nsis 和 对应的 nsis-resources 放到 C:\\User\\Admin/AppData\\Local\\electron-builder\\Cache/nsis 下面\n\n\n> 注：`复制错误提示里面的链接下载`\n> 比如下面的错 ：复制https://github.com/electron/electron/releases/download/v20.0.0/electron-v20.0.0-win32-x64.zip进行下载  然后执行`上面1的步骤`即可解决。\n\n`PS:这里要注意的是可能有版本相关的问题（我有两个项目，两个项目下载的版本不一样。一个13.6.9一个20）`\n![Alt text](./image-2.png)\n[![pPErQF1.png](https://s1.ax1x.com/2023/08/07/pPErQF1.png)](https://imgse.com/i/pPErQF1)\n\n\n### background.js\n\n```js\n'use strict'\n\nimport {\n\tapp,\n\tprotocol,\n\tBrowserWindow,\n\tMenu\n} from 'electron'\nimport {\n\tcreateProtocol\n} from 'vue-cli-plugin-electron-builder/lib'\n\n\nimport installExtension, {\n\tVUEJS_DEVTOOLS\n} from 'electron-devtools-installer'\n\nconst isDevelopment = process.env.NODE_ENV !== 'production'\n\n// Scheme must be registered before the app is ready\nprotocol.registerSchemesAsPrivileged([{\n\tscheme: 'app',\n\tprivileges: {\n\t\tsecure: true,\n\t\tstandard: true\n\t}\n}])\n\nasync function createWindow() {\n\t// Create the browser window.\n\tMenu.setApplicationMenu(null) //隐藏菜单栏\n\tconst win = new BrowserWindow({\n\t\t// width: 1900, //最大宽高 不设置则自适应\n\t\t// height: 1600,\n\t\t//fullscreen: true,//默认全屏\n\t\tshow: false,\n\t\twebPreferences: {\n\t\t\tnodeIntegration: process.env.ELECTRON_NODE_INTEGRATION,\n\t\t\tcontextIsolation: !process.env.ELECTRON_NODE_INTEGRATION\n\t\t}\n\t})\n\twin.maximize();//窗口最大化\n\twin.show();\n\t// win.webContents.openDevTools()\n\tif (process.env.WEBPACK_DEV_SERVER_URL) {\n\t\t// Load the url of the dev server if in development mode\n\t\tawait win.loadURL(process.env.WEBPACK_DEV_SERVER_URL)\n\t\tif (!process.env.IS_TEST) win.webContents.openDevTools()  //调试工具\n\t} else {\n\t\tcreateProtocol('app')\n\t\t// Load the index.html when not in development\n\t\twin.loadURL('app://./index.html')\n\t}\n}\n\n// Quit when all windows are closed.\napp.on('window-all-closed', () => {\n\t// On macOS it is common for applications and their menu bar\n\t// to stay active until the user quits explicitly with Cmd + Q\n\tif (process.platform !== 'darwin') {\n\t\tapp.quit()\n\t}\n})\n\n//点击关闭\napp.on('quit', () => {\n\tapp.quit()\n})\n\napp.on('activate', () => {\n\t// On macOS it's common to re-create a window in the app when the\n\t// dock icon is clicked and there are no other windows open.\n\tif (BrowserWindow.getAllWindows().length === 0) createWindow()\n})\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on('ready', async () => {\n\tif (isDevelopment && !process.env.IS_TEST) {\n\t\t// Install Vue Devtools\n\t\ttry {\n\t\t\tawait installExtension(VUEJS_DEVTOOLS)\n\t\t} catch (e) {\n\t\t\tconsole.error('Vue Devtools failed to install:', e.toString())\n\t\t}\n\t}\n\tcreateWindow()\n})\n\n// Exit cleanly on request from parent process in development mode.\nif (isDevelopment) {\n\tif (process.platform === 'win32') {\n\t\tprocess.on('message', (data) => {\n\t\t\tif (data === 'graceful-exit') {\n\t\t\t\tapp.quit()\n\t\t\t}\n\t\t})\n\t} else {\n\t\tprocess.on('SIGTERM', () => {\n\t\t\tapp.quit()\n\t\t})\n\t}\n}\n\n```\n\n>运行  electron:serve  命令就可以启动成功了。\n>\n>打包运行  electron:build命令\n\n更多配置参考  [electron官方文档](https://www.electronjs.org/docs/latest/api/app)\n\n\n\n###  自动更新 electron-updater\n\n>\n>\n>1、安装依赖  yarn add  electron-updater\n>\n>2、自定义更新的文件 handleUpdate.js\n>\n>注： 打包完会生成一个latest.yml文件，把这个文件和生成的.exe文件放在服务器上，会自动检测版本\n\n![Alt text](./image-3.png)\n[![pPEreL4.png](https://s1.ax1x.com/2023/08/07/pPEreL4.png)](https://imgse.com/i/pPEreL4)\n\n```js\nimport {\n\tautoUpdater\n} from 'electron-updater'\n\nimport {\n\tipcMain,dialog\n} from 'electron'\nlet mainWindow = null;\nexport function handleUpdate(window, feedUrl) {\n\tmainWindow = window;\n\tlet message = {\n\t\terror: '检查更新出错',\n\t\tchecking: '正在检查更新……',\n\t\tupdateAva: '检测到新版本，正在下载……',\n\t\tupdateNotAva: '现在使用的就是最新版本，不用更新',\n\t};\n\n`autoUpdater.autoDownload = false;` //取消自动下载\n\t//设置更新包的地址\n\tautoUpdater.setFeedURL(feedUrl);\n\t//监听升级失败事件\n\tautoUpdater.on('error', function(error) {\n\t\tsendUpdateMessage({\n\t\t\tcmd: 'error',\n\t\t\tmessage: error\n\t\t})\n\t});\n\t//监听开始检测更新事件\n\tautoUpdater.on('checking-for-update', function(message) {\n\t\tsendUpdateMessage({\n\t\t\tcmd: 'checking-for-update',\n\t\t\tmessage: message\n\t\t})\n\t});\n\t//监听发现可用更新事件\n\tautoUpdater.on('update-available', function(message) {\n\t\tsendUpdateMessage({\n\t\t\tcmd: 'update-available',\n\t\t\tmessage: message\n\t\t})\n\t\t//新加内容\n\t/**\t`const options = {\n\t\t\ttype: 'info',\n\t\t\tbuttons: ['确定', '取消'],\n\t\t\ttitle: '更新提示',\n\t\t\tmessage: '发现有新版本，是否更新？',\n\t\t\tcancelId: 1\n\t\t}\n\t\tdialog.showMessageBox(options).then(res => {\n\t\t\tif (res.response === 0) {\n\t\t\t\tsendUpdateMessage({\n\t\t\t\t\tcmd: 'confimUpdate',\n\t\t\t\t\tmessage: message\n\t\t\t\t})\n\t\t\t\tautoUpdater.downloadUpdate()\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t})`*/\n\n\n\n\n\t});\n\t//监听没有可用更新事件\n\tautoUpdater.on('update-not-available', function(message) {\n\t\tsendUpdateMessage({\n\t\t\tcmd: 'update-not-available',\n\t\t\tmessage: message\n\t\t})\n\t});\n\n\t// 更新下载进度事件\n\tautoUpdater.on('download-progress', function(progressObj) {\n\t\tsendUpdateMessage({\n\t\t\tcmd: 'download-progress',\n\t\t\tmessage: progressObj\n\t\t})\n\t});\n\t//监听下载完成事件\n\tautoUpdater.on('update-downloaded', function(event, releaseNotes, releaseName, releaseDate, updateUrl) {\n\t\tsendUpdateMessage({\n\t\t\tcmd: 'update-downloaded',\n\t\t\tmessage: {\n\t\t\t\treleaseNotes,\n\t\t\t\treleaseName,\n\t\t\t\treleaseDate,\n\t\t\t\tupdateUrl\n\t\t\t}\n\t\t})\n\t\t//退出并安装更新包\n\t\t//autoUpdater.quitAndInstall();\n\t});\n\t//新增\n\tipcMain.on(\"quit-install\", (e, arg) => {\n\t\tautoUpdater.quitAndInstall();\n\t})\n\t//接收渲染进程消息，开始检查更新\n\tipcMain.on(\"checkForUpdate\", (e, arg) => {\n\t\t//执行自动更新检查\n\t\t// sendUpdateMessage({cmd:'checkForUpdate',message:arg})\n\t\tautoUpdater.checkForUpdates();\n\t})\n}\n//给渲染进程发送消息\nfunction sendUpdateMessage(text) {\n\tmainWindow.webContents.send('message', text)\n}\n\n```\n\n>3、在主进程文件background.js里面引用 handleUpdate.js\n\n```js\n`const {\n\thandleUpdate\n} = require('./handleUpdate.js') //根据自己路径引入 我是跟background.js同级放的`\n\nif (process.env.WEBPACK_DEV_SERVER_URL) {\n\tawait win.loadURL(process.env.WEBPACK_DEV_SERVER_URL)\n\tif (!process.env.IS_TEST) win.webContents.openDevTools()  //调试工具\n} else {\n\tcreateProtocol('app')\n\twin.loadURL('app://./index.html')\n}\n\n`//检查更新\nhandleUpdate(win, \".exe文件存放路径\")`     \n```\n\n>在app.vue里面渲染更新进度样式\n\n```html\n<template>\n\t<div id=\"app\">\n\t\t<MainPage></MainPage>\n\t\t//2023/3/21  根据user要求改为静默式更新  只提示用户安装即可\n\t<!--\t<el-dialog title=\"正在更新新版本,请稍候...\" :visible.sync=\"dialogVisible\" width=\"50%\"\n\t\t\t:close-on-click-modal=\"closeOnClickModal\" :close-on-press-escape=\"closeOnPressEscape\"\n\t\t\t:show-close=\"showClose\" center>\n\t\t\t<div style=\"width:100%;height:50vh;line-height:50vh;text-align:center\">\n\t\t\t\t<el-progress :stroke-width=\"26\" :percentage=\"percentage\" :width=\"strokeWidth\" :show-text=\"true\"\n\t\t\t\t\ttype=\"circle\"></el-progress>\n\t\t\t</div>\n\t\t</el-dialog>-->\n\t</div>\n</template>\n<script>\n\tlet ipcRenderer = require(\"electron\").ipcRenderer;\n\timport MainPage from './views/MainPage.vue'\n\texport default {\n\t\tcomponents: {\n\t\t\tMainPage\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tdialogVisible: false,\n\t\t\t\tcloseOnClickModal: false,\n\t\t\t\tcloseOnPressEscape: false,\n\t\t\t\tshowClose: false,\n\t\t\t\tpercentage: 0,\n\t\t\t\tstrokeWidth: 400,\n\t\t\t\ttimer:0\n\t\t\t}\n\t\t},\n\t\tcreated() {\n\t\t\t\n\t\t},\n\t\tunmounted() {\n\t\t\tclearInterval(this.timer)\n\t\t},\n\t\tmounted() {\n\t\t\tlet _this = this;\n\t\t\t//新增 \n\t\t\tthis.timer = setInterval(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tipcRenderer.send(\"checkForUpdate\");\n\t\t\t\t}, 1)\n\t\t\t}, 60000 * 60 * 2)\n\n\t\t\t//接收主进程版本更新消息\n\t\t\tipcRenderer.on(\"message\", (event, arg) => {\n\t\t\t\t//新增内容\n\t\t\t\t/**`if (\"confimUpdate\" == arg.cmd) {\n\t\t\t\t\t\t_this.dialogVisible = true;\n\t\t\t\t\t} else if (\"download-progress\" == arg.cmd) {\n\t\t\t\t\t\tconsole.log(arg.message.percent);\n\t\t\t\t\t\tlet percent = Math.round(parseFloat(arg.message.percent));\n\t\t\t\t\t\t_this.percentage = percent;\n\t\t\t\t\t} else if (\"error\" == arg.cmd) {\n\t\t\t\t\t\t_this.dialogVisible = false;\n\t\t\t\t\t\t_this.$message(\"更新失败\");\n\t\t\t\t\t}`*/\n\t\t\t\t\t//2023/03/21改为如下\n\t\t\t\t\n\t\t\t\tif (\"update-downloaded\" == arg.cmd) {\n\t\t\t\t\t_this.$alert('新版本已经下载完成', '提示信息', {\n\t\t\t\t\t\tconfirmButtonText: '立即安装',\n\t\t\t\t\t\tcallback: (action) => {\n\t\t\t\t\t\t\tipcRenderer.send(\"quit-install\")\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t   \n\t\t\t\n\t\t\t});\n\t\t\n\t\t}\n\n\t}\n</script>\n\n```\n\n**效果图 （没有了，不是这个效果了）**\n![Alt text](./image-4.png)\n[![pPErneJ.png](https://s1.ax1x.com/2023/08/07/pPErneJ.png)](https://imgse.com/i/pPErneJ)\n**新的效果：**\n\n![Alt text](./image-5.png)\n[![pPErKoR.png](https://s1.ax1x.com/2023/08/07/pPErKoR.png)](https://imgse.com/i/pPErKoR)\n\n\n\n\n### 自定义安装路径\n\n>打包安装默认是直接装在c盘的 \n>\n>新建vue.config.js\n\n```js\nmodule.exports = {\n\tpluginOptions: {\n\t\telectronBuilder: {\n\t\t\tnodeIntegration: true,\n\t\t\tbuilderOptions: {\n\t\t\t\tnsis: {\n\t\t\t\t\tallowToChangeInstallationDirectory: true, //自定义安装路径\n\t\t\t\t\toneClick: false,\n\t\t\t\t},\n\t\t\t\twin: {\n\t\t\t\t\tpublish: [{\n\t\t\t\t\t\tprovider: \"generic\",\n\t\t\t\t\t\turl: \"存放exe文件路径\"  //更新包地址  \n\t\t\t\t\t}],\n\t\t\t\t},\n\t\t\t\tproductName: 'xxx'  //项目名\n\t\t\t}\n\t\t},\n\t}\n}\n\n```\n\n>\n>\n>ps:   百度时  网上好多资料都是说直接在package.json的build里面\n>\n>直接加上\n>\n>nsis: {\n>\t\tallowToChangeInstallationDirectory: true, //自定义安装路径\n>\t\toneClick: false,\n>},\n>\n>这并不适用于我的项目，所以新建了vue.config.js。\n\n![Alt text](./image-6.png)\n[![pPEr8SK.png](https://s1.ax1x.com/2023/08/07/pPEr8SK.png)](https://imgse.com/i/pPEr8SK)\n\n>我这里是更新   所以直接跳过了自定义安装路径的那一步，第一次安装可以自己选择路径。\n\n\n\n## 修改 项目打包安装图标\n\n1、安装依赖  生成图标\n\n```\nyarn add electron-icon-builder\n```\n\n2、在package.json的script中添加命令\n\n```shell\n\"electron:generate-icons\": \"electron-icon-builder --input=./public/icon.png --output=build --flatten\"\n```\n\n3、运行  yarn electron:generate-icons  后会生成一个build文件夹`（先要放一张icon.png）`\n\n![Alt text](./image-7.png)\n[![pPErJyD.png](https://s1.ax1x.com/2023/08/07/pPErJyD.png)](https://imgse.com/i/pPErJyD)\n\n4、删除dist_electron文件夹 重新运行打包命令即可\n\n```powershell\nyarn electron:build\n```\n\n5、图标已更改\n\n![Alt text](./image-8.png)\n[![pPEr1W6.png](https://s1.ax1x.com/2023/08/07/pPEr1W6.png)](https://imgse.com/i/pPEr1W6)\n\n`笔记是后面写了  没有对比图   本来默认的是electron的图标`\n\n### 最后放一下完整的background.js文件\n\n```js\n'use strict'\n\nimport {\n\tapp,\n\tprotocol,\n\tBrowserWindow,\n\tMenu\n} from 'electron'\nimport {\n\tcreateProtocol\n} from 'vue-cli-plugin-electron-builder/lib'\n\n\nimport installExtension, {\n\tVUEJS_DEVTOOLS\n} from 'electron-devtools-installer'\n\nconst {\n\thandleUpdate\n} = require('./handleUpdate.js') //根据自己路径引入\nconst isDevelopment = process.env.NODE_ENV !== 'production'\nconst path = require('path')\n// Scheme must be registered before the app is ready\nprotocol.registerSchemesAsPrivileged([{\n\tscheme: 'app',\n\tprivileges: {\n\t\tsecure: true,\n\t\tstandard: true\n\t}\n}])\n\nasync function createWindow() {\n\t// Create the browser window.\n\tMenu.setApplicationMenu(null) //隐藏菜单栏\n\tconst win = new BrowserWindow({\n\t\t// width: 1900, //最大宽高 不设置则自适应\n\t\t// height: 1600,\n\t\t//fullscreen: true,//默认全屏\n\t\tshow: false,\n\t\ticon: path.join(__static, \"../public/favicon.ico\"), //标题图标\n\t\twebPreferences: {\n\t\t\tnodeIntegration: process.env.ELECTRON_NODE_INTEGRATION,\n\t\t\tcontextIsolation: !process.env.ELECTRON_NODE_INTEGRATION\n\t\t}\n\t})\n\twin.maximize();//默认打开窗口最大化\n\twin.show();\n\t// win.webContents.openDevTools()\n\tif (process.env.WEBPACK_DEV_SERVER_URL) {\n\t\t// Load the url of the dev server if in development mode\n\t\tawait win.loadURL(process.env.WEBPACK_DEV_SERVER_URL)\n\t\tif (!process.env.IS_TEST) win.webContents.openDevTools()  //调试工具\n\t} else {\n\t\tcreateProtocol('app')\n\t\t// Load the index.html when not in development\n\t\twin.loadURL('app://./index.html')\n\t}\n\n\t//检查更新\n\thandleUpdate(win, \".exe文件存放路径  和vue.config.js文件里的一致\")\n\n}\n\n// Quit when all windows are closed.\napp.on('window-all-closed', () => {\n\t// On macOS it is common for applications and their menu bar\n\t// to stay active until the user quits explicitly with Cmd + Q\n\tif (process.platform !== 'darwin') {\n\t\tapp.quit()\n\t}\n})\n\napp.on('quit', () => {\n\tapp.quit()\n})\n\napp.on('activate', () => {\n\t\n\tif (BrowserWindow.getAllWindows().length === 0) createWindow()\n})\n\napp.on('ready', async () => {\n\tif (isDevelopment && !process.env.IS_TEST) {\n\t\t// Install Vue Devtools\n\t\ttry {\n\t\t\tawait installExtension(VUEJS_DEVTOOLS)\n\t\t} catch (e) {\n\t\t\tconsole.error('Vue Devtools failed to install:', e.toString())\n\t\t}\n\t}\n\tcreateWindow()\n})\n\n// Exit cleanly on request from parent process in development mode.\nif (isDevelopment) {\n\tif (process.platform === 'win32') {\n\t\tprocess.on('message', (data) => {\n\t\t\tif (data === 'graceful-exit') {\n\t\t\t\tapp.quit()\n\t\t\t}\n\t\t})\n\t} else {\n\t\tprocess.on('SIGTERM', () => {\n\t\t\tapp.quit()\n\t\t})\n\t}\n}\n\n```\n\n### 项目总体目录结构\n\n![Alt text](./image-9.png)\n[![pPErGQO.png](https://s1.ax1x.com/2023/08/07/pPErGQO.png)](https://imgse.com/i/pPErGQO)\n`安装依赖卡的解决办法：npm config set electron_mirror https://npm.taobao.org/mirrors/electron/`\n`后来搞了个入门案例   但是没有做更新  实现方式  electron+vite+vue3+pinia  跟上面有出入  不太影响  适合新人学习使用`\n[项目下载](https://download.csdn.net/download/weixin_44987713/86403644)\n","slug":"11","published":1,"date":"2023-08-07T07:04:56.573Z","updated":"2023-08-07T07:17:42.657Z","_id":"cll0jgsj10000kgs4bcie790o","comments":1,"layout":"post","photos":[],"link":"","content":"<p><code>需求：开发桌面端一体机应用：先把架构搭好就会事半功倍。</code></p>\n<h3 id=\"新建项目\"><a href=\"#新建项目\" class=\"headerlink\" title=\"新建项目\"></a>新建项目</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue create demo</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装electron\"><a href=\"#安装electron\" class=\"headerlink\" title=\"安装electron\"></a>安装electron</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add electron</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加打包工具\"><a href=\"#添加打包工具\" class=\"headerlink\" title=\"添加打包工具\"></a>添加打包工具</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue add electron-builder</span><br></pre></td></tr></table></figure>\n<p><img src=\"/image.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPErlJx\"><img src=\"https://s1.ax1x.com/2023/08/07/pPErlJx.png\" alt=\"pPErlJx.png\"></a><br><img src=\"/./image-1.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPEruw9\"><img src=\"https://s1.ax1x.com/2023/08/07/pPEruw9.png\" alt=\"pPEruw9.png\"></a></p>\n<blockquote>\n<p>安装后src下会生成background.js文件</p>\n<p>package.json也会生成对应的命令</p>\n<p>并把background.js作为入口文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;electron:build&quot;: &quot;vue-cli-service electron:build&quot;,</span><br><span class=\"line\">&quot;electron:serve&quot;: &quot;vue-cli-service electron:serve&quot;,</span><br></pre></td></tr></table></figure>\n</blockquote>\n<h3 id=\"打包时遇到的error-ERR-ELECTRON-BUILDER-CANNOT-EXECUTE\"><a href=\"#打包时遇到的error-ERR-ELECTRON-BUILDER-CANNOT-EXECUTE\" class=\"headerlink\" title=\"打包时遇到的error ERR_ELECTRON_BUILDER_CANNOT_EXECUTE\"></a>打包时遇到的error <code>ERR_ELECTRON_BUILDER_CANNOT_EXECUTE</code></h3><blockquote>\n<h3 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h3><p><code>1、</code>下载 与当前elecron本版一致的 win32-x64 然后放到 参考路径 ： C:\\Users\\Admin&#x2F;AppData\\Local\\electron\\Cache<br><code>2 、</code>下载 对应的 winCodeSign 解压后 放到 C:\\User\\Admin&#x2F;AppData\\Local\\electron-builder\\Cache 没有 winCodeSign 文件夹 自己新建<br><code>3、</code> 下载对应的 nsis 和 对应的 nsis-resources 放到 C:\\User\\Admin&#x2F;AppData\\Local\\electron-builder\\Cache&#x2F;nsis 下面</p>\n</blockquote>\n<blockquote>\n<p>注：<code>复制错误提示里面的链接下载</code><br>比如下面的错 ：复制<a href=\"https://github.com/electron/electron/releases/download/v20.0.0/electron-v20.0.0-win32-x64.zip%E8%BF%9B%E8%A1%8C%E4%B8%8B%E8%BD%BD\">https://github.com/electron/electron/releases/download/v20.0.0/electron-v20.0.0-win32-x64.zip进行下载</a>  然后执行<code>上面1的步骤</code>即可解决。</p>\n</blockquote>\n<p><code>PS:这里要注意的是可能有版本相关的问题（我有两个项目，两个项目下载的版本不一样。一个13.6.9一个20）</code><br><img src=\"/./image-2.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPErQF1\"><img src=\"https://s1.ax1x.com/2023/08/07/pPErQF1.png\" alt=\"pPErQF1.png\"></a></p>\n<h3 id=\"background-js\"><a href=\"#background-js\" class=\"headerlink\" title=\"background.js\"></a>background.js</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">\tapp,</span><br><span class=\"line\">\tprotocol,</span><br><span class=\"line\">\t<span class=\"title class_\">BrowserWindow</span>,</span><br><span class=\"line\">\t<span class=\"title class_\">Menu</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">\tcreateProtocol</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-cli-plugin-electron-builder/lib&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> installExtension, &#123;</span><br><span class=\"line\">\t<span class=\"variable constant_\">VUEJS_DEVTOOLS</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron-devtools-installer&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> isDevelopment = process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> !== <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Scheme must be registered before the app is ready</span></span><br><span class=\"line\">protocol.<span class=\"title function_\">registerSchemesAsPrivileged</span>([&#123;</span><br><span class=\"line\">\t<span class=\"attr\">scheme</span>: <span class=\"string\">&#x27;app&#x27;</span>,</span><br><span class=\"line\">\t<span class=\"attr\">privileges</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">secure</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">standard</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">createWindow</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// Create the browser window.</span></span><br><span class=\"line\">\t<span class=\"title class_\">Menu</span>.<span class=\"title function_\">setApplicationMenu</span>(<span class=\"literal\">null</span>) <span class=\"comment\">//隐藏菜单栏</span></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> win = <span class=\"keyword\">new</span> <span class=\"title class_\">BrowserWindow</span>(&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// width: 1900, //最大宽高 不设置则自适应</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// height: 1600,</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//fullscreen: true,//默认全屏</span></span><br><span class=\"line\">\t\t<span class=\"attr\">show</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">webPreferences</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">nodeIntegration</span>: process.<span class=\"property\">env</span>.<span class=\"property\">ELECTRON_NODE_INTEGRATION</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">contextIsolation</span>: !process.<span class=\"property\">env</span>.<span class=\"property\">ELECTRON_NODE_INTEGRATION</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\twin.<span class=\"title function_\">maximize</span>();<span class=\"comment\">//窗口最大化</span></span><br><span class=\"line\">\twin.<span class=\"title function_\">show</span>();</span><br><span class=\"line\">\t<span class=\"comment\">// win.webContents.openDevTools()</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Load the url of the dev server if in development mode</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">await</span> win.<span class=\"title function_\">loadURL</span>(process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) win.<span class=\"property\">webContents</span>.<span class=\"title function_\">openDevTools</span>()  <span class=\"comment\">//调试工具</span></span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">createProtocol</span>(<span class=\"string\">&#x27;app&#x27;</span>)</span><br><span class=\"line\">\t\t<span class=\"comment\">// Load the index.html when not in development</span></span><br><span class=\"line\">\t\twin.<span class=\"title function_\">loadURL</span>(<span class=\"string\">&#x27;app://./index.html&#x27;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Quit when all windows are closed.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;window-all-closed&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// On macOS it is common for applications and their menu bar</span></span><br><span class=\"line\">\t<span class=\"comment\">// to stay active until the user quits explicitly with Cmd + Q</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> !== <span class=\"string\">&#x27;darwin&#x27;</span>) &#123;</span><br><span class=\"line\">\t\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//点击关闭</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;quit&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;activate&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// On macOS it&#x27;s common to re-create a window in the app when the</span></span><br><span class=\"line\">\t<span class=\"comment\">// dock icon is clicked and there are no other windows open.</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (<span class=\"title class_\">BrowserWindow</span>.<span class=\"title function_\">getAllWindows</span>().<span class=\"property\">length</span> === <span class=\"number\">0</span>) <span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This method will be called when Electron has finished</span></span><br><span class=\"line\"><span class=\"comment\">// initialization and is ready to create browser windows.</span></span><br><span class=\"line\"><span class=\"comment\">// Some APIs can only be used after this event occurs.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;ready&#x27;</span>, <span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (isDevelopment &amp;&amp; !process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Install Vue Devtools</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">await</span> <span class=\"title function_\">installExtension</span>(<span class=\"variable constant_\">VUEJS_DEVTOOLS</span>)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;Vue Devtools failed to install:&#x27;</span>, e.<span class=\"title function_\">toString</span>())</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Exit cleanly on request from parent process in development mode.</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (isDevelopment) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> === <span class=\"string\">&#x27;win32&#x27;</span>) &#123;</span><br><span class=\"line\">\t\tprocess.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (data === <span class=\"string\">&#x27;graceful-exit&#x27;</span>) &#123;</span><br><span class=\"line\">\t\t\t\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tprocess.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;SIGTERM&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>运行  electron:serve  命令就可以启动成功了。</p>\n<p>打包运行  electron:build命令</p>\n</blockquote>\n<p>更多配置参考  <a href=\"https://www.electronjs.org/docs/latest/api/app\">electron官方文档</a></p>\n<h3 id=\"自动更新-electron-updater\"><a href=\"#自动更新-electron-updater\" class=\"headerlink\" title=\"自动更新 electron-updater\"></a>自动更新 electron-updater</h3><blockquote>\n<p>1、安装依赖  yarn add  electron-updater</p>\n<p>2、自定义更新的文件 handleUpdate.js</p>\n<p>注： 打包完会生成一个latest.yml文件，把这个文件和生成的.exe文件放在服务器上，会自动检测版本</p>\n</blockquote>\n<p><img src=\"/./image-3.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPEreL4\"><img src=\"https://s1.ax1x.com/2023/08/07/pPEreL4.png\" alt=\"pPEreL4.png\"></a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">\tautoUpdater</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron-updater&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">\tipcMain,dialog</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> mainWindow = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">handleUpdate</span>(<span class=\"params\"><span class=\"variable language_\">window</span>, feedUrl</span>) &#123;</span><br><span class=\"line\">\tmainWindow = <span class=\"variable language_\">window</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">let</span> message = &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">error</span>: <span class=\"string\">&#x27;检查更新出错&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">checking</span>: <span class=\"string\">&#x27;正在检查更新……&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">updateAva</span>: <span class=\"string\">&#x27;检测到新版本，正在下载……&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">updateNotAva</span>: <span class=\"string\">&#x27;现在使用的就是最新版本，不用更新&#x27;</span>,</span><br><span class=\"line\">\t&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">`autoUpdater.autoDownload = false;`</span> <span class=\"comment\">//取消自动下载</span></span><br><span class=\"line\">\t<span class=\"comment\">//设置更新包的地址</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">setFeedURL</span>(feedUrl);</span><br><span class=\"line\">\t<span class=\"comment\">//监听升级失败事件</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;error&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">error</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">sendUpdateMessage</span>(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">cmd</span>: <span class=\"string\">&#x27;error&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">message</span>: error</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">\t<span class=\"comment\">//监听开始检测更新事件</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;checking-for-update&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">message</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">sendUpdateMessage</span>(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">cmd</span>: <span class=\"string\">&#x27;checking-for-update&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">message</span>: message</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">\t<span class=\"comment\">//监听发现可用更新事件</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-available&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">message</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">sendUpdateMessage</span>(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">cmd</span>: <span class=\"string\">&#x27;update-available&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">message</span>: message</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t<span class=\"comment\">//新加内容</span></span><br><span class=\"line\">\t<span class=\"comment\">/**\t`const options = &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\ttype: &#x27;info&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tbuttons: [&#x27;确定&#x27;, &#x27;取消&#x27;],</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\ttitle: &#x27;更新提示&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tmessage: &#x27;发现有新版本，是否更新？&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tcancelId: 1</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\t\tdialog.showMessageBox(options).then(res =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tif (res.response === 0) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\tsendUpdateMessage(&#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t\tcmd: &#x27;confimUpdate&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t\tmessage: message</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\tautoUpdater.downloadUpdate()</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\treturn;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&#125;)`*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">\t<span class=\"comment\">//监听没有可用更新事件</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-not-available&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">message</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">sendUpdateMessage</span>(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">cmd</span>: <span class=\"string\">&#x27;update-not-available&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">message</span>: message</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 更新下载进度事件</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;download-progress&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">progressObj</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">sendUpdateMessage</span>(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">cmd</span>: <span class=\"string\">&#x27;download-progress&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">message</span>: progressObj</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">\t<span class=\"comment\">//监听下载完成事件</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-downloaded&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">event, releaseNotes, releaseName, releaseDate, updateUrl</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">sendUpdateMessage</span>(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">cmd</span>: <span class=\"string\">&#x27;update-downloaded&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">message</span>: &#123;</span><br><span class=\"line\">\t\t\t\treleaseNotes,</span><br><span class=\"line\">\t\t\t\treleaseName,</span><br><span class=\"line\">\t\t\t\treleaseDate,</span><br><span class=\"line\">\t\t\t\tupdateUrl</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t<span class=\"comment\">//退出并安装更新包</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//autoUpdater.quitAndInstall();</span></span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">\t<span class=\"comment\">//新增</span></span><br><span class=\"line\">\tipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;quit-install&quot;</span>, <span class=\"function\">(<span class=\"params\">e, arg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\tautoUpdater.<span class=\"title function_\">quitAndInstall</span>();</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\t<span class=\"comment\">//接收渲染进程消息，开始检查更新</span></span><br><span class=\"line\">\tipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;checkForUpdate&quot;</span>, <span class=\"function\">(<span class=\"params\">e, arg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//执行自动更新检查</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// sendUpdateMessage(&#123;cmd:&#x27;checkForUpdate&#x27;,message:arg&#125;)</span></span><br><span class=\"line\">\t\tautoUpdater.<span class=\"title function_\">checkForUpdates</span>();</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//给渲染进程发送消息</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">sendUpdateMessage</span>(<span class=\"params\">text</span>) &#123;</span><br><span class=\"line\">\tmainWindow.<span class=\"property\">webContents</span>.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;message&#x27;</span>, text)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>3、在主进程文件background.js里面引用 handleUpdate.js</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">`const &#123;</span></span><br><span class=\"line\"><span class=\"string\">\thandleUpdate</span></span><br><span class=\"line\"><span class=\"string\">&#125; = require(&#x27;./handleUpdate.js&#x27;) //根据自己路径引入 我是跟background.js同级放的`</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">await</span> win.<span class=\"title function_\">loadURL</span>(process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) win.<span class=\"property\">webContents</span>.<span class=\"title function_\">openDevTools</span>()  <span class=\"comment\">//调试工具</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t<span class=\"title function_\">createProtocol</span>(<span class=\"string\">&#x27;app&#x27;</span>)</span><br><span class=\"line\">\twin.<span class=\"title function_\">loadURL</span>(<span class=\"string\">&#x27;app://./index.html&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">`//检查更新</span></span><br><span class=\"line\"><span class=\"string\">handleUpdate(win, &quot;.exe文件存放路径&quot;)`</span>     </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在app.vue里面渲染更新进度样式</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">MainPage</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">MainPage</span>&gt;</span></span><br><span class=\"line\">\t\t//2023/3/21  根据user要求改为静默式更新  只提示用户安装即可</span><br><span class=\"line\">\t<span class=\"comment\">&lt;!--\t&lt;el-dialog title=&quot;正在更新新版本,请稍候...&quot; :visible.sync=&quot;dialogVisible&quot; width=&quot;50%&quot;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t:close-on-click-modal=&quot;closeOnClickModal&quot; :close-on-press-escape=&quot;closeOnPressEscape&quot;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t:show-close=&quot;showClose&quot; center&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;div style=&quot;width:100%;height:50vh;line-height:50vh;text-align:center&quot;&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t&lt;el-progress :stroke-width=&quot;26&quot; :percentage=&quot;percentage&quot; :width=&quot;strokeWidth&quot; :show-text=&quot;true&quot;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t\ttype=&quot;circle&quot;&gt;&lt;/el-progress&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&lt;/el-dialog&gt;--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t<span class=\"keyword\">let</span> ipcRenderer = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;electron&quot;</span>).<span class=\"property\">ipcRenderer</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t<span class=\"keyword\">import</span> <span class=\"title class_\">MainPage</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./views/MainPage.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t<span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t<span class=\"attr\">components</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"title class_\">MainPage</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t<span class=\"title function_\">data</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">dialogVisible</span>: <span class=\"literal\">false</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">closeOnClickModal</span>: <span class=\"literal\">false</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">closeOnPressEscape</span>: <span class=\"literal\">false</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">showClose</span>: <span class=\"literal\">false</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">percentage</span>: <span class=\"number\">0</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">strokeWidth</span>: <span class=\"number\">400</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">timer</span>:<span class=\"number\">0</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t<span class=\"title function_\">created</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t<span class=\"title function_\">unmounted</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"built_in\">clearInterval</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">timer</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t<span class=\"title function_\">mounted</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"keyword\">let</span> _this = <span class=\"variable language_\">this</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"comment\">//新增 </span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">timer</span> = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\tipcRenderer.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;checkForUpdate&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t&#125;, <span class=\"number\">1</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t&#125;, <span class=\"number\">60000</span> * <span class=\"number\">60</span> * <span class=\"number\">2</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"comment\">//接收主进程版本更新消息</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\tipcRenderer.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;message&quot;</span>, <span class=\"function\">(<span class=\"params\">event, arg</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"comment\">//新增内容</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"comment\">/**`if (&quot;confimUpdate&quot; == arg.cmd) &#123;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t\t_this.dialogVisible = true;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t&#125; else if (&quot;download-progress&quot; == arg.cmd) &#123;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t\tconsole.log(arg.message.percent);</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t\tlet percent = Math.round(parseFloat(arg.message.percent));</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t\t_this.percentage = percent;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t&#125; else if (&quot;error&quot; == arg.cmd) &#123;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t\t_this.dialogVisible = false;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t\t_this.$message(&quot;更新失败&quot;);</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t&#125;`*/</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t<span class=\"comment\">//2023/03/21改为如下</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"keyword\">if</span> (<span class=\"string\">&quot;update-downloaded&quot;</span> == arg.<span class=\"property\">cmd</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t_this.$alert(<span class=\"string\">&#x27;新版本已经下载完成&#x27;</span>, <span class=\"string\">&#x27;提示信息&#x27;</span>, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t\t<span class=\"attr\">confirmButtonText</span>: <span class=\"string\">&#x27;立即安装&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t\t<span class=\"attr\">callback</span>: <span class=\"function\">(<span class=\"params\">action</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t\t\tipcRenderer.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;quit-install&quot;</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t   </span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>效果图 （没有了，不是这个效果了）</strong><br><img src=\"/./image-4.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPErneJ\"><img src=\"https://s1.ax1x.com/2023/08/07/pPErneJ.png\" alt=\"pPErneJ.png\"></a><br><strong>新的效果：</strong></p>\n<p><img src=\"/./image-5.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPErKoR\"><img src=\"https://s1.ax1x.com/2023/08/07/pPErKoR.png\" alt=\"pPErKoR.png\"></a></p>\n<h3 id=\"自定义安装路径\"><a href=\"#自定义安装路径\" class=\"headerlink\" title=\"自定义安装路径\"></a>自定义安装路径</h3><blockquote>\n<p>打包安装默认是直接装在c盘的 </p>\n<p>新建vue.config.js</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">\t<span class=\"attr\">pluginOptions</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">electronBuilder</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">nodeIntegration</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">builderOptions</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">nsis</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">allowToChangeInstallationDirectory</span>: <span class=\"literal\">true</span>, <span class=\"comment\">//自定义安装路径</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">oneClick</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">win</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">publish</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">provider</span>: <span class=\"string\">&quot;generic&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">url</span>: <span class=\"string\">&quot;存放exe文件路径&quot;</span>  <span class=\"comment\">//更新包地址  </span></span><br><span class=\"line\">\t\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">productName</span>: <span class=\"string\">&#x27;xxx&#x27;</span>  <span class=\"comment\">//项目名</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>ps:   百度时  网上好多资料都是说直接在package.json的build里面</p>\n<p>直接加上</p>\n<p>nsis: {<br>    allowToChangeInstallationDirectory: true, &#x2F;&#x2F;自定义安装路径<br>    oneClick: false,<br>},</p>\n<p>这并不适用于我的项目，所以新建了vue.config.js。</p>\n</blockquote>\n<p><img src=\"/./image-6.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPEr8SK\"><img src=\"https://s1.ax1x.com/2023/08/07/pPEr8SK.png\" alt=\"pPEr8SK.png\"></a></p>\n<blockquote>\n<p>我这里是更新   所以直接跳过了自定义安装路径的那一步，第一次安装可以自己选择路径。</p>\n</blockquote>\n<h2 id=\"修改-项目打包安装图标\"><a href=\"#修改-项目打包安装图标\" class=\"headerlink\" title=\"修改 项目打包安装图标\"></a>修改 项目打包安装图标</h2><p>1、安装依赖  生成图标</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add electron-icon-builder</span><br></pre></td></tr></table></figure>\n\n<p>2、在package.json的script中添加命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;electron:generate-icons&quot;: &quot;electron-icon-builder --input=./public/icon.png --output=build --flatten&quot;</span><br></pre></td></tr></table></figure>\n\n<p>3、运行  yarn electron:generate-icons  后会生成一个build文件夹<code>（先要放一张icon.png）</code></p>\n<p><img src=\"/./image-7.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPErJyD\"><img src=\"https://s1.ax1x.com/2023/08/07/pPErJyD.png\" alt=\"pPErJyD.png\"></a></p>\n<p>4、删除dist_electron文件夹 重新运行打包命令即可</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn electron:build</span><br></pre></td></tr></table></figure>\n\n<p>5、图标已更改</p>\n<p><img src=\"/./image-8.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPEr1W6\"><img src=\"https://s1.ax1x.com/2023/08/07/pPEr1W6.png\" alt=\"pPEr1W6.png\"></a></p>\n<p><code>笔记是后面写了  没有对比图   本来默认的是electron的图标</code></p>\n<h3 id=\"最后放一下完整的background-js文件\"><a href=\"#最后放一下完整的background-js文件\" class=\"headerlink\" title=\"最后放一下完整的background.js文件\"></a>最后放一下完整的background.js文件</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">\tapp,</span><br><span class=\"line\">\tprotocol,</span><br><span class=\"line\">\t<span class=\"title class_\">BrowserWindow</span>,</span><br><span class=\"line\">\t<span class=\"title class_\">Menu</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">\tcreateProtocol</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-cli-plugin-electron-builder/lib&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> installExtension, &#123;</span><br><span class=\"line\">\t<span class=\"variable constant_\">VUEJS_DEVTOOLS</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron-devtools-installer&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">\thandleUpdate</span><br><span class=\"line\">&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./handleUpdate.js&#x27;</span>) <span class=\"comment\">//根据自己路径引入</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> isDevelopment = process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> !== <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// Scheme must be registered before the app is ready</span></span><br><span class=\"line\">protocol.<span class=\"title function_\">registerSchemesAsPrivileged</span>([&#123;</span><br><span class=\"line\">\t<span class=\"attr\">scheme</span>: <span class=\"string\">&#x27;app&#x27;</span>,</span><br><span class=\"line\">\t<span class=\"attr\">privileges</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">secure</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">standard</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">createWindow</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// Create the browser window.</span></span><br><span class=\"line\">\t<span class=\"title class_\">Menu</span>.<span class=\"title function_\">setApplicationMenu</span>(<span class=\"literal\">null</span>) <span class=\"comment\">//隐藏菜单栏</span></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> win = <span class=\"keyword\">new</span> <span class=\"title class_\">BrowserWindow</span>(&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// width: 1900, //最大宽高 不设置则自适应</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// height: 1600,</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//fullscreen: true,//默认全屏</span></span><br><span class=\"line\">\t\t<span class=\"attr\">show</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">icon</span>: path.<span class=\"title function_\">join</span>(__static, <span class=\"string\">&quot;../public/favicon.ico&quot;</span>), <span class=\"comment\">//标题图标</span></span><br><span class=\"line\">\t\t<span class=\"attr\">webPreferences</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">nodeIntegration</span>: process.<span class=\"property\">env</span>.<span class=\"property\">ELECTRON_NODE_INTEGRATION</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">contextIsolation</span>: !process.<span class=\"property\">env</span>.<span class=\"property\">ELECTRON_NODE_INTEGRATION</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\twin.<span class=\"title function_\">maximize</span>();<span class=\"comment\">//默认打开窗口最大化</span></span><br><span class=\"line\">\twin.<span class=\"title function_\">show</span>();</span><br><span class=\"line\">\t<span class=\"comment\">// win.webContents.openDevTools()</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Load the url of the dev server if in development mode</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">await</span> win.<span class=\"title function_\">loadURL</span>(process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) win.<span class=\"property\">webContents</span>.<span class=\"title function_\">openDevTools</span>()  <span class=\"comment\">//调试工具</span></span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">createProtocol</span>(<span class=\"string\">&#x27;app&#x27;</span>)</span><br><span class=\"line\">\t\t<span class=\"comment\">// Load the index.html when not in development</span></span><br><span class=\"line\">\t\twin.<span class=\"title function_\">loadURL</span>(<span class=\"string\">&#x27;app://./index.html&#x27;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//检查更新</span></span><br><span class=\"line\">\t<span class=\"title function_\">handleUpdate</span>(win, <span class=\"string\">&quot;.exe文件存放路径  和vue.config.js文件里的一致&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Quit when all windows are closed.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;window-all-closed&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// On macOS it is common for applications and their menu bar</span></span><br><span class=\"line\">\t<span class=\"comment\">// to stay active until the user quits explicitly with Cmd + Q</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> !== <span class=\"string\">&#x27;darwin&#x27;</span>) &#123;</span><br><span class=\"line\">\t\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;quit&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;activate&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (<span class=\"title class_\">BrowserWindow</span>.<span class=\"title function_\">getAllWindows</span>().<span class=\"property\">length</span> === <span class=\"number\">0</span>) <span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;ready&#x27;</span>, <span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (isDevelopment &amp;&amp; !process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Install Vue Devtools</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">await</span> <span class=\"title function_\">installExtension</span>(<span class=\"variable constant_\">VUEJS_DEVTOOLS</span>)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;Vue Devtools failed to install:&#x27;</span>, e.<span class=\"title function_\">toString</span>())</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Exit cleanly on request from parent process in development mode.</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (isDevelopment) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> === <span class=\"string\">&#x27;win32&#x27;</span>) &#123;</span><br><span class=\"line\">\t\tprocess.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (data === <span class=\"string\">&#x27;graceful-exit&#x27;</span>) &#123;</span><br><span class=\"line\">\t\t\t\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tprocess.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;SIGTERM&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"项目总体目录结构\"><a href=\"#项目总体目录结构\" class=\"headerlink\" title=\"项目总体目录结构\"></a>项目总体目录结构</h3><p><img src=\"/./image-9.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPErGQO\"><img src=\"https://s1.ax1x.com/2023/08/07/pPErGQO.png\" alt=\"pPErGQO.png\"></a><br><code>安装依赖卡的解决办法：npm config set electron_mirror https://npm.taobao.org/mirrors/electron/</code><br><code>后来搞了个入门案例   但是没有做更新  实现方式  electron+vite+vue3+pinia  跟上面有出入  不太影响  适合新人学习使用</code><br><a href=\"https://download.csdn.net/download/weixin_44987713/86403644\">项目下载</a></p>\n","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<p><code>需求：开发桌面端一体机应用：先把架构搭好就会事半功倍。</code></p>\n<h3 id=\"新建项目\"><a href=\"#新建项目\" class=\"headerlink\" title=\"新建项目\"></a>新建项目</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue create demo</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装electron\"><a href=\"#安装electron\" class=\"headerlink\" title=\"安装electron\"></a>安装electron</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add electron</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加打包工具\"><a href=\"#添加打包工具\" class=\"headerlink\" title=\"添加打包工具\"></a>添加打包工具</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue add electron-builder</span><br></pre></td></tr></table></figure>\n<p><img src=\"/image.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPErlJx\"><img src=\"https://s1.ax1x.com/2023/08/07/pPErlJx.png\" alt=\"pPErlJx.png\"></a><br><img src=\"/./image-1.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPEruw9\"><img src=\"https://s1.ax1x.com/2023/08/07/pPEruw9.png\" alt=\"pPEruw9.png\"></a></p>\n<blockquote>\n<p>安装后src下会生成background.js文件</p>\n<p>package.json也会生成对应的命令</p>\n<p>并把background.js作为入口文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;electron:build&quot;: &quot;vue-cli-service electron:build&quot;,</span><br><span class=\"line\">&quot;electron:serve&quot;: &quot;vue-cli-service electron:serve&quot;,</span><br></pre></td></tr></table></figure>\n</blockquote>\n<h3 id=\"打包时遇到的error-ERR-ELECTRON-BUILDER-CANNOT-EXECUTE\"><a href=\"#打包时遇到的error-ERR-ELECTRON-BUILDER-CANNOT-EXECUTE\" class=\"headerlink\" title=\"打包时遇到的error ERR_ELECTRON_BUILDER_CANNOT_EXECUTE\"></a>打包时遇到的error <code>ERR_ELECTRON_BUILDER_CANNOT_EXECUTE</code></h3><blockquote>\n<h3 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h3><p><code>1、</code>下载 与当前elecron本版一致的 win32-x64 然后放到 参考路径 ： C:\\Users\\Admin&#x2F;AppData\\Local\\electron\\Cache<br><code>2 、</code>下载 对应的 winCodeSign 解压后 放到 C:\\User\\Admin&#x2F;AppData\\Local\\electron-builder\\Cache 没有 winCodeSign 文件夹 自己新建<br><code>3、</code> 下载对应的 nsis 和 对应的 nsis-resources 放到 C:\\User\\Admin&#x2F;AppData\\Local\\electron-builder\\Cache&#x2F;nsis 下面</p>\n</blockquote>\n<blockquote>\n<p>注：<code>复制错误提示里面的链接下载</code><br>比如下面的错 ：复制<a href=\"https://github.com/electron/electron/releases/download/v20.0.0/electron-v20.0.0-win32-x64.zip%E8%BF%9B%E8%A1%8C%E4%B8%8B%E8%BD%BD\">https://github.com/electron/electron/releases/download/v20.0.0/electron-v20.0.0-win32-x64.zip进行下载</a>  然后执行<code>上面1的步骤</code>即可解决。</p>\n</blockquote>\n<p><code>PS:这里要注意的是可能有版本相关的问题（我有两个项目，两个项目下载的版本不一样。一个13.6.9一个20）</code><br><img src=\"/./image-2.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPErQF1\"><img src=\"https://s1.ax1x.com/2023/08/07/pPErQF1.png\" alt=\"pPErQF1.png\"></a></p>\n<h3 id=\"background-js\"><a href=\"#background-js\" class=\"headerlink\" title=\"background.js\"></a>background.js</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">\tapp,</span><br><span class=\"line\">\tprotocol,</span><br><span class=\"line\">\t<span class=\"title class_\">BrowserWindow</span>,</span><br><span class=\"line\">\t<span class=\"title class_\">Menu</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">\tcreateProtocol</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-cli-plugin-electron-builder/lib&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> installExtension, &#123;</span><br><span class=\"line\">\t<span class=\"variable constant_\">VUEJS_DEVTOOLS</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron-devtools-installer&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> isDevelopment = process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> !== <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Scheme must be registered before the app is ready</span></span><br><span class=\"line\">protocol.<span class=\"title function_\">registerSchemesAsPrivileged</span>([&#123;</span><br><span class=\"line\">\t<span class=\"attr\">scheme</span>: <span class=\"string\">&#x27;app&#x27;</span>,</span><br><span class=\"line\">\t<span class=\"attr\">privileges</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">secure</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">standard</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">createWindow</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// Create the browser window.</span></span><br><span class=\"line\">\t<span class=\"title class_\">Menu</span>.<span class=\"title function_\">setApplicationMenu</span>(<span class=\"literal\">null</span>) <span class=\"comment\">//隐藏菜单栏</span></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> win = <span class=\"keyword\">new</span> <span class=\"title class_\">BrowserWindow</span>(&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// width: 1900, //最大宽高 不设置则自适应</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// height: 1600,</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//fullscreen: true,//默认全屏</span></span><br><span class=\"line\">\t\t<span class=\"attr\">show</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">webPreferences</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">nodeIntegration</span>: process.<span class=\"property\">env</span>.<span class=\"property\">ELECTRON_NODE_INTEGRATION</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">contextIsolation</span>: !process.<span class=\"property\">env</span>.<span class=\"property\">ELECTRON_NODE_INTEGRATION</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\twin.<span class=\"title function_\">maximize</span>();<span class=\"comment\">//窗口最大化</span></span><br><span class=\"line\">\twin.<span class=\"title function_\">show</span>();</span><br><span class=\"line\">\t<span class=\"comment\">// win.webContents.openDevTools()</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Load the url of the dev server if in development mode</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">await</span> win.<span class=\"title function_\">loadURL</span>(process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) win.<span class=\"property\">webContents</span>.<span class=\"title function_\">openDevTools</span>()  <span class=\"comment\">//调试工具</span></span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">createProtocol</span>(<span class=\"string\">&#x27;app&#x27;</span>)</span><br><span class=\"line\">\t\t<span class=\"comment\">// Load the index.html when not in development</span></span><br><span class=\"line\">\t\twin.<span class=\"title function_\">loadURL</span>(<span class=\"string\">&#x27;app://./index.html&#x27;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Quit when all windows are closed.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;window-all-closed&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// On macOS it is common for applications and their menu bar</span></span><br><span class=\"line\">\t<span class=\"comment\">// to stay active until the user quits explicitly with Cmd + Q</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> !== <span class=\"string\">&#x27;darwin&#x27;</span>) &#123;</span><br><span class=\"line\">\t\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//点击关闭</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;quit&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;activate&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// On macOS it&#x27;s common to re-create a window in the app when the</span></span><br><span class=\"line\">\t<span class=\"comment\">// dock icon is clicked and there are no other windows open.</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (<span class=\"title class_\">BrowserWindow</span>.<span class=\"title function_\">getAllWindows</span>().<span class=\"property\">length</span> === <span class=\"number\">0</span>) <span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This method will be called when Electron has finished</span></span><br><span class=\"line\"><span class=\"comment\">// initialization and is ready to create browser windows.</span></span><br><span class=\"line\"><span class=\"comment\">// Some APIs can only be used after this event occurs.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;ready&#x27;</span>, <span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (isDevelopment &amp;&amp; !process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Install Vue Devtools</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">await</span> <span class=\"title function_\">installExtension</span>(<span class=\"variable constant_\">VUEJS_DEVTOOLS</span>)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;Vue Devtools failed to install:&#x27;</span>, e.<span class=\"title function_\">toString</span>())</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Exit cleanly on request from parent process in development mode.</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (isDevelopment) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> === <span class=\"string\">&#x27;win32&#x27;</span>) &#123;</span><br><span class=\"line\">\t\tprocess.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (data === <span class=\"string\">&#x27;graceful-exit&#x27;</span>) &#123;</span><br><span class=\"line\">\t\t\t\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tprocess.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;SIGTERM&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>运行  electron:serve  命令就可以启动成功了。</p>\n<p>打包运行  electron:build命令</p>\n</blockquote>\n<p>更多配置参考  <a href=\"https://www.electronjs.org/docs/latest/api/app\">electron官方文档</a></p>\n<h3 id=\"自动更新-electron-updater\"><a href=\"#自动更新-electron-updater\" class=\"headerlink\" title=\"自动更新 electron-updater\"></a>自动更新 electron-updater</h3><blockquote>\n<p>1、安装依赖  yarn add  electron-updater</p>\n<p>2、自定义更新的文件 handleUpdate.js</p>\n<p>注： 打包完会生成一个latest.yml文件，把这个文件和生成的.exe文件放在服务器上，会自动检测版本</p>\n</blockquote>\n<p><img src=\"/./image-3.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPEreL4\"><img src=\"https://s1.ax1x.com/2023/08/07/pPEreL4.png\" alt=\"pPEreL4.png\"></a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">\tautoUpdater</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron-updater&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">\tipcMain,dialog</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> mainWindow = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">handleUpdate</span>(<span class=\"params\"><span class=\"variable language_\">window</span>, feedUrl</span>) &#123;</span><br><span class=\"line\">\tmainWindow = <span class=\"variable language_\">window</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">let</span> message = &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">error</span>: <span class=\"string\">&#x27;检查更新出错&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">checking</span>: <span class=\"string\">&#x27;正在检查更新……&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">updateAva</span>: <span class=\"string\">&#x27;检测到新版本，正在下载……&#x27;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">updateNotAva</span>: <span class=\"string\">&#x27;现在使用的就是最新版本，不用更新&#x27;</span>,</span><br><span class=\"line\">\t&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">`autoUpdater.autoDownload = false;`</span> <span class=\"comment\">//取消自动下载</span></span><br><span class=\"line\">\t<span class=\"comment\">//设置更新包的地址</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">setFeedURL</span>(feedUrl);</span><br><span class=\"line\">\t<span class=\"comment\">//监听升级失败事件</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;error&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">error</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">sendUpdateMessage</span>(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">cmd</span>: <span class=\"string\">&#x27;error&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">message</span>: error</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">\t<span class=\"comment\">//监听开始检测更新事件</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;checking-for-update&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">message</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">sendUpdateMessage</span>(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">cmd</span>: <span class=\"string\">&#x27;checking-for-update&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">message</span>: message</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">\t<span class=\"comment\">//监听发现可用更新事件</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-available&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">message</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">sendUpdateMessage</span>(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">cmd</span>: <span class=\"string\">&#x27;update-available&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">message</span>: message</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t<span class=\"comment\">//新加内容</span></span><br><span class=\"line\">\t<span class=\"comment\">/**\t`const options = &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\ttype: &#x27;info&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tbuttons: [&#x27;确定&#x27;, &#x27;取消&#x27;],</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\ttitle: &#x27;更新提示&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tmessage: &#x27;发现有新版本，是否更新？&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tcancelId: 1</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\t\tdialog.showMessageBox(options).then(res =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tif (res.response === 0) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\tsendUpdateMessage(&#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t\tcmd: &#x27;confimUpdate&#x27;,</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t\tmessage: message</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\tautoUpdater.downloadUpdate()</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&#125; else &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\treturn;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&#125;)`*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">\t<span class=\"comment\">//监听没有可用更新事件</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-not-available&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">message</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">sendUpdateMessage</span>(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">cmd</span>: <span class=\"string\">&#x27;update-not-available&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">message</span>: message</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 更新下载进度事件</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;download-progress&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">progressObj</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">sendUpdateMessage</span>(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">cmd</span>: <span class=\"string\">&#x27;download-progress&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">message</span>: progressObj</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">\t<span class=\"comment\">//监听下载完成事件</span></span><br><span class=\"line\">\tautoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-downloaded&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">event, releaseNotes, releaseName, releaseDate, updateUrl</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">sendUpdateMessage</span>(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">cmd</span>: <span class=\"string\">&#x27;update-downloaded&#x27;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">message</span>: &#123;</span><br><span class=\"line\">\t\t\t\treleaseNotes,</span><br><span class=\"line\">\t\t\t\treleaseName,</span><br><span class=\"line\">\t\t\t\treleaseDate,</span><br><span class=\"line\">\t\t\t\tupdateUrl</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t<span class=\"comment\">//退出并安装更新包</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//autoUpdater.quitAndInstall();</span></span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">\t<span class=\"comment\">//新增</span></span><br><span class=\"line\">\tipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;quit-install&quot;</span>, <span class=\"function\">(<span class=\"params\">e, arg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\tautoUpdater.<span class=\"title function_\">quitAndInstall</span>();</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\t<span class=\"comment\">//接收渲染进程消息，开始检查更新</span></span><br><span class=\"line\">\tipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;checkForUpdate&quot;</span>, <span class=\"function\">(<span class=\"params\">e, arg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//执行自动更新检查</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// sendUpdateMessage(&#123;cmd:&#x27;checkForUpdate&#x27;,message:arg&#125;)</span></span><br><span class=\"line\">\t\tautoUpdater.<span class=\"title function_\">checkForUpdates</span>();</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//给渲染进程发送消息</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">sendUpdateMessage</span>(<span class=\"params\">text</span>) &#123;</span><br><span class=\"line\">\tmainWindow.<span class=\"property\">webContents</span>.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;message&#x27;</span>, text)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>3、在主进程文件background.js里面引用 handleUpdate.js</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">`const &#123;</span></span><br><span class=\"line\"><span class=\"string\">\thandleUpdate</span></span><br><span class=\"line\"><span class=\"string\">&#125; = require(&#x27;./handleUpdate.js&#x27;) //根据自己路径引入 我是跟background.js同级放的`</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">await</span> win.<span class=\"title function_\">loadURL</span>(process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) win.<span class=\"property\">webContents</span>.<span class=\"title function_\">openDevTools</span>()  <span class=\"comment\">//调试工具</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t<span class=\"title function_\">createProtocol</span>(<span class=\"string\">&#x27;app&#x27;</span>)</span><br><span class=\"line\">\twin.<span class=\"title function_\">loadURL</span>(<span class=\"string\">&#x27;app://./index.html&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">`//检查更新</span></span><br><span class=\"line\"><span class=\"string\">handleUpdate(win, &quot;.exe文件存放路径&quot;)`</span>     </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在app.vue里面渲染更新进度样式</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">MainPage</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">MainPage</span>&gt;</span></span><br><span class=\"line\">\t\t//2023/3/21  根据user要求改为静默式更新  只提示用户安装即可</span><br><span class=\"line\">\t<span class=\"comment\">&lt;!--\t&lt;el-dialog title=&quot;正在更新新版本,请稍候...&quot; :visible.sync=&quot;dialogVisible&quot; width=&quot;50%&quot;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t:close-on-click-modal=&quot;closeOnClickModal&quot; :close-on-press-escape=&quot;closeOnPressEscape&quot;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t:show-close=&quot;showClose&quot; center&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;div style=&quot;width:100%;height:50vh;line-height:50vh;text-align:center&quot;&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t&lt;el-progress :stroke-width=&quot;26&quot; :percentage=&quot;percentage&quot; :width=&quot;strokeWidth&quot; :show-text=&quot;true&quot;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t\ttype=&quot;circle&quot;&gt;&lt;/el-progress&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&lt;/el-dialog&gt;--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t<span class=\"keyword\">let</span> ipcRenderer = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;electron&quot;</span>).<span class=\"property\">ipcRenderer</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t<span class=\"keyword\">import</span> <span class=\"title class_\">MainPage</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./views/MainPage.vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t<span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t<span class=\"attr\">components</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"title class_\">MainPage</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t<span class=\"title function_\">data</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">dialogVisible</span>: <span class=\"literal\">false</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">closeOnClickModal</span>: <span class=\"literal\">false</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">closeOnPressEscape</span>: <span class=\"literal\">false</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">showClose</span>: <span class=\"literal\">false</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">percentage</span>: <span class=\"number\">0</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">strokeWidth</span>: <span class=\"number\">400</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"attr\">timer</span>:<span class=\"number\">0</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t<span class=\"title function_\">created</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t<span class=\"title function_\">unmounted</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"built_in\">clearInterval</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">timer</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t<span class=\"title function_\">mounted</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"keyword\">let</span> _this = <span class=\"variable language_\">this</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"comment\">//新增 </span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"variable language_\">this</span>.<span class=\"property\">timer</span> = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\tipcRenderer.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;checkForUpdate&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t&#125;, <span class=\"number\">1</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t&#125;, <span class=\"number\">60000</span> * <span class=\"number\">60</span> * <span class=\"number\">2</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t<span class=\"comment\">//接收主进程版本更新消息</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\tipcRenderer.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;message&quot;</span>, <span class=\"function\">(<span class=\"params\">event, arg</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"comment\">//新增内容</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"comment\">/**`if (&quot;confimUpdate&quot; == arg.cmd) &#123;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t\t_this.dialogVisible = true;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t&#125; else if (&quot;download-progress&quot; == arg.cmd) &#123;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t\tconsole.log(arg.message.percent);</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t\tlet percent = Math.round(parseFloat(arg.message.percent));</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t\t_this.percentage = percent;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t&#125; else if (&quot;error&quot; == arg.cmd) &#123;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t\t_this.dialogVisible = false;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t\t_this.$message(&quot;更新失败&quot;);</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-javascript\">\t\t\t\t\t&#125;`*/</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t<span class=\"comment\">//2023/03/21改为如下</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t<span class=\"keyword\">if</span> (<span class=\"string\">&quot;update-downloaded&quot;</span> == arg.<span class=\"property\">cmd</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t_this.$alert(<span class=\"string\">&#x27;新版本已经下载完成&#x27;</span>, <span class=\"string\">&#x27;提示信息&#x27;</span>, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t\t<span class=\"attr\">confirmButtonText</span>: <span class=\"string\">&#x27;立即安装&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t\t<span class=\"attr\">callback</span>: <span class=\"function\">(<span class=\"params\">action</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t\t\tipcRenderer.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;quit-install&quot;</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t\t&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t\t&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t   </span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t\t&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t</span></span><br><span class=\"line\"><span class=\"language-javascript\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">\t&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>效果图 （没有了，不是这个效果了）</strong><br><img src=\"/./image-4.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPErneJ\"><img src=\"https://s1.ax1x.com/2023/08/07/pPErneJ.png\" alt=\"pPErneJ.png\"></a><br><strong>新的效果：</strong></p>\n<p><img src=\"/./image-5.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPErKoR\"><img src=\"https://s1.ax1x.com/2023/08/07/pPErKoR.png\" alt=\"pPErKoR.png\"></a></p>\n<h3 id=\"自定义安装路径\"><a href=\"#自定义安装路径\" class=\"headerlink\" title=\"自定义安装路径\"></a>自定义安装路径</h3><blockquote>\n<p>打包安装默认是直接装在c盘的 </p>\n<p>新建vue.config.js</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">\t<span class=\"attr\">pluginOptions</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">electronBuilder</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">nodeIntegration</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">builderOptions</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">nsis</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">allowToChangeInstallationDirectory</span>: <span class=\"literal\">true</span>, <span class=\"comment\">//自定义安装路径</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">oneClick</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">win</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">publish</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">provider</span>: <span class=\"string\">&quot;generic&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">url</span>: <span class=\"string\">&quot;存放exe文件路径&quot;</span>  <span class=\"comment\">//更新包地址  </span></span><br><span class=\"line\">\t\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">productName</span>: <span class=\"string\">&#x27;xxx&#x27;</span>  <span class=\"comment\">//项目名</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>ps:   百度时  网上好多资料都是说直接在package.json的build里面</p>\n<p>直接加上</p>\n<p>nsis: {<br>    allowToChangeInstallationDirectory: true, &#x2F;&#x2F;自定义安装路径<br>    oneClick: false,<br>},</p>\n<p>这并不适用于我的项目，所以新建了vue.config.js。</p>\n</blockquote>\n<p><img src=\"/./image-6.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPEr8SK\"><img src=\"https://s1.ax1x.com/2023/08/07/pPEr8SK.png\" alt=\"pPEr8SK.png\"></a></p>\n<blockquote>\n<p>我这里是更新   所以直接跳过了自定义安装路径的那一步，第一次安装可以自己选择路径。</p>\n</blockquote>\n<h2 id=\"修改-项目打包安装图标\"><a href=\"#修改-项目打包安装图标\" class=\"headerlink\" title=\"修改 项目打包安装图标\"></a>修改 项目打包安装图标</h2><p>1、安装依赖  生成图标</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add electron-icon-builder</span><br></pre></td></tr></table></figure>\n\n<p>2、在package.json的script中添加命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;electron:generate-icons&quot;: &quot;electron-icon-builder --input=./public/icon.png --output=build --flatten&quot;</span><br></pre></td></tr></table></figure>\n\n<p>3、运行  yarn electron:generate-icons  后会生成一个build文件夹<code>（先要放一张icon.png）</code></p>\n<p><img src=\"/./image-7.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPErJyD\"><img src=\"https://s1.ax1x.com/2023/08/07/pPErJyD.png\" alt=\"pPErJyD.png\"></a></p>\n<p>4、删除dist_electron文件夹 重新运行打包命令即可</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn electron:build</span><br></pre></td></tr></table></figure>\n\n<p>5、图标已更改</p>\n<p><img src=\"/./image-8.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPEr1W6\"><img src=\"https://s1.ax1x.com/2023/08/07/pPEr1W6.png\" alt=\"pPEr1W6.png\"></a></p>\n<p><code>笔记是后面写了  没有对比图   本来默认的是electron的图标</code></p>\n<h3 id=\"最后放一下完整的background-js文件\"><a href=\"#最后放一下完整的background-js文件\" class=\"headerlink\" title=\"最后放一下完整的background.js文件\"></a>最后放一下完整的background.js文件</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">\tapp,</span><br><span class=\"line\">\tprotocol,</span><br><span class=\"line\">\t<span class=\"title class_\">BrowserWindow</span>,</span><br><span class=\"line\">\t<span class=\"title class_\">Menu</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">\tcreateProtocol</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-cli-plugin-electron-builder/lib&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> installExtension, &#123;</span><br><span class=\"line\">\t<span class=\"variable constant_\">VUEJS_DEVTOOLS</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron-devtools-installer&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">\thandleUpdate</span><br><span class=\"line\">&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./handleUpdate.js&#x27;</span>) <span class=\"comment\">//根据自己路径引入</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> isDevelopment = process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> !== <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// Scheme must be registered before the app is ready</span></span><br><span class=\"line\">protocol.<span class=\"title function_\">registerSchemesAsPrivileged</span>([&#123;</span><br><span class=\"line\">\t<span class=\"attr\">scheme</span>: <span class=\"string\">&#x27;app&#x27;</span>,</span><br><span class=\"line\">\t<span class=\"attr\">privileges</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">secure</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">standard</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">createWindow</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// Create the browser window.</span></span><br><span class=\"line\">\t<span class=\"title class_\">Menu</span>.<span class=\"title function_\">setApplicationMenu</span>(<span class=\"literal\">null</span>) <span class=\"comment\">//隐藏菜单栏</span></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> win = <span class=\"keyword\">new</span> <span class=\"title class_\">BrowserWindow</span>(&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// width: 1900, //最大宽高 不设置则自适应</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// height: 1600,</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//fullscreen: true,//默认全屏</span></span><br><span class=\"line\">\t\t<span class=\"attr\">show</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">icon</span>: path.<span class=\"title function_\">join</span>(__static, <span class=\"string\">&quot;../public/favicon.ico&quot;</span>), <span class=\"comment\">//标题图标</span></span><br><span class=\"line\">\t\t<span class=\"attr\">webPreferences</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">nodeIntegration</span>: process.<span class=\"property\">env</span>.<span class=\"property\">ELECTRON_NODE_INTEGRATION</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">contextIsolation</span>: !process.<span class=\"property\">env</span>.<span class=\"property\">ELECTRON_NODE_INTEGRATION</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\twin.<span class=\"title function_\">maximize</span>();<span class=\"comment\">//默认打开窗口最大化</span></span><br><span class=\"line\">\twin.<span class=\"title function_\">show</span>();</span><br><span class=\"line\">\t<span class=\"comment\">// win.webContents.openDevTools()</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Load the url of the dev server if in development mode</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">await</span> win.<span class=\"title function_\">loadURL</span>(process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) win.<span class=\"property\">webContents</span>.<span class=\"title function_\">openDevTools</span>()  <span class=\"comment\">//调试工具</span></span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"title function_\">createProtocol</span>(<span class=\"string\">&#x27;app&#x27;</span>)</span><br><span class=\"line\">\t\t<span class=\"comment\">// Load the index.html when not in development</span></span><br><span class=\"line\">\t\twin.<span class=\"title function_\">loadURL</span>(<span class=\"string\">&#x27;app://./index.html&#x27;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//检查更新</span></span><br><span class=\"line\">\t<span class=\"title function_\">handleUpdate</span>(win, <span class=\"string\">&quot;.exe文件存放路径  和vue.config.js文件里的一致&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Quit when all windows are closed.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;window-all-closed&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// On macOS it is common for applications and their menu bar</span></span><br><span class=\"line\">\t<span class=\"comment\">// to stay active until the user quits explicitly with Cmd + Q</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> !== <span class=\"string\">&#x27;darwin&#x27;</span>) &#123;</span><br><span class=\"line\">\t\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;quit&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;activate&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (<span class=\"title class_\">BrowserWindow</span>.<span class=\"title function_\">getAllWindows</span>().<span class=\"property\">length</span> === <span class=\"number\">0</span>) <span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;ready&#x27;</span>, <span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (isDevelopment &amp;&amp; !process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Install Vue Devtools</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">await</span> <span class=\"title function_\">installExtension</span>(<span class=\"variable constant_\">VUEJS_DEVTOOLS</span>)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;Vue Devtools failed to install:&#x27;</span>, e.<span class=\"title function_\">toString</span>())</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Exit cleanly on request from parent process in development mode.</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (isDevelopment) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> === <span class=\"string\">&#x27;win32&#x27;</span>) &#123;</span><br><span class=\"line\">\t\tprocess.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (data === <span class=\"string\">&#x27;graceful-exit&#x27;</span>) &#123;</span><br><span class=\"line\">\t\t\t\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tprocess.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;SIGTERM&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\tapp.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"项目总体目录结构\"><a href=\"#项目总体目录结构\" class=\"headerlink\" title=\"项目总体目录结构\"></a>项目总体目录结构</h3><p><img src=\"/./image-9.png\" alt=\"Alt text\"><br><a href=\"https://imgse.com/i/pPErGQO\"><img src=\"https://s1.ax1x.com/2023/08/07/pPErGQO.png\" alt=\"pPErGQO.png\"></a><br><code>安装依赖卡的解决办法：npm config set electron_mirror https://npm.taobao.org/mirrors/electron/</code><br><code>后来搞了个入门案例   但是没有做更新  实现方式  electron+vite+vue3+pinia  跟上面有出入  不太影响  适合新人学习使用</code><br><a href=\"https://download.csdn.net/download/weixin_44987713/86403644\">项目下载</a></p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cll0f74s300063gs43ujodege","category_id":"cll0f74s000043gs4ca5m4812","_id":"cll0f74sg000b3gs49uefefke"},{"post_id":"cll0f74rp00013gs4b2qg39y1","category_id":"cll0f74s000043gs4ca5m4812","_id":"cll0f74sh000e3gs4hka77myr"},{"post_id":"cll0f74sb00073gs454ac826m","category_id":"cll0f74s000043gs4ca5m4812","_id":"cll0f74si000g3gs4fdb0dgu6"},{"post_id":"cll0f74rx00033gs42w1e5k8k","category_id":"cll0f74s000043gs4ca5m4812","_id":"cll0f74sj000j3gs4f8cz69c4"},{"post_id":"cll0f74s200053gs48h2ydkds","category_id":"cll0f74sg000c3gs4317pbztr","_id":"cll0f74sk000k3gs4ev632235"},{"post_id":"cll0f74sj000i3gs4e40t3mpt","category_id":"cll0f74sg000c3gs4317pbztr","_id":"cll0f74sk000m3gs49o1zau7c"},{"post_id":"cll0f74se00093gs491fq65d1","category_id":"cll0f74si000h3gs49d944iby","_id":"cll0f74sl000o3gs42x00coi7"},{"post_id":"cll0f74sf000a3gs40n720mat","category_id":"cll0f74si000h3gs49d944iby","_id":"cll0f74sl000p3gs470anaffw"},{"post_id":"cll0f74sg000d3gs4d4hrbbj5","category_id":"cll0f74sl000n3gs47zh7d1kl","_id":"cll0f74sm000r3gs4d378g9o8"},{"post_id":"cll0f74sh000f3gs40qay5128","category_id":"cll0f74sl000n3gs47zh7d1kl","_id":"cll0f74sm000s3gs464ipd2cu"},{"post_id":"cll0jgsj10000kgs4bcie790o","category_id":"cll0jgsj90001kgs48wvgbh4q","_id":"cll0jgsjf0002kgs491sd8nus"}],"PostTag":[],"Tag":[]}}